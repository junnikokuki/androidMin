var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),cm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAdd,e),e}return __extends(e,t),e.prototype.onAdd=function(){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},e.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},e}(egret.DisplayObjectContainer);t.Component=e,__reflect(e.prototype,"cm.Component");var i=function(t){function e(){var e=t.call(this)||this;return e._complete=!1,e._readyFunc=null,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAdd,e),e.addEventListener(eui.UIEvent.COMPLETE,e.onComplete,e),e}return __extends(e,t),Object.defineProperty(e.prototype,"complete",{get:function(){return this._complete},enumerable:!0,configurable:!0}),e.prototype.onReady=function(t){this._readyFunc=t},e.prototype.onComplete=function(){this._complete=!0,this.removeEventListener(eui.UIEvent.COMPLETE,this.onComplete,this),this._readyFunc&&this._readyFunc(),this._readyFunc=null},e.prototype.onAdd=function(){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},e.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.removeEventListener(eui.UIEvent.COMPLETE,this.onComplete,this),this._readyFunc=null},e}(eui.Component);t.EUIComponent=i,__reflect(i.prototype,"cm.EUIComponent")}(cm||(cm={}));var codearena;!function(t){var e=function(e){function i(i){var n=e.call(this)||this;return n._layer=t.GameLayer.Obj,n._currentGrid={column:0,row:0,w:0,h:0},n._view=null,n._cfg=null,n._isActived=!1,n._objectType="",n._atkSelect=!1,n._collisionRad=0,n._isObstacle=!1,n._curGridSize=null,n._collisionArea=null,n._cfg=i,n._isActived=!!i.active,n}return __extends(i,e),i.prototype.setView=function(e){this._view=e,this._view.name=this._cfg.id+"";var i=t.gameControl.getGridCenter(this._cfg.spawnPos.x,this._cfg.spawnPos.y);this.setPosition(i),t.Global.LOCAL_DEBUG&&this._drawDebug()},i.prototype._drawDebug=function(){this._collisionArea&&this._collisionArea.graphics.clear(),this._drawCollisionArea(16711680,.5,this._collisionRad,360)},i.prototype._drawCollisionArea=function(t,e,i,n){n=180;var o=this._collisionArea||new egret.Shape;o.graphics.clear(),this._collisionArea=o,o.graphics.beginFill(t,e);var r=(this.scaleX,this.scaleY,this.width,this.height,this.anchorOffsetX),s=this.anchorOffsetY;o.graphics.drawCircle(0,0,i),o.x=r,o.y=s,o.graphics.endFill(),this.addChildAt(o,0)},Object.defineProperty(i.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"objectType",{get:function(){return this._objectType},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isActived",{get:function(){return this._isActived},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isObstacle",{get:function(){return this._isObstacle},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"atkSelect",{get:function(){return this._atkSelect},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"type",{get:function(){return this._cfg.type},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"typeId",{get:function(){return this._cfg.typeId},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"id",{get:function(){return this._cfg.id},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"collisionRad",{get:function(){return this._collisionRad},enumerable:!0,configurable:!0}),i.prototype.setPosition=function(t){this.x=t.x,this.y=t.y,this.updateGrid()},i.prototype.updateGrid=function(){var e=t.gameControl.inWhichGrid(this.x,this.y);(e.column!=this._currentGrid.column||e.row!=this._currentGrid.row)&&(this._currentGrid.column=e.column,this._currentGrid.row=e.row,this._curGridSize=this.caculateGrid(),this._onGridChange())},Object.defineProperty(i.prototype,"currentGrid",{get:function(){return this._currentGrid},enumerable:!0,configurable:!0}),i.prototype.caculateGrid=function(e){e=e||{x:this.x,y:this.y};var i=t.gameControl.tileWidth,n=t.gameControl.tileHeight,o=e.x-this._collisionRad,r=(e.x+this._collisionRad,e.y-this._collisionRad),s=(e.y+this._collisionRad,Math.ceil(2*this._collisionRad/i)),a=Math.ceil(2*this._collisionRad/n),c=t.gameControl.inWhichGrid(o,r),h=c.column,l=c.row;return{column:h,row:l,w:s,h:a}},i.prototype._onGridChange=function(){t.gameControl.needSort=!0,this.dispatchEvent(new t.CustomEvent(t.CustomEvent.OBJ_POS_CHANGED))},i.prototype._onEnterFrame=function(){},Object.defineProperty(i.prototype,"cfg",{get:function(){return this._cfg},enumerable:!0,configurable:!0}),i.prototype.onAttacked=function(t){},Object.defineProperty(i.prototype,"layer",{get:function(){return this._layer},enumerable:!0,configurable:!0}),i.prototype.active=function(t){this._isActived=!0,t.addChild(this._view),this._view.addEventListener(egret.Event.ENTER_FRAME,this._onEnterFrame,this)},i.prototype.deactive=function(){this._isActived=!1,this._view.removeEventListener(egret.Event.ENTER_FRAME,this._onEnterFrame,this)},i.prototype.destroy=function(){this.deactive(),t.gameControl.removeObjectById(this.id),this._view.parent&&this._view.parent.removeChild(this._view)},Object.defineProperty(i.prototype,"x",{get:function(){return this._view.x},set:function(t){this._view.x=t},enumerable:!0,configurable:!0}),i.prototype.getGrid=function(){return t.gameControl.inWhichGrid(this.x,this.y)},Object.defineProperty(i.prototype,"y",{get:function(){return this._view.y},set:function(t){this._view.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleX",{get:function(){return this._view.scaleX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleY",{get:function(){return this._view.scaleY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._view.width},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._view.height},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"anchorOffsetX",{get:function(){return this._view.anchorOffsetX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"anchorOffsetY",{get:function(){return this._view.anchorOffsetY},enumerable:!0,configurable:!0}),i.prototype.addChildAt=function(t,e){this._view.addChildAt(t,e)},i.prototype.drawCollison=function(t){},i}(egret.EventDispatcher);t.GameObject=e,__reflect(e.prototype,"codearena.GameObject")}(codearena||(codearena={}));var cm;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.layout()},e.prototype.layout=function(){(this.stage.scaleMode===egret.StageScaleMode.FIXED_WIDE||this.stage.scaleMode===egret.StageScaleMode.FIXED_HEIGHT)&&(this.left=-this.stage.stageWidth/2,this.right=this.stage.stageWidth/2,this.horizontalCenter=0)},e}(t.EUIComponent);t.AutoLayoutView=e,__reflect(e.prototype,"cm.AutoLayoutView")}(cm||(cm={}));var codearena;!function(t){var e=function(){function t(){this._listener={}}return t.prototype.on=function(t,e,i){var n=this._listener[t];n?this.addEventListener(n,{target:i,handler:e}):this._listener[t]=[{handler:e,target:i}]},t.prototype.addEventListener=function(t,e){for(var i=0,n=t;i<n.length;i++){var o=n[i];if(o.handler===e.handler&&o.target===e.target)return}t.push(e)},t.prototype.off=function(t,e,i){var n=this._listener[t];if(n&&!(n.length<=0))for(var o=n.length-1,r=o;r>=0;r--){var s=n[r];s.handler===e&&s.target===i&&n.splice(r,1)}},t.prototype.dispatch=function(t){var e=this._listener[t];if(e)for(var i=0,n=e;i<n.length;i++){var o=n[i];o.handler.call(o.target)}},t}();t.Dispacher=e,__reflect(e.prototype,"codearena.Dispacher")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._leftDirectionXscale=1,t._username="",t.anchorX=.5,t.anchorY=1,t._armatureScaleX=1,t._armatureScaleY=1,t._modScale=1,t._lv=0,t.moveSpeed=300,t}return __extends(i,e),i.prototype.init=function(t,e,i,n,o){void 0===i&&(i=!1),void 0===n&&(n=.5),void 0===o&&(o=1),this._mod=t,this.anchorX=n,this.anchorY=o,this._username=e,this._needHp=i,this.loadRes()},Object.defineProperty(i.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),i.prototype.hideNameAndHpBar=function(){this._nameview&&(this._nameview.visible=!1),this.hpBar&&(this.hpBar.visible=!1)},i.prototype.setModScale=function(t){this._modScale=t,this._setScale()},i.prototype.getModScale=function(){return this._modScale},i.prototype.createName=function(e){this._nameview=new t.CharacterName(this._modScale),this._nameview.username=cm.Utils.stringEllipsis(e,16),this.addChild(this._nameview)},i.prototype.createHpBar=function(){this._needHp&&(this.hpBar=new t.HpBar,this.setLv(this._lv),this.addChild(this.hpBar),this.hpBar.horizontalCenter=this._lv>0?-18:0)},i.prototype.setLv=function(t){this._lv=t,this.hpBar&&(this.hpBar.lv=this._lv)},i.prototype.loadRes=function(){var e=cm.Utils.urlToResName(this._mod.url);if(this._mod.type===t.ResType.DRAGON_BONES){var i="animation_"+e;RES.createGroup(i,[e+"_ske_json",e+"_tex_json",e+"_tex_png"],!0),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this._onDragonbonesComplete,this),RES.loadGroup(i)}else this._mod.type===t.ResType.IMAGE&&RES.getResAsync(e,this._onLoadImageComplete,this)},i.prototype.layout=function(){this._nameview&&(this._nameview.top=-20),this.hpBar&&(this._nameview&&(this._nameview.top=-30),this.hpBar.top=-10)},i.prototype._onLoadImageComplete=function(){var t=cm.Utils.urlToResName(this._mod.url),e=RES.getRes(t);this._armature=new egret.Bitmap(e),this._setScale(),this.addChild(this._armature),this.createHpBar(),this.dispatchEvent(new egret.Event(egret.Event.COMPLETE)),this.layout()},i.prototype._onDragonbonesComplete=function(t){var e=cm.Utils.urlToResName(this._mod.url);t.groupName==="animation_"+e&&(this.createAnimation(),this.createHpBar(),this._username&&this.createName(this._username),this.layout(),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this._onDragonbonesComplete,this))},i.prototype.createAnimation=function(){var t,e=this._name=cm.Utils.urlToResName(this._mod.url),i=RES.getRes(e+"_ske_json"),n=RES.getRes(e+"_tex_json"),o=RES.getRes(e+"_tex_png");clib.dbFactory.getDragonBonesData(e)&&clib.dbFactory.getTextureAtlasData(e)||(clib.dbFactory.parseDragonBonesData(i),clib.dbFactory.parseTextureAtlasData(n,o)),t=clib.dbFactory.buildArmatureDisplay("armatureName",e),this._armature=t,this.addChild(this._armature);var r=this._armature.width,s=this._armature.height;this.anchorOffsetX=r*this.anchorX,this.anchorOffsetY=s*this.anchorY,this.width=r,this.height=s,this._armature.x=r/2,this._armature.y=s,this._setScale(),this._playArgs&&this.play.apply(this,this._playArgs),this.dispatchEvent(new egret.Event(egret.Event.COMPLETE))},i.prototype.play=function(e,i){if(this._playArgs=arguments,this._armature&&this._mod.type===t.ResType.DRAGON_BONES){var n=this._armature,o=n.animation.getState(e);o&&o.isPlaying||(n.animation.stop(),n.animation.play(e,i))}},i.prototype.stop=function(){if(this._armature&&this._mod.type===t.ResType.DRAGON_BONES){var e=this._armature;e.animation.stop()}},i.prototype.showChatBubble=function(e){this._chatBubble||(this._chatBubble=new t.ChatBubble),this._chatBubble.x=this.width/2,this._chatBubble.y=20,this.addChild(this._chatBubble),this._chatBubble.content=e,cm.scheduler.schedule(this,this.removeChatBubble,2e3,1)},i.prototype.removeChatBubble=function(){this._chatBubble&&this._chatBubble.parent&&this._chatBubble.parent.removeChild(this._chatBubble),this._chatBubble=null},i.prototype.setDirection=function(e){var i=this._armature?this._armature.scaleX:1;return e===t.Direction.LEFT?this._armatureScaleX=i=this._leftDirectionXscale:e===t.Direction.RIGHT&&(this._armatureScaleX=i=-1*this._leftDirectionXscale),this._armature?void this._setScale():void(this._armatureScaleX=i)},i.prototype._setScale=function(){if(this._armature){this._armature.scaleX=this._armatureScaleX*this._modScale,this._armature.scaleY=this._armatureScaleY*this._modScale;var e=this.width=this._armature.width*this._modScale,i=this.height=this._armature.height*this._modScale;this._mod.type===t.ResType.DRAGON_BONES&&(this._armature.x=e/2,this._armature.y=i),this.anchorOffsetX=e*this.anchorX,this.anchorOffsetY=i*this.anchorY}},i.prototype.walk=function(){this.play("war_walk_01",0)},i.prototype.walkTo=function(e){if(this._armature){this.walk(),egret.Tween.removeTweens(this);var i=egret.Tween.get(this),n=new egret.Point(this.x,this.y),o=egret.Point.distance(n,e),r=o/this.moveSpeed*1e3;e.x>this.x?this.setDirection(t.Direction.RIGHT):this.setDirection(t.Direction.LEFT);var s=new Promise(function(t,n){i.to({x:e.x,y:e.y},r).call(function(){t()})});return s}},i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.stop(),this.removeChatBubble(),this._name&&this._armature instanceof dragonBones.EgretArmatureDisplay&&this._armature.dispose(),cm.scheduler.unschedule(this,this.removeChatBubble)},i}(cm.EUIComponent);t.Character=e,__reflect(e.prototype,"codearena.Character")}(codearena||(codearena={}));var codearena;!function(t){var e;!function(t){t[t.active=0]="active",t[t.doing=1]="doing",t[t.completed=2]="completed",t[t.failed=3]="failed"}(e=t.MissionState||(t.MissionState={}));var i=function(i){function n(t){var e=i.call(this)||this;return e._total=0,e._progress=0,e._needManualCheck=!1,e._missionData=t,e._state=t.state,e._enabled=!1,e}return __extends(n,i),Object.defineProperty(n.prototype,"state",{get:function(){return this._state},set:function(t){this._enabled&&this._state!==t&&(this._state=t,this._state===e.completed?(egret.log("mission completed! id:"+this._missionData.id+" name:"+this._missionData.name),this._onComplete()):this._state===e.failed&&egret.log("mission failed! id:"+this._missionData.id+" name:"+this._missionData.name),this.dispatchEvent(new egret.Event(egret.Event.CHANGE)))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"missionData",{get:function(){return this._missionData},enumerable:!0,configurable:!0}),n.prototype.check=function(){},n.prototype._onComplete=function(){switch(this._missionData.completeOperate){case t.MissionOperate.active:egret.log("完成任务："+this._missionData.id+",激活id:"+this._missionData.operateTarget),t.gameControl.activeObject(this._missionData.operateTarget);break;case t.MissionOperate.deactive:egret.log("完成任务："+this._missionData.id+",关闭id:"+this._missionData.operateTarget),t.gameControl.deactiveObject(this._missionData.operateTarget);break;case t.MissionOperate.action:egret.log("完成任务："+this._missionData.id+",执行id:"+this._missionData.operateTarget+"-action:"+this._missionData.toggleStatus),t.gameControl.operatorObjectAction(this._missionData.operateTarget,this._missionData.toggleStatus)}},n.prototype.enable=function(){this._enabled=!0,egret.log("mission start,id:"+this._missionData.id+",name:"+this._missionData.name)},n.prototype.disable=function(){this._enabled=!1},Object.defineProperty(n.prototype,"total",{get:function(){return this._total},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"progress",{get:function(){return this._progress},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"needManualCheck",{get:function(){return this._needManualCheck},enumerable:!0,configurable:!0}),n.prototype._invalidArguments=function(){throw new Error("mission id:"+this._missionData.id+",invalid argument")},n.prototype._objectNotFound=function(t){throw new Error("mission id:"+this._missionData.id+",object:"+t+" not found")},n}(egret.EventDispatcher);t.MissionBase=i,__reflect(i.prototype,"codearena.MissionBase")}(codearena||(codearena={}));var cm;!function(t){var e=function(){function t(){this._lastTick=0,this._time=0}return t.prototype.start=function(){this._lastTick=egret.getTimer(),this._time=0,egret.startTick(this._tick,this)},t.prototype._tick=function(t){var e=t-this._lastTick;return e=e>100?100:e,this._time+=e,this._lastTick=t,!1},Object.defineProperty(t.prototype,"time",{get:function(){return this._time},enumerable:!0,configurable:!0}),t.prototype.stop=function(){egret.stopTick(this._tick,this)},t}();t.Clock=e,__reflect(e.prototype,"cm.Clock")}(cm||(cm={}));var codearena;!function(t){var e=function(e){function i(t,i){var n=e.call(this,t)||this;return n._visionAreaColor=1765883,n._atkTarget=null,n._attackClock=new cm.Clock,n._atkCooling=!1,n._visionArea=null,n._showVisionArea=!1,n.init(i),n}return __extends(i,e),i.prototype.init=function(e){this._roleCfg=e,this._scale=e.scale,this._collisionRad=e.collisionRad,this._atkSelect=!!e.atkSelect,this._hp=e.hp,this._totalHp=e.hp,this._moveSpd=e.moveSpd,this._visionRange=e.visionRange,this._visionAngle=e.visionAngle,this._atkSpd=e.atkSpd,this._atkRange=e.atkRange,this._atkValue=e.atkValue,this._defValue=e.defValue,this._collisionRad=e.collisionRad,this._moveSpd=e.moveSpd,this._name=e.name,this._idle_animation_name=this.getIdleAnimationName(),this._walk_animation_name=this.getWalkAnimationName(),this._attack_animation_name=this.getAttackAnimationName(),this._die_animation_name=this.getDieAnimationName(),this._animation=new t.Character,this.setDirection(t.convertDirection(this._cfg.spawnFace)),this.setView(this._animation)},i.prototype._onAnimationLoaded=function(){this._animationLoaded(),this._animation.armature.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._animationEventHandler,this),this._animation.armature.addEventListener(dragonBones.EventObject.COMPLETE,this._animationCompleteHandler,this),this._animation.armature.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._animationLoopCompleteHandler,this),this._animation.setDirection(this._direction),this._animation.removeEventListener(egret.Event.COMPLETE,this._onAnimationLoaded,this)},i.prototype._animationLoaded=function(){this._drawDebug()},i.prototype._drawDebug=function(){t.Global.LOCAL_DEBUG&&e.prototype._drawDebug.call(this),(t.Global.LOCAL_DEBUG||this._showVisionArea)&&this._drawVisionArea()},i.prototype._drawVisionArea=function(){var t=this._visionArea||new egret.Shape;t.graphics.clear();new egret.Matrix;t.graphics.beginGradientFill(egret.GradientType.RADIAL,[this._visionAreaColor,this._visionAreaColor],[0,.3],[0,255]);var e=this._visionRange,i=-(this._visionAngle/2)*Math.PI/180,n=this._visionAngle/2*Math.PI/180;t.graphics.moveTo(0,0);var o=Math.cos(i)*e,r=Math.sin(i)*e;t.graphics.lineStyle(360===this._visionAngle?0:1,this._visionAreaColor,.7),t.graphics.lineTo(o,r),t.graphics.lineStyle(1,this._visionAreaColor,.7),t.graphics.drawArc(0,0,e,i,n),t.graphics.lineStyle(360===this._visionAngle?0:1,this._visionAreaColor,.7),t.graphics.lineTo(0,0),t.graphics.endFill(),t.x=this.view.anchorOffsetX,t.y=this.view.anchorOffsetY,this._visionArea=t,this._setVisionAreaDirection();var s=this.view;s&&!s.contains(t)&&s.addChildAt(t,0)},i.prototype._setVisionAreaDirection=function(){if(this._visionArea)switch(this._direction){case t.Direction.RIGHT:this._visionArea.rotation=0;break;case t.Direction.DOWN:this._visionArea.rotation=90;break;case t.Direction.LEFT:this._visionArea.rotation=180;break;case t.Direction.UP:this._visionArea.rotation=270}},i.prototype._setVisionArea=function(e){this._showVisionArea=e||t.Global.LOCAL_DEBUG,this._visionArea?this._visionArea.visible=this._showVisionArea:(this._drawVisionArea(),this._visionArea.visible=this._showVisionArea)},i.prototype.setVisionArea=function(t){this._setVisionArea(!!t)},i.prototype.setDirection=function(t){this._direction=t,this._animation.setDirection(t),this._setVisionAreaDirection()},i.prototype.walkTo=function(e){var i=t.gameControl.inWhichGrid(this.x,this.y);if(this.currentGrid.column===e.column&&this.currentGrid.row===e.row)return Promise.resolve();var n=t.gameControl.findPath(i,e,!1);return n&&0!==n.length?this._move(n):Promise.reject("无法移动到该位置")},i.prototype.getNickName=function(){return this.id.toString()},i.prototype.active=function(i){e.prototype.active.call(this,i);var n=t.config.getModById(this._roleCfg.modId);this._animation.addEventListener(egret.Event.COMPLETE,this._onAnimationLoaded,this),this._animation.setModScale(this._scale),this._animation.init(n,this._name,!!this.atkSelect)},i.prototype.deactive=function(){e.prototype.deactive.call(this),this._attackClock&&this._attackClock.stop(),this._suspendMove()},i.prototype.destroy=function(){e.prototype.destroy.call(this),this._animation&&this._animation.armature&&(this._animation.removeEventListener(egret.Event.COMPLETE,this._onAnimationLoaded,this),this._animation.armature.removeEventListener(dragonBones.EventObject.FRAME_EVENT,this._animationEventHandler,this),this._animation.armature.removeEventListener(dragonBones.EventObject.COMPLETE,this._animationCompleteHandler,this),this._animation.armature.removeEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._animationLoopCompleteHandler,this))},i.prototype._move=function(e){var i=this;this._suspendMove(),this._animation.play(this._walk_animation_name,0);var n=new Promise(function(n,o){i._movePath=t.GridPathMove.move(i,e,i._moveSpd,i.validateMove.bind(i),function(){i._onWalkComplete(),n()},function(){})});return n},i.prototype._onWalkComplete=function(){this.idle(),this._suspendMove()},i.prototype.validateMove=function(e){var i=t.gameControl.objects;for(var n in i){var o=i[n];if(o.isActived){if(o.objectType===t.MapItemType.BOX&&this._checkCollision(o,e)){var r=this.collisionRad+o.collisionRad;switch(this._direction){case t.Direction.UP:e.x=e.x,e.y=e.y-r;break;case t.Direction.DOWN:e.x=e.x,e.y=e.y+r;break;case t.Direction.LEFT:e.y=e.y,e.x=e.x-r;break;case t.Direction.RIGHT:e.y=e.y,e.x=e.x+r}var s=this._pushBox(o,this._direction,e);return s||this._onWalkComplete(),s}if(o.objectType===t.MapItemType.FENCE&&this._checkCollision(o,e)&&o instanceof t.FenceObject&&o.upSate)return this._onWalkComplete(),!1}}return!0},i.prototype._pushBox=function(t,e,i){return!1},i.prototype.attack=function(t){var e=this._checkAttack(t);if(!e){if(t&&!this._inAttackScope(t)){if(this._moveSpd<=0)return;if(t===this._atkTarget&&null!==this._movePath)return;return void this._pursue(t)}this._atkCooling||this._attack(t)}},i.prototype.isPursue=function(e){return this.state===t.RoleState.pursue&&e===this._atkTarget&&null!==this._movePath?!0:!1},i.prototype._pursue=function(e){this._atkTarget=e,this.setState(t.RoleState.pursue),this.log("the target:"+e.id+" not in the attack scope! moving to target:"+e.id);var i=t.gameControl.inWhichGrid(e.x,e.y);this.walkTo(i)},i.prototype._checkAttack=function(e){var i=null;return this.state===t.RoleState.dead?(this._suspendMove(),this.idle(),i="you are dead!"):e?e===this?(this._suspendMove(),this.idle(),i="you cannot attack youself!"):e.atkSelect?e.state===t.RoleState.dead?(this._atkTarget=null,this._suspendMove(),this.idle(),i="target is dead!"):this.canSee(e)?i:(this._atkTarget=null,this._suspendMove(),this.idle(),i="the target:"+e.id+" not in the vision scope!"):(this._atkTarget=null,this._suspendMove(),this.idle(),i="the target:"+e.id+" can not be attacked"):(this._suspendMove(),this.idle(),i="target is not exist!")},i.prototype._attack=function(e){this._suspendMove(),this._atkTarget=e,this._attackClock.start(),this._atkCooling=!0,this.faceTo(e.currentGrid),this._animation.play(this._attack_animation_name,1);var i=t.config.getModById(this._roleCfg.modId);i.soundAtk&&cm.soundManager.playSound(i.soundAtk),this.bulletSpd>0&&this._shoot()},i.prototype._onAttackComplete=function(){},i.prototype._shoot=function(){var e=t.config.getModById(this.bulletMod),i=new t.Bullet(e,this);i.x=this.x,i.y=this.y,t.gameControl.addToObjectLayer(i)},i.prototype.say=function(e){var i=this;return this.state===t.RoleState.dead?void egret.log("i am dead"):(this._animation.showChatBubble(e),egret.log("id:"+this.id+" say:"+e),new Promise(function(n){setTimeout(function(){i.dispatchEvent(new t.CustomEvent(t.CustomEvent.SAY,e)),n()},2e3)}))},i.prototype.idle=function(){this._state=t.RoleState.idle,this._animation.play(this._idle_animation_name,0)},i.prototype.die=function(){this._state=t.RoleState.dead,this._animation.play(this._die_animation_name,1),this._animation.hideNameAndHpBar(),this._collisionArea&&(this._collisionArea.visible=!1),this._visionArea&&(this._visionArea.visible=!1);var e=t.config.getModById(this._roleCfg.modId);e.soundDie&&cm.soundManager.playSound(e.soundDie),this._suspendMove(),this.deactive(),this.dispatchEvent(new t.CustomEvent(t.CustomEvent.DEAD))},i.prototype.moveXY=function(e,i){return this._atkTarget=null,this.state===t.RoleState.dead?Promise.reject("i am dead"):this.walkTo({column:e,row:i})},i.prototype.moveDown=function(e){if(void 0===e&&(e=1),this._atkTarget=null,this.state===t.RoleState.dead)return Promise.reject("i am dead");e*=6;for(var i=this._currentGrid,n=i.column,o=i.row,r=[[n,o]],s=1;e>=s;s++){var a=[n,o+s];r.push(a)}return this._move(r)},i.prototype.moveRight=function(e){if(void 0===e&&(e=1),this._atkTarget=null,this.state===t.RoleState.dead)return Promise.reject("i am dead");e*=6;for(var i=this._currentGrid,n=i.column,o=i.row,r=[[n,o]],s=1;e>=s;s++){var a=[n+s,o];r.push(a)}return this._move(r)},i.prototype.moveUp=function(e){if(void 0===e&&(e=1),this._atkTarget=null,this.state===t.RoleState.dead)return Promise.reject("i am dead");e*=6;for(var i=this._currentGrid,n=i.column,o=i.row,r=[[n,o]],s=1;e>=s;s++){var a=[n,o-s];r.push(a)}return this._move(r)},i.prototype.moveLeft=function(e){if(void 0===e&&(e=1),this._atkTarget=null,this.state===t.RoleState.dead)return Promise.reject("i am dead");e*=6;for(var i=this._currentGrid,n=i.column,o=i.row,r=[[n,o]],s=1;e>=s;s++){var a=[n-s,o];r.push(a)}return this._move(r)},i.prototype.distanceTo=function(t){return this._getDistance(t)},i.prototype.findNearestEnemy=function(){var e=t.gameControl.objects,i=null,n=0;for(var o in e){var r=e[o];if(r.isActived&&r!==this&&r instanceof t.Npc&&r.camp===t.Camp.ENEMY&&r.state!==t.RoleState.dead){var s=this._getDistance(r);this.canSee(r)&&(!i||n>s)&&(i=r,n=s)}}return i},i.prototype.findNearestPlayer=function(){var e=t.gameControl.objects,i=null,n=0;for(var o in e){var r=e[o];if(r.isActived&&r!==this&&(r instanceof t.Hero||r instanceof t.Npc&&r.camp===t.Camp.FRIEND)){var s=this._getDistance(r);this.canSee(r)&&(!i||n>s)&&(i=r,n=s)}}return i},i.prototype.findNearestGem=function(){var e=t.gameControl.objects,i=null,n=-1;for(var o in e){var r=e[o];if(r.isActived&&r!==this&&r instanceof t.MapItem&&r.itemType==t.MapItemType.GEM){var s=this._getDistance(r);this.canSee(r)&&(!i||n>s)&&(i=r,n=s)}}return i},i.prototype.findNearestItem=function(){var e=t.gameControl.objects,i=null,n=-1;for(var o in e){var r=e[o];if(r.isActived&&r!==this&&r instanceof t.MapItem){var s=this._getDistance(r);this.canSee(r)&&(!i||n>s)&&(i=r,n=s)}}return i},i.prototype.getEnemyLevel=function(t){return t.level},i.prototype._stopPursue=function(){this._atkTarget=null,this._suspendMove(),this.idle()},i.prototype.onMove=function(){this.updateGrid()},i.prototype.faceTo=function(e){if(!(this._moveSpd<=0)){var i=this._direction;e.column>this._currentGrid.column?i=t.Direction.RIGHT:e.column<this._currentGrid.column?i=t.Direction.LEFT:e.row>this._currentGrid.row?i=t.Direction.DOWN:e.row<this._currentGrid.row&&(i=t.Direction.UP),i!==this._direction&&this.setDirection(i)}},i.prototype._onEnterFrame=function(){egret.getTimer();if(this._atkCooling&&this._attackClock.time>=1e3*this._atkSpd&&(this._attackClock.stop(),this._atkCooling=!1,this._onAttackComplete()),this._atkTarget&&this.faceTo(this._atkTarget.currentGrid),this.state===t.RoleState.pursue&&this._atkTarget&&this._movePath){var e=t.gameControl.inWhichGrid(this._atkTarget.x,this._atkTarget.y),i=this._movePath.getLastNode();if((e.column!==i.column||e.row!==i.row)&&(this.log("adjust moving path"),this.walkTo(e)),this.canSee(this._atkTarget)&&this._atkTarget.state!==t.RoleState.dead){var n=this._checkAttack(this._atkTarget);!n&&this._inAttackScope(this._atkTarget)&&!this._atkCooling&&this._attack(this._atkTarget)}else this._stopPursue()}var o=t.gameControl.objects;for(var r in o){var s=o[r];if(s.isActived&&s!==this){var a=this._getDistance(s);this._check(s,a)}}},i.prototype._inAttackScope=function(t){return this._getDistance(t)<=this._atkRange},i.prototype._check=function(t,e){},i.prototype._getVisionAngleRange=function(){var e=-this._visionAngle/2,i=this._visionAngle/2,n=0;switch(this._direction){case t.Direction.LEFT:n=180;break;case t.Direction.UP:n=-90;break;case t.Direction.RIGHT:n=0;break;case t.Direction.DOWN:n=90}return e+=n,i+=n,{startAngle:e,endAngle:i}},i.prototype._inVisionAngleRange=function(t,e){var i=this._getVisionAngleRange(),n=i.startAngle,o=i.endAngle,r=t-this.x,s=e-this.y,a=cm.Utils.mathAngleToRotation(r,s);return n>a?(a+=360,o>=a&&a>=n):a>o?(a-=360,o>=a&&a>=n):o>=a&&a>=n},i.prototype.canSee=function(t){var e=this._getDistance(t),i=e<=this._visionRange;if(!i)return!1;var n=this._inVisionAngleRange(t.x,t.y);return n?!this.hasInvisibleTile(t):!1},i.prototype.hasInvisibleTile=function(e){var i=this.currentGrid,n=e.currentGrid;return t.gameControl.hasInvisibleTile(i,n)},i.prototype._getDistance=function(t,e){e=e||{x:this.x,y:this.y};var i=egret.Point.distance(new egret.Point(e.x,e.y),new egret.Point(t.x,t.y));return i},i.prototype._checkCollision=function(t,e){var i=this._getDistance(t,e);return this.collisionRad+t.collisionRad>i},i.prototype._onTouchItem=function(t){},i.prototype.stop=function(){this._suspendMove(),this.state!==t.RoleState.dead&&this.idle()},i.prototype._suspendMove=function(){this._movePath&&this._movePath.suspend(),this._movePath=null},i.prototype.onNextGrid=function(e){return this.faceTo(e),t.gameControl.isWalkableInOriginalMap(e)},i.prototype.getTarget=function(){return this},i.prototype.getIdleAnimationName=function(){return"idle"},i.prototype.getWalkAnimationName=function(){return"walk"},i.prototype.getAttackAnimationName=function(){return"attack"},i.prototype.getDieAnimationName=function(){return"die"},i.prototype.onAttacked=function(e){this.setHp(this._hp-e.atkValue),this.log("attacked by "+e.id+",current hp:"+this.hp),this.dispatchEvent(new t.CustomEvent(t.CustomEvent.ATTACKED))},i.prototype._animationEventHandler=function(t){if(t.eventObject){var e=t.eventObject.name;"att"===e&&this._atkTarget&&this._atkTarget.onAttacked(this)}},i.prototype._animationCompleteHandler=function(t){if(t.eventObject&&t.eventObject.animationState){var e=t.eventObject.animationState.name;e===this._attack_animation_name&&this.idle()}},i.prototype._animationLoopCompleteHandler=function(t){},Object.defineProperty(i.prototype,"atkTarget",{get:function(){return this._atkTarget},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._scale},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"moveSpd",{get:function(){return this._moveSpd},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"atkSelect",{get:function(){return this._atkSelect},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hp",{get:function(){return this._hp},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"totalHp",{get:function(){return this._totalHp},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"level",{get:function(){return this._roleCfg.level
},enumerable:!0,configurable:!0}),i.prototype.setHp=function(t){this._hp=t,this._animation.hpBar&&(this._animation.hpBar.percent=this._hp/this.totalHp),this._hp<=0&&this.die()},Object.defineProperty(i.prototype,"collisionRad",{get:function(){return this._collisionRad},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visionAngle",{get:function(){return this._visionAngle},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visionRange",{get:function(){return this._visionRange},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"atkRange",{get:function(){return this._atkRange},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"atkValue",{get:function(){return this._atkValue},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"atkSpd",{get:function(){return this._atkSpd},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"defValue",{get:function(){return this._defValue},enumerable:!0,configurable:!0}),i.prototype.setState=function(t){this._state=t},Object.defineProperty(i.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bulletSpd",{get:function(){return this._roleCfg.bulletSpd},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bulletMod",{get:function(){return this._roleCfg.bulletMod},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"direction",{get:function(){return this._direction},enumerable:!0,configurable:!0}),i.prototype.log=function(t){egret.log("id:"+this.id+","+t)},i.prototype.playEffect=function(t){var e=new clib.Armtrue(t);e.x=this._animation.anchorOffsetX,e.y=this._animation.anchorOffsetY,this._animation.addChild(e),e.play("animation",1),e.onceAnimComplete(function(){e.parent&&e.parent.removeChild(e)})},i}(t.GameObject);t.GameRole=e,__reflect(e.prototype,"codearena.GameRole",["codearena.Moveable"])}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(i){var n=e.call(this,i)||this;return n._config=t.config.getMapItemById(i.typeId),n._collisionRad=n._config.collisionRad,n._objectType=n._config.type,n._atkSelect=!!n._config.atkSelect,n._isObstacle=n._config.type===t.MapItemType.BOX,n.initView(),n}return __extends(i,e),i.prototype.initView=function(){var e,i,n=t.config.getModById(this._config.modId),o=new t.Character;n.type===t.ResType.DRAGON_BONES?(e=.5,i=1):(e=.5,i=.5),o.anchorX=n.anchorX?n.anchorX:e,o.anchorY=n.anchorY?n.anchorY:i,this.setView(o)},i.prototype._onAnimationLoaded=function(e){this._view.removeEventListener(egret.Event.COMPLETE,this._onAnimationLoaded,this);var i=this._view;t.Global.LOCAL_DEBUG&&this._drawDebug(),i.play("idle",0)},i.prototype.active=function(i){e.prototype.active.call(this,i);var n=t.config.getModById(this._config.modId);this._view.addEventListener(egret.Event.COMPLETE,this._onAnimationLoaded,this),this._view.setModScale(this._config.scale),this._view.init(n,"",!!this._config.atkSelect,this._view.anchorX,this._view.anchorY),this._config.type===t.MapItemType.BUTTON&&(this._view.visible=!0)},i.prototype.deactive=function(){e.prototype.deactive.call(this),this._config.type===t.MapItemType.BUTTON&&(this._view.visible=!1)},i.prototype.destroy=function(){if(e.prototype.destroy.call(this),this._view instanceof t.Character){t.config.getModById(this._config.modId);this._view.removeEventListener(egret.Event.COMPLETE,this._onAnimationLoaded,this)}},i.prototype.playSound=function(){var e=t.config.getModById(this._config.modId);e.sound&&cm.soundManager.playSound(e.sound)},Object.defineProperty(i.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layer",{get:function(){var e=t.config.getMapItemById(this._cfg.typeId).type;return e===t.MapItemType.HEAL||e===t.MapItemType.BUTTON?t.GameLayer.Surface:this._layer},enumerable:!0,configurable:!0}),i.prototype._onGridChange=function(){this._isObstacle&&t.gameControl.updateGrid(),e.prototype._onGridChange.call(this)},Object.defineProperty(i.prototype,"itemType",{get:function(){return this._config.type},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"subtype",{get:function(){return this._config.subtype},enumerable:!0,configurable:!0}),i}(t.GameObject);t.MapItem=e,__reflect(e.prototype,"codearena.MapItem")}(codearena||(codearena={}));var cval;!function(t){var e=function(){function t(){this._isUpdate=!0}return Object.defineProperty(t.prototype,"pause",{get:function(){return this._pause},set:function(t){this._pause=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUpdate",{get:function(){return this._isUpdate},set:function(t){this._isUpdate=t},enumerable:!0,configurable:!0}),t.prototype.dispatchEventWith=function(t,e,i,n){this._getDispatch().dispatchEventWith(t,e,i,n)},t.prototype.addEventListener=function(t,e,i,n,o){this._getDispatch().addEventListener(t,e,i,n,o)},t.prototype.removeEventListener=function(t,e,i,n){this._getDispatch().removeEventListener(t,e,i,n)},t.prototype.once=function(t,e,i,n,o){this._getDispatch().once(t,e,i,n,o)},t.prototype._getDispatch=function(){return null==this._dispatch&&(this._dispatch=new egret.EventDispatcher),this._dispatch},t.prototype.onUpdate=function(){},t.prototype.byCreate=function(t){this._byCreate=t},t.prototype.byDestroy=function(t){this._byDesroy=t},t.prototype.create=function(){this.onCreate(),this._byCreate&&this._byCreate()},t.prototype.destroy=function(){this.onDestroy(),this._byDesroy&&this._byDesroy()},t}();t.Entity=e,__reflect(e.prototype,"cval.Entity")}(cval||(cval={}));var cm;!function(t){var e=function(t){function e(e){var i=t.call(this)||this;return i._skinName="",i._args=null,i._args=e,i}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),egret.log("scene children created")},e.prototype.loadRes=function(t,e,i){var n=this;void 0===e&&(e=[]),void 0===i&&(i=[]),this.loadDynamicImage(i).then(function(){n.loadResInConfig(t,e)})},e.prototype.loadResInConfig=function(t,e){var i=RES.getGroupByName(t).map(function(t){return t.name}),n="dynamic_group",o=i.concat(e);RES.createGroup(n,o,!0),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadErr,this),RES.loadGroup(n)},e.prototype.loadDynamicImage=function(t){return Promise.all(t.map(function(t){return new Promise(function(e,i){RES.getResByUrl(t,e,null,RES.ResourceItem.TYPE_IMAGE)})}))},e.prototype.onLoaded=function(){},e.prototype.onRemove=function(){t.prototype.onRemove.call(this),this.removeEventListener(eui.UIEvent.COMPLETE,this.onSkinComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadErr,this)},e.prototype.onResourceLoadComplete=function(t){"dynamic_group"===t.groupName&&(egret.log("load scene resource compelte"),this._skinName?this.applySkin(this._skinName):this.onLoaded())},e.prototype.onResourceProgress=function(t){"dynamic_group"===t.groupName&&this.onProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.onProgress=function(t,e){},e.prototype.onResourceLoadErr=function(t){egret.log("load scene resource error")},e.prototype.applySkin=function(t){egret.log("set scene skin"),this.addEventListener(eui.UIEvent.COMPLETE,this.onSkinComplete,this),this.skinName=t},e.prototype.onSkinComplete=function(){egret.log("load scene skin compelte"),this.removeEventListener(eui.UIEvent.COMPLETE,this.onSkinComplete,this),this.onLoaded()},e.prototype.exit=function(){return Promise.resolve()},e}(t.AutoLayoutView);t.BaseScene=e,__reflect(e.prototype,"cm.BaseScene")}(cm||(cm={}));var codearena;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._nickname="",e._gender="male",e._max_level=6,e._current_level=0,e._gold=0,e._uid=0,e._game_uid=0,e._score=0,e._isChallengeStarted=!1,e._headImg="",e._registed=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"max_level",{get:function(){return this._max_level},set:function(t){this._max_level=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"score",{get:function(){return this._score},set:function(t){this._score=t,this.dispatch(e.UPDATED_GAME_INFO)},enumerable:!0,configurable:!0}),e.prototype.setUserData=function(t){this._platNickName=t.nickname||t.nickName,this._sex=t.sex,this._gold=t.gold,this._uid=t.id,this._headImg=t.avatar_url,this.dispatch(e.UPDATED_USER_INFO)},e.prototype.setGameData=function(t){this._registed=!0,this._gameNickName=t.gameRole,this._game_uid=t.user_id,this._current_level=t.current_level_id,this._max_level=t.max_level_id,this._gender=t.gender,this.avatar_url=t.portraitUrl,this.iseditGender=t.iseditGender,this.dispatch(e.UPDATED_GAME_INFO)},Object.defineProperty(e.prototype,"isChallengeStarted",{get:function(){return this._isChallengeStarted},set:function(t){this._isChallengeStarted=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"current_level",{get:function(){return this._current_level},set:function(t){this._current_level=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nickname",{get:function(){return this._gameNickName||this._platNickName},set:function(t){this._nickname=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sex",{get:function(){return this._sex},set:function(t){this._sex=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gold",{get:function(){return this._gold},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headImg",{get:function(){return this._headImg},set:function(t){this._headImg=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"registed",{get:function(){return this._registed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gender",{get:function(){return this._gender},set:function(t){this._gender=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"game_uid",{get:function(){return this._game_uid},enumerable:!0,configurable:!0}),e.UPDATED_USER_INFO="updated_user_info",e.UPDATED_GAME_INFO="updated_game_info",e.MALE="male",e.FEMALE="female",e}(t.Dispacher);t.User=e,__reflect(e.prototype,"codearena.User")}(codearena||(codearena={}));var codearena;!function(t){function e(t,e){return n.x=t,n.y=e,n}function i(t,e){return o.x=t,o.y=e,o}var n=new egret.Point,o=new egret.Point,r=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._from={x:0,y:0},e._to={x:0,y:0},e._speed=0,e._dis=0,e._validateFunc=null,e._finishFunc=null,e._changeFunc=null,e._onSuspend=null,e._target=null,e._lastTickTime=0,e._moved=0,e}return __extends(n,t),n.prototype.init=function(t,n,o,r,s,a,c,h){this._target=t,this._from={x:t.x,y:t.y},this._to=n,this._moved=o,this._dis=egret.Point.distance(e(this._from.x,this._from.y),i(n.x,n.y)),this._speed=r,this._validateFunc=s,this._finishFunc=a,this._changeFunc=h,this._onSuspend=c,this._lastTickTime=egret.getTimer(),this.addEventListener(egret.Event.ENTER_FRAME,this.onUpdate,this)},n.prototype.onCreate=function(){},n.prototype.onDestroy=function(){},n.prototype.onUpdate=function(){var t=egret.getTimer(),e=t-this._lastTickTime;this._lastTickTime=t,e=e>100?100:e;var i=this._speed*e/1e3,n=i+this._moved-this._dis;if(n>0)return void this._finishFunc(n);this._moved+=i;var o=this._moved/this._dis,r=this._from.x+(this._to.x-this._from.x)*o,s=this._from.y+(this._to.y-this._from.y)*o,a=this._validateFunc({x:r,y:s});a?(this._target.x=r,this._target.y=s,this._changeFunc(),0===n&&this._finishFunc(0)):this._onSuspend()},n.moveTo=function(t,e,i,o,r,s,a,c){var h=new n;return h.init(t,e,i,o,r,s,a,c),h},n.prototype.stop=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.onUpdate,this)},n}(egret.DisplayObject);__reflect(r.prototype,"Tween");var s=function(){function n(t,e,i,n,o,r){this._path=null,this._target=null,this._resolve=null,this._reject=null,this._speed=0,this._step=0,this._moveValidator=null,this._curTween=null,this._moving=!1,this._from={x:0,y:0},this._to={x:0,y:0},this._dis=0,this._lastTickTime=0,this._moved=0,this._path=e,this._target=t,this._speed=i,this._resolve=o,this._reject=r,this._moveValidator=n,this._move()}return n.move=function(t,e,i,o,r,s){return new n(t,e,i,o,r,s)},n.prototype.suspend=function(){this._stopMove(),this._reject&&this._reject(),this._reject=null,this._resolve=null,this._target=null,this._path=null},n.prototype.getLastNode=function(){var t=this._path[this._path.length-1];return{column:t[0],row:t[1]}},n.prototype._move=function(t){if(void 0===t&&(t=0),null===this._path)return void egret.log("path is null");if(this._step++,this._step>this._path.length-1)this._resolve();else{var e=this._path[this._step],i={column:e[0],row:e[1]},n=this._target.onNextGrid(i);if(!n)return void this.suspend();this._startMove(i,t)}},n.prototype._startMove=function(n,o){var r=this._target.getTarget().view;this._lastTickTime=egret.getTimer(),this._from={x:r.x,y:r.y},this._to=t.gameControl.getGridCenter(n.column,n.row),this._moved=o;var s=e(this._from.x,this._from.y),a=i(this._to.x,this._to.y);this._dis=egret.Point.distance(s,a),this._moving||(r.addEventListener(egret.Event.ENTER_FRAME,this._enterFrame,this),this._moving=!0)},n.prototype._enterFrame=function(t){if(!this._target)return void egret.warn("null target");var e=egret.getTimer(),i=e-this._lastTickTime;this._lastTickTime=e,i=i>100?100:i;var n=this._speed*i/1e3,o=n+this._moved-this._dis;if(o>0)return void this._move(o);this._moved+=n;var r=this._moved/this._dis,s=this._from.x+(this._to.x-this._from.x)*r,a=this._from.y+(this._to.y-this._from.y)*r,c=this._moveValidator({x:s,y:a});if(c){var h=this._target.getTarget();h.x=s,h.y=a,this._onChange(),0===o&&this._move(0)}else this.suspend()},n.prototype._stopMove=function(){if(this._target){var t=this._target.getTarget().view;t&&t.removeEventListener(egret.Event.ENTER_FRAME,this._enterFrame,this)}},n.prototype._onChange=function(){null===this._target?egret.log("target is null"):this._target.onMove()},n}();t.GridPathMove=s,__reflect(s.prototype,"codearena.GridPathMove")}(codearena||(codearena={}));var cm;!function(t){var e=function(){function t(t,e,i,n,o){void 0===i&&(i=1),void 0===n&&(n=0),void 0===o&&(o=!1),this._target=null,this._callback=null,this._interval=0,this._repeat=0,this._timepassed=0,this._times=0,this._canPause=!1,this._target=t,this._callback=e,this._interval=i,this._repeat=n,this._canPause=o}return t.prototype.reset=function(t,e){this._interval=t,this._repeat=e,this._times=0,this._timepassed=0},t.prototype.match=function(t,e){return this._target===t&&this._callback===e},t.prototype.update=function(t){return this._canPause&&(t=t>100?100:t),this._timepassed+=t,this._timepassed>=this._interval&&(this._times++,this._timepassed=0,this._callback.call(this._target)),0!==this._repeat&&this._times>=this._repeat?!1:!0},t}();__reflect(e.prototype,"Scheduler");var i=function(){function t(){this._schedulers=[],this._timeStamp=0,this._ticking=!1}return t.prototype._tick=function(t){var e=t-this._timeStamp;this._timeStamp=t;for(var i=this._schedulers.length,n=i-1;n>=0;n--){var o=this._schedulers[n];if(o){var r=o.update(e);r||this._schedulers.splice(n,1)}}return 0===this._schedulers.length&&this.stopTick(),!1},t.prototype.startTick=function(){this._ticking||(egret.startTick(this._tick,this),this._timeStamp=egret.getTimer(),this._ticking=!0)},t.prototype.stopTick=function(){this._ticking&&(egret.stopTick(this._tick,this),this._ticking=!1)},t.prototype.schedule=function(t,i,n,o,r){void 0===o&&(o=0),void 0===r&&(r=!1);var s=this._getIndexOfScheduler(t,i);if(s>=0){var a=this._schedulers[s];a.reset(n,o)}else this._schedulers.push(new e(t,i,n,o,r));this._schedulers.length>0&&this.startTick()},t.prototype.unschedule=function(t,e){var i=this._getIndexOfScheduler(t,e);i>=0&&this._schedulers.splice(i,1)},t.prototype._getIndexOfScheduler=function(t,e){for(var i=0;i<this._schedulers.length;i++){var n=this._schedulers[i];if(n.match(t,e))return i}return-1},t}();__reflect(i.prototype,"ScheduleManager"),t.scheduler=new i}(cm||(cm={}));var cm;!function(t){var e=function(){function t(){this._timer=null,this._callback=null,this._startTime=0,this._timePassed=0}return t.prototype.start=function(t){this.stop(),this._startTime=egret.getTimer(),this._timer||(this._timer=new egret.Timer(1e3)),this._callback=t,this._timer.addEventListener(egret.TimerEvent.TIMER,this._onTick,this),this._timer.start()},t.prototype.stop=function(){this._timer&&(this._timer.stop(),this._timer.removeEventListener(egret.TimerEvent.TIMER,this._onTick,this)),this._callback=null},Object.defineProperty(t.prototype,"timePassed",{get:function(){return this._timePassed},enumerable:!0,configurable:!0}),t.prototype._onTick=function(){this._timePassed=Math.floor((egret.getTimer()-this._startTime)/1e3),this._callback&&this._callback()},t}();t.Ticker=e,__reflect(e.prototype,"cm.Ticker")}(cm||(cm={}));var codearena;!function(t){var e={bg:!1,clickBgClose:!1,closeOnViewTapped:!1,addToMain:!0},i=function(t){function i(i,n){var o=t.call(this)||this;o._hasBg=!0,o._clickBgClose=!0,o._showComplete=!1,o._closeOnViewTapped=!1,o._opt=null,n=Object.assign({},e,n),o._opt=n,o._hasBg=n.bg,o._clickBgClose=n.clickBgClose,o._closeOnViewTapped=n.closeOnViewTapped;var r=cm.main.stage.stageWidth,s=cm.main.stage.stageHeight;if(o.width=r,o.height=s,o._content=i,i instanceof eui.Component){var a=n.pos;a?(void 0!==a.left&&(i.left=a.left),void 0!==a.top&&(i.top=a.top),void 0!==a.right&&(i.right=a.right),void 0!==a.bottom&&(i.bottom=a.bottom)):(i.horizontalCenter=0,i.verticalCenter=0)}else i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.x=r/2,i.y=s/2;return o._hasBg&&o.createBg(),o.addChild(i),o}return __extends(i,t),i.show=function(t,e){var n=new i(t,e);return n.show(),n},i.prototype.createBg=function(){var t=cm.main.stage.stageWidth,e=cm.main.stage.stageHeight;this._bg=new egret.Sprite,this._bg.touchEnabled=!0,this._bg.graphics.beginFill(0,1),this._bg.graphics.drawRect(0,0,t,e),this._bg.graphics.endFill(),this._bg.width=t,this._bg.height=e,this.addChild(this._bg)},i.prototype.onBgTap=function(){this._clickBgClose&&this.hide()},i.prototype.hide=function(){var t=this;egret.Tween.removeTweens(this._content);var e=egret.Tween.get(this._content);if(e.to({scaleX:0,scaleY:0,alpha:0},200,egret.Ease.backOut).call(function(){t.stage&&t.parent.removeChild(t)}),this._bg){egret.Tween.removeTweens(this._bg);var i=egret.Tween.get(this._bg);this._bg.alpha=.3,i.to({alpha:0},200)}},i.prototype.show=function(){this._opt.addToMain?cm.main.addChild(this):cm.sceneManager.currentScene.addChild(this),this._content.scaleX=this._content.scaleX=0,this._content.alpha=0,egret.Tween.removeTweens(this._content);var t=egret.Tween.get(this._content);if(t.to({scaleX:1,scaleY:1,alpha:1},300,egret.Ease.backOut).call(this.onShowComplete,this),this._bg){this._bg.alpha=0,egret.Tween.removeTweens(this._bg);var e=egret.Tween.get(this._bg);e.to({alpha:.3},300)}},i.prototype.onShowComplete=function(){this._showComplete=!0;var t=this._content.onShowComplete;t&&t.call(this._content)},Object.defineProperty(i.prototype,"showComplete",{get:function(){return this._showComplete},enumerable:!0,configurable:!0}),i.prototype.onAdd=function(){t.prototype.onAdd.call(this),this._bg&&this._hasBg&&this._bg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBgTap,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onViewTap,this)},i.prototype.onRemove=function(){t.prototype.onRemove.call(this),this._bg&&this._hasBg&&this._bg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBgTap,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onViewTap,this),this._bg=null,this._content=null},i.prototype.onViewTap=function(t){this._closeOnViewTapped?this.hide():t.stopPropagation()},i}(cm.AutoLayoutView);t.Alert=i,__reflect(i.prototype,"codearena.Alert")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i._data=null,i._data=t,i.skinName="ConfirmDialog",i}return __extends(i,e),i.show=function(e,n){var o=new i(e);return t.Alert.show(o,n)},i.prototype.onComplete=function(){e.prototype.onComplete.call(this),this.top=this.right=this.bottom=this.left=0,this.content.text=this._data.content,this.currentState=this._data.cancel?"hasCancel":"noCancel",this._data.ok&&(this.okBtn.label=this._data.ok.text,this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOK,this)),this._data.cancel&&(this.cancelBtn.label=this._data.cancel.text,this.cancelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancel,this))},i.prototype.onOK=function(){this.hide(),t.Sound.button(),this._data.ok.callback&&this._data.ok.callback()},i.prototype.onCancel=function(){t.Sound.button(),this.hide(),this._data.cancel.callback&&this._data.cancel.callback()},i.prototype.hide=function(){var t=this.parent;console.log(t),t.hide()},i}(cm.EUIComponent);t.ConfirmDialog=e,__reflect(e.prototype,"codearena.ConfirmDialog")}(codearena||(codearena={}));var cm;!function(t){var e=function(){function e(t,e){this._time=0,this._text="",this._text=e,this._target=t,this._target.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)}return e.prototype.onRemove=function(){this._target.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.stopTimer()},e.prototype.cooldown=function(t){this._time=t,this._time>0&&(this.startTimer(),this.updateText())},e.prototype.startTimer=function(){this._timer||(this._timer=new t.Ticker),this._timer.start(this.tick.bind(this))},e.prototype.stopTimer=function(){this._timer&&this._timer.stop()},e.prototype.tick=function(){this._time-this._timer.timePassed;this._time>=0?this.updateText():(this.updateText(),this.stopTimer())},e.prototype.normal=function(){this._target.label=this._text,this._target.enabled=!0,this.stopTimer()},e.prototype.updateText=function(){var e=this._time-this._timer.timePassed;e>=0?(this._target.label=t.Utils.formatTime2(e),this._target.enabled=!1):(this._target.label=this._text,this._target.enabled=!0)},e}();t.CooldownButton=e,__reflect(e.prototype,"cm.CooldownButton")}(cm||(cm={}));var cm;!function(t){var e=function(){function t(){this._prevX=0,this._prevY=0,this._isDraging=!1}return t.prototype.enableDrag=function(t,e){this._target=t,this._parent=t.parent,this._parent.touchEnabled=!0,this._rect=e,this._prevX=0,this._prevY=0,this._parent.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onTouchBegin,this),this._parent.addEventListener(egret.TouchEvent.TOUCH_MOVE,this._onTouchMove,this),this._parent.addEventListener(egret.TouchEvent.TOUCH_END,this._onTouchEnd,this),this._parent.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this._onTouchEnd,this)},t.prototype.disableDrag=function(){this._isDraging=!1,this._parent&&(this._parent.touchEnabled=!1,this._parent.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onTouchBegin,this),this._parent.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this._onTouchMove,this),this._parent.removeEventListener(egret.TouchEvent.TOUCH_END,this._onTouchEnd,this),this._parent.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this._onTouchEnd,this))},t.prototype.updateRect=function(t){this._rect=t},t.prototype.stop=function(){this._onTouchEnd()},Object.defineProperty(t.prototype,"isDraging",{get:function(){return this._isDraging},enumerable:!0,configurable:!0}),t.prototype._onTouchBegin=function(t){this._prevX=t.stageX,this._prevY=t.stageY,this._isDraging=!0},t.prototype._onTouchMove=function(t){if(this._isDraging){var e=t.stageX-this._prevX,i=t.stageY-this._prevY;this._prevX=t.stageX,this._prevY=t.stageY;var n=this._target.x,o=this._target.y;this._rect.width<this._target.width&&(n+e>this._rect.x?n=this._rect.x:n+e<this._rect.width-this._target.width?n=this._rect.width-this._target.width:n+=e),this._rect.height<this._target.height&&(o+i>this._rect.y?o=this._rect.y:o+i<this._rect.height-this._target.height?o=this._rect.height-this._target.height:o+=i),this._target.x=n,this._target.y=o}},t.prototype._onTouchEnd=function(){this._isDraging=!1},t}();t.Dragable=e,__reflect(e.prototype,"cm.Dragable")}(cm||(cm={}));var ForumPage=function(t){function e(){var e=t.call(this)||this;return e.skinName="ForumPageSkin",e}return __extends(e,t),e.prototype.onComplete=function(){t.prototype.onComplete.call(this)},e}(cm.AutoLayoutView);__reflect(ForumPage.prototype,"ForumPage",["eui.UIComponent","egret.DisplayObject"]);var cm;!function(t){var e=function(t){function e(e,i,n,o,r,s,a){var c=t.call(this)||this;return c._step=50,c._miniHeight=35,c._prevX=0,c._prevY=0,c.up=n,c.down=o,c.bar=r,c.barArea=s,c._scroller=e,c._container=i,a&&(void 0!==a.minHeight&&(c._miniHeight=a.minHeight),void 0!==a.step&&(c._step=a.step)),c}return __extends(e,t),e.prototype.enable=function(){egret.log("init scrollbar"),this.validateNow(),this.up&&this.up.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onUpTap,this),this.down&&this.down.addEventListener(egret.TouchEvent.TOUCH_TAP,this.ondownTap,this),this.bar&&this.bar.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBarBegin,this),this.bar&&this.bar.addEventListener(egret.TouchEvent.TOUCH_END,this.onBarEnd,this),this.bar&&this.bar.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onBarCancel,this),this.bar&&this.bar.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onBarReleaseOutside,this),this.bar&&this._container.addEventListener(eui.UIEvent.RESIZE,this.onResize,this),this.bar&&this._scroller.addEventListener(egret.Event.CHANGE,this.onScroll,this),this.resizeBar(),this.bar.top=0},e.prototype.disable=function(){t.prototype.onRemove.call(this),this.up&&this.up.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onUpTap,this),this.down&&this.down.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.ondownTap,this),this.bar&&this.bar.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBarBegin,this),this.bar&&this.bar.removeEventListener(egret.TouchEvent.TOUCH_END,this.onBarEnd,this),this.bar&&this.bar.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onBarMove,this),this.bar&&this.bar.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onBarCancel,this),this.bar&&this.bar.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onBarReleaseOutside,this),this._container&&this._container.removeEventListener(eui.UIEvent.RESIZE,this.onResize,this),this._scroller&&this._scroller.removeEventListener(egret.Event.CHANGE,this.onScroll,this)},e.prototype.onScroll=function(t){egret.log("on scroll"),this.updateScrollBar()},e.prototype.onResize=function(t){egret.log("on resize"),this.resizeBar(),this.move(0)},e.prototype.resizeBar=function(){if(this._scroller&&this.bar&&this.barArea){this._scroller.viewport.validateNow();var t=this._scroller.height/this._scroller.viewport.measuredHeight*this.barArea.height;t<this._miniHeight&&(t=this._miniHeight),t>this.barArea.height&&(t=this.barArea.height),this.bar.height=t}},e.prototype.onUpTap=function(){this.move(-this._step)},e.prototype.ondownTap=function(){this.move(this._step)},e.prototype.onBarBegin=function(t){this.bar.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onBarMove,this),this._prevX=t.stageX,this._prevY=t.stageY},e.prototype.onBarEnd=function(){this.bar.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onBarMove,this)},e.prototype.onBarMove=function(t){var e=t.stageY-this._prevY;this.move(e),this._prevX=t.stageX,this._prevY=t.stageY},e.prototype.move=function(t){egret.log("move:"+t);var e=this.bar.top+t;0>e?this.bar.top=0:e>this.barArea.height-this.bar.height?this.bar.top=this.barArea.height-this.bar.height:this.bar.top=e,this.updateScroll()},e.prototype.updateScroll=function(){var t=this.bar.top/(this.barArea.height-this.bar.height);this._scroller.viewport.scrollV=t*(this._scroller.viewport.contentHeight-this._scroller.height)},e.prototype.updateScrollBar=function(){var t=this._scroller.viewport.scrollV/(this._scroller.viewport.contentHeight-this._scroller.height);0>t&&(t=0),t>1&&(t=1);var e=t*(this.barArea.height-this.bar.height);this.bar.top=e},e.prototype.onBarCancel=function(){this.bar.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onBarMove,this)},e.prototype.onBarReleaseOutside=function(){this.bar.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onBarMove,this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(t.EUIComponent);t.ScrollBar=e,__reflect(e.prototype,"cm.ScrollBar",["eui.UIComponent","egret.DisplayObject"])}(cm||(cm={}));var cm;!function(t){var e={placeHolder:"",placeHolderColor:9859143,errorColor:13390940,textColor:9859143,maxChar:10},i=function(){function t(t,i){void 0===i&&(i=e),this._clearWhenFocusIn=!0,this._option=Object.assign({},e,i),this._target=t,this._target.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this._target.addEventListener(egret.TextEvent.FOCUS_IN,this.focusIn,this),this._target.addEventListener(egret.TextEvent.FOCUS_OUT,this.focusOut,this),this._target.addEventListener(egret.TextEvent.CHANGE,this.onchange,this),this.setHolderplace()}return t.prototype.onchange=function(t){var e=this._target.text;e.length>this._option.maxChar&&(e=e.substr(0,this._option.maxChar),this._target.text=e)},t.prototype.focusIn=function(){this._clearWhenFocusIn&&(this._target.text="",this._target.textColor=this._option.textColor,this._clearWhenFocusIn=!1)},t.prototype.setHolderplace=function(){this._target.text=this._option.placeHolder,this._target.textColor=this._option.placeHolderColor,this._clearWhenFocusIn=!0},Object.defineProperty(t.prototype,"clearWhenFocusIn",{get:function(){return this._clearWhenFocusIn},enumerable:!0,configurable:!0}),t.prototype.focusOut=function(){var t=this._target.text;""===t.trim()&&this.setHolderplace()},t.prototype.onRemove=function(){this._target.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this._target.removeEventListener(egret.TextEvent.FOCUS_IN,this.focusIn,this),this._target.removeEventListener(egret.TextEvent.FOCUS_OUT,this.focusOut,this),this._target.removeEventListener(egret.TextEvent.CHANGE,this.onchange,this)},t.prototype.error=function(t){this._target.textColor=this._option.errorColor,this._target.text=t,this._clearWhenFocusIn=!0},t}();t.TextInput=i,__reflect(i.prototype,"cm.TextInput")}(cm||(cm={}));var cm;!function(t){var e=16777215,i=4,n=0,o=16,r=function(r){function s(){var t=r.call(this)||this;return t._bg=new egret.Sprite,t.addChild(t._bg),t._txt=new eui.Label,t._txt.size=o,t._txt.textColor=n,t._txt.textAlign=egret.HorizontalAlign.CENTER,t._txt.verticalAlign=egret.VerticalAlign.MIDDLE,t.addChild(t._txt),t}return __extends(s,r),s.show=function(e,i,n,o,r){s.instance||(s.instance=new s),s.instance.text=e,s.instance.anchorOffsetX=o*s.instance.width,s.instance.anchorOffsetY=r*s.instance.height,s.instance.x=i,s.instance.y=n,t.main.stage.addChild(s.instance)},s.hide=function(){s.instance&&s.instance.parent&&s.instance.parent.removeChild(s.instance)},Object.defineProperty(s.prototype,"text",{set:function(t){this._txt.text=t,this._txt.validateSize(),this._txt.validateDisplayList();var n=this._txt.textWidth+12,o=this._txt.textHeight+6,r=this._bg.graphics;r.clear(),r.beginFill(e),r.drawRoundRect(0,0,n,o,i,i),r.endFill(),this._txt.x=6,this._txt.y=3},enumerable:!0,configurable:!0}),s}(eui.Component);t.Tip=r,__reflect(r.prototype,"cm.Tip")}(cm||(cm={}));var cm;!function(t){var e=function(){function t(){this._objs={}}return t.prototype.put=function(t,e){this._objs[t]||(this._objs[t]=[]),e.cache(),this._objs[t].length>100&&console.warn('"'+t+'" object cached over 50'),this._objs[t].push(e)
},t.prototype.get=function(t){var e=t.prototype.__class__,i=this._objs[e];if(i&&i.length>0){var n=i.pop();return n.reuse(),n}return t?new t:null},t}();__reflect(e.prototype,"CachePool"),t.cachePool=new e}(cm||(cm={}));var cm;!function(t){var e=function(){function t(){}return t.getDragonBonesRes=function(t){var e=[];return t.forEach(function(t){e.push.apply(e,[t+"_ske_json",t+"_tex_json",t+"_tex_png"])}),e},t.getQueryParam=function(t){var e=window.location.search.match(new RegExp("(\\?|&)"+t+"(\\[\\])?=([^&]*)"));return e?e[3]:!1},t.serializeParam=function(t){var e="";for(var i in t){var n=t[i];void 0!==n&&null!==n&&(e+=(""===e?"?":"&")+i+"="+n)}return e},t.formatTime=function(t){var e="",i=86400,n=t>i?Math.floor(t/i):0;t%=i;var o=3600,r=t>o?Math.floor(t/o):0;t%=o;var s=t>60?Math.floor(t/60):0;return t%=60,n>0&&(e+=n+"天 "),e+=10>r?"0"+r:r,e+=":",e+=10>s?"0"+s:s,e+=":",e+=10>t?"0"+t:t},t.formatTime2=function(t){var e="",i=t>60?Math.floor(t/60):0;return t%=60,e=10>i?"0"+i:i+"",e+=":",e+=10>t?"0"+t:t},t.sortOrder=function(t,e){e.sort(function(t,e){return t.y>e.y?1:t.y<e.y?-1:0});var i=e.map(function(e){return t.getChildIndex(e)});i.sort(),e.forEach(function(e,n){t.setChildIndex(e,i[n])})},t.setAnchor=function(t,e,i){t.anchorOffsetX=t.width*e,t.anchorOffsetY=t.height*i},t.delay=function(t,e){var i=new egret.Timer(t,1),n=function(){i.removeEventListener(egret.TimerEvent.TIMER,n,this),e()};i.addEventListener(egret.TimerEvent.TIMER,n,this),i.start()},t.fitScale=function(t,e,i,n,o){if(void 0===o&&(o=!1),t>=i&&e>=n&&!o)return 1;var r=t/i,s=e/n;return s>r?r:s},t.stringEllipsis=function(t,e){return t.length>e?(t=t.substr(0,e),t+="."):t},t.IsPC=function(){for(var t=navigator.userAgent,e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],i=!0,n=0;n<e.length;n++)if(t.indexOf(e[n])>0){i=!1;break}return i},t.urlToResName=function(t){var e=t.lastIndexOf("/");return-1!==e&&(t=t.substring(e+1)),t.replace(".","_")},t.mathAngleToRotation=function(t,e){var i=180*Math.atan2(t,e)/Math.PI;if(180>=i&&i>90)return 450-i;if(i>-180&&90>=i)return 90-i;throw new Error("error angle range!")},t.loadScript=function(e,i){var n=0,o=function(){t.loadSingleScript(e[n],function(){n++,n>=e.length?i():o()})};o()},t.loadSingleScript=function(t,e){var i=document.createElement("script");i.async=!1,i.src=t,i.addEventListener("load",function(){i.parentNode.removeChild(i),i.removeEventListener("load",arguments.callee,!1),e()},!1),document.body.appendChild(i)},t}();t.Utils=e,__reflect(e.prototype,"cm.Utils")}(cm||(cm={}));var cnUtils;!function(t){function e(t,e,i){t?t.addEventListener(egret.TouchEvent.TOUCH_TAP,e,i):egret.error("target is null!")}function i(t,e,i){t?t.addEventListener(eui.ItemTapEvent.ITEM_TAP,e,i):egret.error("target is null!")}function n(t,e,i){t?t.once(egret.TouchEvent.TOUCH_TAP,e,i):egret.error("target is null!")}function o(){tiled.getRes=function(e,i,n,o){var r=e.lastIndexOf("/"),s=e.slice(r+1);s=s.replace(".","_"),e=t.getRESUrlByKey(s),RES.getResByUrl(e,i,n,o),console.log(e)}}function r(t,e){var i=egret.localStorage.getItem(t)||e;return i=JSON.parse(i)}function s(t,e){var i=JSON.stringify(e);egret.localStorage.setItem(t,i)}function a(){u={};for(var t=window.location.search.substr(1),e=t.split("&"),i=0,n=e.length;n>i;i++){var o=e[i],r=o.split("="),s=r[0],a=r[1];u[s]=a}}function c(t){return null==u&&a(),u[t]}function h(){return egret.Capabilities.isMobile||c("isMobile")}function l(){return egret.Capabilities.isMobile&&window.cordova}function p(t){var e=RES.configInstance.keyMap;return e[t]?e[t].url:t}t.touchTap=e,t.onItemTap=i,t.onceTouchTap=n,t.hackEngine=o,t.getLocalStorage=r,t.setLocalStorage=s;var u;t.anyaQueryParam=a,t.getQuery=c,t.IS_Mobile=h,t.IS_SDK=l,t.getRESUrlByKey=p}(cnUtils||(cnUtils={}));var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function o(t){e.call(n,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var cm;!function(t){function e(e){t.main=e}t.main=null,t.init=e}(cm||(cm={}));var cm;!function(t){var e=function(){function t(){}return t.getLinePoints=function(t,e,i,n){for(var o=[],r=Math.abs(i-t),s=Math.abs(n-e),a=i>t?1:-1,c=n>e?1:-1,h=r-s;;){if(o.push({x:t,y:e}),t==i&&e==n)break;var l=2*h;l>-s&&(h-=s,t+=a),r>l&&(h+=r,e+=c)}return o},t}();t.Algorithm=e,__reflect(e.prototype,"cm.Algorithm")}(cm||(cm={}));var cm;!function(t){var e=function(){function t(){}return t.getByUrl=function(t){return new Promise(function(e,i){var n=new egret.ImageLoader;n.crossOrigin="anonymous",n.addEventListener(egret.Event.COMPLETE,function(){var t=new egret.Texture;t.bitmapData=n.data,e(t)},null),n.addEventListener(egret.IOErrorEvent.IO_ERROR,function(t){i(t)},null),n.load(t)})},t}();t.Image=e,__reflect(e.prototype,"cm.Image")}(cm||(cm={}));var cm;!function(t){var e=function(){function t(){}return t.SCENE=0,t.Middle=1,t.TOP=2,t}();t.Layer=e,__reflect(e.prototype,"cm.Layer")}(cm||(cm={}));var cm;!function(t){var e=function(){function e(){}return e.prototype.load=function(e,i){for(var n=this,o=[],r=2;r<arguments.length;r++)o[r-2]=arguments[r];this._currentScene&&this._currentScene.stage?this._currentScene.exit().then(function(){n._currentScene.parent.removeChild(n._currentScene),n._currentScene=new e(o),n._currentScene.onReady(i),t.main.addChildAt(n._currentScene,t.Layer.SCENE)}):(this._currentScene=new e(o),t.main.addChildAt(this._currentScene,t.Layer.SCENE))},e.prototype.unload=function(){this._currentScene&&this._currentScene.stage&&(this._currentScene.parent.removeChild(this._currentScene),this._currentScene=null)},Object.defineProperty(e.prototype,"currentScene",{get:function(){return this._currentScene},enumerable:!0,configurable:!0}),e}();__reflect(e.prototype,"SceneManager"),t.sceneManager=new e}(cm||(cm={}));var cm;!function(t){var e=function(t){function e(e,i,n,o){var r=t.call(this)||this;r._imgArr=[],r._time=0,r._playing=!1,r._startTime=0,r._index=0,r._playTimes=0,r._repeat=0;for(var s=n;o>=s;s++){for(var a=s.toString();a.length<i;)a="0"+a;r._imgArr.push(e+a)}r.addEventListener(egret.Event.ADDED_TO_STAGE,r.onAddToStage,r);var c=RES.getRes(r._imgArr[0]);return r.width=c.textureWidth,r.height=c.textureHeight,r}return __extends(e,t),e.prototype.play=function(t,e){void 0===t&&(t=0),void 0===e&&(e=1),this._time=t,this._playing=!0,this._startTime=egret.getTimer(),this._index=0,this._playTimes=1,this._repeat=e,this.addEventListener(egret.Event.ENTER_FRAME,this.update,this)},e.prototype._play=function(){this._playing=!0,this._startTime=egret.getTimer(),this._index=0},e.prototype.onAddToStage=function(t){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},e.prototype.onRemove=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.update,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},e.prototype.complete=function(){0===this._repeat?this._play():this._repeat>0&&(this._playTimes>=this._repeat?(this.removeEventListener(egret.Event.ENTER_FRAME,this.update,this),this.dispatchEvent(new egret.Event(egret.Event.COMPLETE))):(this._playTimes++,this._play()))},e.prototype.update=function(){if(this._playing){var t=void 0;if(this._time>0){var e=egret.getTimer(),i=e-this._startTime;if(i>this._time)return void this.complete();var n=i/this._time;n=n>1?1:n,this._index=Math.round(n*(this._imgArr.length-1)),t=RES.getRes(this._imgArr[this._index]),this.source=t}else{if(this._index>this._imgArr.length-1)return void this.complete();t=RES.getRes(this._imgArr[this._index]),this.source=t,this._index++}this.width=t.textureWidth,this.height=t.textureHeight,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2}},e}(eui.Image);t.SequenceImage=e,__reflect(e.prototype,"cm.SequenceImage")}(cm||(cm={}));var codearena;!function(t){var e=function(){function t(){}return t.LOCAL_DEBUG=!1,t.RES_ROOT="resource/",t.APP_ROOT="./",t.IS_UBT=!0,t}();t.Global=e,__reflect(e.prototype,"codearena.Global")}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function t(){this._data=null}return t.prototype.init=function(t){this._data=t},t.prototype.get=function(t){return this._data[t]},t}();__reflect(e.prototype,"Lang"),t.lang=new e}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function t(){this.server_status=null,this.mod_config=null,this.mapItem_config=null,this.ai_config=null,this.npc_config=null,this.player_config=null,this.server_config={api:{host:"https://backend-dev.codemao.cn",port:"8080"},host:{whitepaw:"https://frontend-dev.codemao.cn"}}}return t.prototype.init=function(){this.mod_config=RES.getRes("mod_json"),this.mapItem_config=RES.getRes("mapItem_json"),this.ai_config=RES.getRes("ai_json"),this.npc_config=RES.getRes("npc_json"),this.player_config=RES.getRes("player_json")},t.prototype.getModById=function(t){return this.mod_config[t]},t.prototype.getPlayerById=function(t){return this.player_config[t]},t.prototype.getNpcById=function(t){return this.npc_config[t]},t.prototype.getAiByType=function(t){return this.ai_config[t]},t.prototype.getMapItemById=function(t){return this.mapItem_config[t]},t.prototype.getLevelConfig=function(t){return RES.getRes("level"+t+"_json")},t}();__reflect(e.prototype,"Config"),t.config=new e}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function t(){}return t.FIGHT_BACK="fightback",t.ACTIVE="active",t.FOOL="fool",t}();t.AIType=e,__reflect(e.prototype,"codearena.AIType")}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function t(){}return t.ENEMY="enemy",t.HERO="hero",t.NPC="npc",t.FRIEND="friend",t}();t.Camp=e,__reflect(e.prototype,"codearena.Camp")}(codearena||(codearena={}));var codearena;!function(t){function e(t){switch(t){case"left":return i.LEFT;case"right":return i.RIGHT;case"up":return i.UP;case"down":return i.DOWN;default:return i.UNKOWN}}var i;!function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.UP=2]="UP",t[t.DOWN=3]="DOWN",t[t.UNKOWN=4]="UNKOWN"}(i=t.Direction||(t.Direction={})),t.convertDirection=e}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function t(){}return t.WARRIOR="warrior",t}();t.Job=e,__reflect(e.prototype,"codearena.Job")}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function t(){}return t.PROP="prop",t.BOX="box",t.BUTTON="button",t.TRAP="trap",t.NEST="nest",t.FENCE="fence",t.COIN="coin",t.GEM="gem",t.HEAL="heal_point",t}();t.MapItemType=e,__reflect(e.prototype,"codearena.MapItemType")}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function t(){}return t.GROUNDS="grounds",t.BUILDING="building",t.META="meta",t}();t.MapLayer=e,__reflect(e.prototype,"codearena.MapLayer")}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function t(){}return t.PASSABLE_PROPERTY_NAME="pass",t.INVISIBLE_PROPERTY_NAME="inVisible",t}();t.MapMeta=e,__reflect(e.prototype,"codearena.MapMeta")}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function t(){}return t.PLAYER="player",t.MAP_ITEM="mapItem",t.NPC="npc",t}();t.ObjectType=e,__reflect(e.prototype,"codearena.ObjectType")}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function t(){}return t.DRAGON_BONES="dragonbones",t.IMAGE="image",t}();t.ResType=e,__reflect(e.prototype,"codearena.ResType")}(codearena||(codearena={}));var codearena;!function(t){var e;!function(t){t[t.idle=0]="idle",t[t.defend=1]="defend",t[t.patrol=2]="patrol",t[t.pursue=3]="pursue",t[t.dead=4]="dead"}(e=t.RoleState||(t.RoleState={}))}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function t(){}return t.BGM_BATTLE="ingame_bgm_mp3",t.BGM_LOGIN="login_bgm_mp3",t.BGM_COMIC="comic_bgm_mp3",t.BGM_HOME="homepage_bgm_mp3",t.BGM_FAILURE="failure_bgm_mp3",t.BGM_SUCCESS="success_bgm_mp3",t.EFFECT_CODE_ERROR="code_error_mp3",t.EFFECT_CLICK="click_mp3",t.EFFECT_WELCOM="welcome_mp3",t}();t.SoundType=e,__reflect(e.prototype,"codearena.SoundType")}(codearena||(codearena={}));var codearena;!function(t){var e=function(t){function e(e,i){var n=t.call(this,e,!1,!1,i)||this;return n._data=null,n}return __extends(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),e.ATTACKED="hero_attacked",e.DEAD="hero_dead",e.HERO_MOVE="hero_move",e.OBJ_POS_CHANGED="obj_pos_changed",e.COLLECT_DIAMOND="collect_diamond",e.MOVE_ACTION_COMPLETE="move_action_complete",e.SAY="say",e}(egret.Event);t.CustomEvent=e,__reflect(e.prototype,"codearena.CustomEvent")}(codearena||(codearena={}));var codearena;!function(t){t.GameLayer={Obj:"gameObj",Surface:"gameSurface"};var e="gameObj";t.EVENT_RUNCODE_OVER="EVENT_RUNCODE_OVER";var i=function(i){function n(){var t=null!==i&&i.apply(this,arguments)||this;return t._hero=null,t._grid=null,t._mapGrid=null,t._needSort=!1,t._objects={},t._running=!1,t._clock=new cm.Clock,t._mapLoaded=!1,t._delayObjectList=[],t.currentLevel=null,t}return __extends(n,i),n.prototype.init=function(e){var i=this._currentMap!=e;this._currentMap=e,this._initGrid(),i&&this._initGameObjLayer();var n=RES.getRes("level"+this.currentLevel+"_json");this._levelConfig=n,t.levelParser.parse(n),this._currentMap.center(this.hero.view.x,this.hero.view.y),this._currentMap.addEventListener(egret.Event.ENTER_FRAME,this._onEnterFrame,this),this._mapLoaded||this._currentMap.tiledMap.addEventListener(tiled.TMXImageLoadEvent.ALL_IMAGE_COMPLETE,this._onLoadMapComplete,this),this.needSort=!0;var o=RES.getRes("task"+this.currentLevel+"_json");t.missionManager.init(o,this._levelConfig.passCondition),window.arena={getGameObjectType:function(e){var i=t.gameControl.getObjectById(e);return i&&i instanceof t.MapItem?i.config.name:""},getGameObjectHp:function(e){var i=t.gameControl.getObjectById(e);if(!i)throw new Error("找不到id为"+e+"的对象");if(i instanceof t.GameRole)return i.hp;throw new Error("id为"+e+"的对象没有血量")},getGameObjectPos:function(e){var i=t.gameControl.getObjectById(e);if(!i)throw new Error("找不到id为"+e+"的对象");return i.getGrid()}},window.hero={attack:function(e){var i;return i="string"==typeof e?t.gameControl.getObjectByName(e):t.gameControl.getObjectById(e),t.gameControl.hero.attack(i)},moveDirection:function(e,i){switch(e){case"left":return t.gameControl.hero.moveLeft(i);case"up":return t.gameControl.hero.moveUp(i);case"right":return t.gameControl.hero.moveRight(i);case"down":return t.gameControl.hero.moveDown(i)}},moveXY:function(e,i){return t.gameControl.hero.moveXY(e,i)},findNearestEnemy:function(){var e=t.gameControl.hero.findNearestEnemy();return e?e.id:null},findNearestGem:function(){var e=t.gameControl.hero.findNearestGem();return e?e.id:null},findNearestItem:function(){var e=t.gameControl.hero.findNearestItem();return e?e.id:null},say:function(e){return t.gameControl.hero.say(e)},distanceTo:function(e){var i=t.gameControl.getObjectById(e);return t.gameControl.hero.distanceTo(i)},getEnemyLevel:function(e){var i;return i="string"==typeof e?t.gameControl.getObjectByName(e):t.gameControl.getObjectById(e),i&&i instanceof t.GameRole?t.gameControl.hero.getEnemyLevel(i):null},pickUpCoin:function(){return t.gameControl.hero.pickUpCoin()},getHp:function(){return t.gameControl.hero.hp}}},n.prototype.stop=function(){this._running=!1,this._clock.stop(),cm.scheduler.unschedule(this,this._timeover),t.codeEditor.stop(),t.missionManager.stop(),this._hero&&this._hero.stop();for(var e in this._objects){var i=this._objects[e];i instanceof t.Npc&&(i.stopAI(),i.stop())}},n.prototype.destroy=function(){this.stop(),this._currentMap&&this._currentMap.removeEventListener(egret.Event.ENTER_FRAME,this._onEnterFrame,this),this._needSort=!1,cm.scheduler.unschedule(this,this._codeRunComplete),t.missionManager.stop(),t.codeEditor.stop();for(var e in this._objects){var i=this._objects[e];i instanceof t.GameObject&&i.destroy()}for(var n=this._gameObjLayer.numChildren,o=n-1;o>=0;o--){var i=this._gameObjLayer.getChildAt(o);i instanceof t.Bullet&&i.parent&&i.parent.removeChild(i)}this._grid=null,this._hero=null,this._delayObjectList=[],this._running=!1},n.prototype.removeMap=function(){this.destroy(),this._currentMap=null,this._gameObjLayer=null,this._gameMainLayer=null,this._gameSurfaceLayer=null,this._mapGrid=null,this._objects={},this._levelConfig=null,this._mapLoaded=!1},n.prototype.reset=function(){if(!this._currentMap)throw new Error("can not reset because the map is not inited");this.destroy(),cm.soundManager.playMusic(t.SoundType.BGM_BATTLE),this.init(this._currentMap);cm.sceneManager.currentScene},n.prototype.run=function(){var e=this;this.reset(),t.service.getLevelTime(),this._running=!0,this._clock.start(),this._levelConfig.limitTime>0&&cm.scheduler.schedule(this,this._timeover,1e3*this._levelConfig.limitTime,1,!0),t.missionManager.start(Number.MAX_SAFE_INTEGER),t.Global.IS_UBT||t.codeEditor.run(Number.MAX_SAFE_INTEGER).then(function(){egret.log("代码运行结束"),cm.scheduler.schedule(e,e._codeRunComplete,2,1)})["catch"](function(i){e._running&&cm.soundManager.playSound(t.SoundType.EFFECT_CODE_ERROR)});for(var i in this._objects){var n=this._objects[i];n instanceof t.Npc&&n.startAI()}},n.prototype._timeover=function(){this.onMissionFailed()},n.prototype._codeRunComplete=function(){this.onMissionFailed()},n.prototype.getLayer=function(e){return e==t.GameLayer.Obj?this._gameObjLayer:e==t.GameLayer.Surface?this._gameSurfaceLayer:void 0},n.prototype.onMissionSuccess=function(){if(this._running){t.service.reportLevelTime(),this.stop();cm.sceneManager.currentScene;cm.soundManager.stopMusic(),cm.scheduler.unschedule(this,this._codeRunComplete),this.dispatchEventWith(t.EVENT_RUNCODE_OVER),setTimeout(function(){t.Global.IS_UBT&&t.onBattleSuccess();var e=new t.MissionComplete("success");t.Alert.show(e,{bg:!0,clickBgClose:!1,addToMain:!1})},500)}},n.prototype.onMissionFailed=function(){if(this._running){this.stop();cm.sceneManager.currentScene;this.dispatchEventWith(t.EVENT_RUNCODE_OVER),cm.soundManager.stopMusic(),setTimeout(function(){var e=new t.MissionComplete("failed");t.Global.IS_UBT&&t.onBattleFailed(),t.Alert.show(e,{bg:!0,clickBgClose:!1,addToMain:!1})},500)}},n.prototype.isWalkableInOriginalMap=function(t){return this._mapGrid.isWalkableAt(t.column,t.row)},n.prototype._onLoadMapComplete=function(){this._mapLoaded=!0,this._currentMap.tiledMap.removeEventListener(tiled.TMXImageLoadEvent.ALL_IMAGE_COMPLETE,this._onLoadMapComplete,this),this.needSort=!0},n.prototype._initGameObjLayer=function(){this._gameMainLayer=this.getLayerByName(e);for(var t=[],i=0,n=this._gameMainLayer.numChildren;n>i;i++)t.push(this._gameMainLayer.getChildAt(i));this._gameMainLayer.removeChildren(),egret.assert(!!this._gameMainLayer,'the map must contain a layer named "gameObj"'),this._gameSurfaceLayer=new clib.BattleLayer(this._gameMainLayer),this._gameObjLayer=new clib.BattleLayer(this._gameMainLayer);for(var i=0,n=t.length;n>i;i++)this._gameObjLayer.addChild(t[i])},n.prototype._initGrid=function(){var e=this.getLayerByName("meta");if(!e)throw new Error('the map must contain a layer named "meta"');for(var i=this._currentMap.column,n=this._currentMap.row,o=[],r=0;i>r;r++)for(var s=0;n>s;s++){var a=e.layerData[r][s];o[s]=o[s]?o[s]:[],o[s][r]=a&&a.getProperty(t.MapMeta.PASSABLE_PROPERTY_NAME)===!0?0:1}this._mapGrid=this._grid=new PF.Grid(o)},n.prototype.getGridProperty=function(t,e,i){var n=this.getLayerByName("meta"),o=n.layerData[e][i];return o?o.getProperty(t):null},n.prototype.getTileInVisible=function(e,i){return!!this.getGridProperty(t.MapMeta.INVISIBLE_PROPERTY_NAME,e,i)},n.prototype.hasInvisibleTile=function(t,e){for(var i=cm.Algorithm.getLinePoints(t.column,t.row,e.column,e.row),n=0,o=i;n<o.length;n++){var r=o[n],s=this.getTileInVisible(r.x,r.y);if(s)return!0}return!1},n.prototype.getLayerByName=function(t){return this._currentMap.tiledMap.getChildByName(t)},n.prototype.getObjectById=function(t){return this._objects[t]},n.prototype.getObjectByName=function(e){if(!e)return null;for(var i in this._objects){var n=this._objects[i];if(n instanceof t.GameRole&&n.name&&n.name===e)return n}return null},Object.defineProperty(n.prototype,"tileWidth",{get:function(){return this._currentMap.tiledMap.tilewidth},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tileHeight",{get:function(){return this._currentMap.tiledMap.tileheight},enumerable:!0,configurable:!0}),n.prototype.delayCreate=function(t){this._delayObjectList.push(t)},n.prototype.createHero=function(e){t.usermanager.self.gender===t.User.FEMALE?e.typeId=2:t.usermanager.self.gender===t.User.MALE&&(e.typeId=1),this._hero=new t.Hero(e),this._hero.name=t.usermanager.self.nickname,this._hero.setVisionArea(t.config.getLevelConfig(this.currentLevel).visionOpen),this._objects[this._hero.id]=this._hero,this._hero.isActived&&this._hero.active(this._gameObjLayer)},n.prototype.createNPC=function(e,i){var n=new t.Npc(e);n.setVisionArea(t.config.getLevelConfig(this.currentLevel).visionOpen),this._objects[n.id]=n,n.isActived&&!i&&n.active(this._gameObjLayer)},n.prototype.createMapItem=function(e){var i=null,n=t.config.getMapItemById(e.typeId);switch(n.type){case t.MapItemType.BOX:i=new t.Box(e);break;case t.MapItemType.NEST:i=new t.Nest(e);break;case t.MapItemType.FENCE:i=new t.FenceObject(e);break;default:i=new t.MapItem(e)}this._objects[i.id]=i,i.isActived&&i.active(this.getLayer(i.layer))},n.prototype.addToObjectLayer=function(t){this._gameObjLayer.addChild(t)},n.prototype.activeObject=function(t){if(!t)throw new Error("invalid object id, activeObject failed");var e=this.getObjectById(t);if(!e)throw new Error("cannot find object which id equal "+t+",activeObject failed");e.active(this._gameObjLayer),this._needSort=!0},n.prototype.deactiveObject=function(t){if(!t)throw new Error("invalid object id, deactiveObject failed");var e=this.getObjectById(t);if(!e)throw new Error("cannot find object which id equal "+t+",deactiveObject failed");e.deactive()},n.prototype.operatorObjectAction=function(t,e){if(!t)throw new Error("invalid object id, deactiveObject failed");var i=this.getObjectById(t);if(!i)throw new Error("cannot find object which id equal "+t+",deactiveObject failed");if(!i[e])throw new Error("cannot find object "+t+" action "+e);i[e]()},n.prototype.inWhichGrid=function(t,e){var i=this._currentMap.tiledMap.tilewidth,n=this._currentMap.tiledMap.tileheight,o=Math.floor(t/i),r=Math.floor(e/n);return{column:o,row:r}},n.prototype.isInvalidGrid=function(t){for(var e=0;e<t.h;e++)for(var i=0;i<t.w;i++){var n=t.column+i,o=t.row+e;if(!this.grid.isWalkableAt(n,o))return!1}return!0},n.prototype.getGridCenter=function(t,e){return{x:t*this.tileWidth+this.tileWidth/2,y:e*this.tileHeight+this.tileHeight/2}},n.prototype.findPath=function(t,e,i){var n=new PF.AStarFinder({allowDiagonal:!0,dontCrossCorners:!0});if(null==this._grid)throw new Error("hhaha");var o=n.findPath(t.column,t.row,e.column,e.row,this._grid.clone());return i&&(o=PF.Util.smoothenPath(this._grid.clone(),o)),egret.log("find path fom ("+t.column+","+t.row+") to ("+e.column+","+e.row+") result:",o),o},n.prototype.updateGrid=function(){var e=this._mapGrid.clone();for(var i in this._objects){var n=this._objects[i];if(n instanceof t.MapItem&&n.isObstacle){var o=n.caculateGrid();this._setUnwalkable(e,o)}}this._grid=e},n.prototype._setUnwalkable=function(t,e){for(var i=e.column,n=e.row,o=e.w,r=e.h,s=0;r>s;s++)for(var a=0;o>a;a++)t.setWalkableAt(i+a,n+s,!1)},n.prototype._sortDeepth=function(){var t=this,e=function(e,i){var n=t._getOrderByType(e),o=t._getOrderByType(i);return n!==o?n-o:e.y>i.y?1:e.y<i.y?-1:i.$hashCode-e.hashCode};this._gameObjLayer.sortFunc=e,this._gameObjLayer.onUpdate(),this.needSort=!1},n.prototype._getOrderByType=function(e){var i=3,n=this._objects[e.name];return n&&(n instanceof t.MapItem&&n.itemType===t.MapItemType.BUTTON?i=1:n instanceof t.GameRole&&n.state===t.RoleState.dead&&(i=2)),i},n.prototype._onEnterFrame=function(){this._gameMainLayer.numChildren>2&&(this.refreshLayer(),this._needSort=!0),this._needSort&&this._sortDeepth(),this._hero&&this._running&&this._currentMap.center(this._hero.x,this._hero.y),this._running&&t.levelParser.checkDelayCreateList(this._clock.time)},n.prototype.refreshLayer=function(){for(var t=[],e=0;e<this._gameMainLayer.numChildren;e++){var i=this._gameMainLayer.getChildAt(e);i.__battleLayer||(t.push(i),this._gameMainLayer.removeChild(i))}for(var e=0;e<t.length;e++)this._gameObjLayer.addChild(t[e])},n.prototype.removeObjectById=function(t){this._objects[t];delete this._objects[t]},Object.defineProperty(n.prototype,"objects",{get:function(){return this._objects},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hero",{get:function(){return this._hero},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"grid",{get:function(){return this._grid},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"needSort",{set:function(t){this._needSort=t},enumerable:!0,configurable:!0}),n}(egret.EventDispatcher);__reflect(i.prototype,"GameControl"),t.gameControl=new i}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function t(t){this._target=null,this._target=t}return t.prototype.start=function(){this._target.idle()},t.prototype.onEnterFrame=function(){},t.prototype.onDamage=function(t){},t}();t.AIFightback=e,__reflect(e.prototype,"codearena.AIFightback",["codearena.IAI"])}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function e(t){this._target=null,this._target=t}return e.prototype.start=function(){this._target.idle()},e.prototype.onEnterFrame=function(){this._target.state!==t.RoleState.idle||this._target.patrolFinished()||this._target.startPatrol()},e.prototype.onDamage=function(t){},e}();t.AIFool=e,__reflect(e.prototype,"codearena.AIFool",["codearena.IAI"])}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function e(t){this._target=null,this._target=t}return e.prototype.start=function(){this._target.idle()},e.prototype.onEnterFrame=function(){if(this._target.state===t.RoleState.idle||this._target.state===t.RoleState.patrol)if(this._target.camp===t.Camp.ENEMY){var e=this._target.findNearestPlayer();if(e&&!this._target.isPursue(e))return void this._target.attack(e)}else if(this._target.camp===t.Camp.FRIEND){var i=this._target.findNearestEnemy();if(i&&!this._target.isPursue(i))return void this._target.attack(i)}this._target.state!==t.RoleState.idle||this._target.patrolFinished()||this._target.startPatrol()},e.prototype.onDamage=function(t){this._target.faceTo(t.currentGrid)},e}();t.AIOffensive=e,__reflect(e.prototype,"codearena.AIOffensive",["codearena.IAI"])}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.enable=function(){e.prototype.enable.call(this),this._needManualCheck=!0;var i=this._missionData.argument;i&&Array.isArray(i)&&2===i.length||this._invalidArguments();var n=i[0],o=i[1],r=t.gameControl.getObjectById(n);r||this._objectNotFound(n),this._target=r,this._hp=o,r.addEventListener(t.CustomEvent.ATTACKED,this._onAttacked,this)},i.prototype.check=function(){this._target&&this._target.hp>this._hp&&(this.state=t.MissionState.completed)},i.prototype.disable=function(){e.prototype.disable.call(this),this._target&&this._target.removeEventListener(t.CustomEvent.ATTACKED,this._onAttacked,this),this._target=null},i.prototype._onAttacked=function(e){this._target.hp<=this._hp&&(this.state=t.MissionState.failed,this.disable())},i}(t.MissionBase);t.Mission1=e,__reflect(e.prototype,"codearena.Mission1")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(t){var i=e.call(this,t)||this,n=i._missionData.argument;return n&&Array.isArray(n)||i._invalidArguments(),i._progress=0,i._total=n.length,i}return __extends(i,e),i.prototype.enable=function(){var i=this;e.prototype.enable.call(this);var n=this._missionData.argument;n.forEach(function(e){var n=t.gameControl.getObjectById(e);n.addEventListener(t.CustomEvent.DEAD,i._onDead,i)})},i.prototype.disable=function(){var i=this;e.prototype.disable.call(this);var n=this._missionData.argument;n&&n.length>0&&n.forEach(function(e){var n=t.gameControl.getObjectById(e);n.removeEventListener(t.CustomEvent.DEAD,i._onDead,i)})},i.prototype.check=function(){this._progress<this._total&&(this.state=t.MissionState.failed)},i.prototype._onDead=function(e){e.target.removeEventListener(t.CustomEvent.DEAD,this._onDead,this),this._progress++,this._progress===this._total&&(this.state=t.MissionState.completed,this.disable());var i=this._progress,n=this._total;this.dispatchEvent(new t.MissionProgressEvent(t.MissionProgressEvent.PROGRESS,{progress:i,total:n}))},i}(t.MissionBase);t.Mission2=e,__reflect(e.prototype,"codearena.Mission2")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(t){var i=e.call(this,t)||this;i._progress=0;var n=i._missionData.argument;return n&&Array.isArray(n)||i._invalidArguments(),i._total=n.length,i}return __extends(i,e),i.prototype.enable=function(){e.prototype.enable.call(this),t.gameControl.hero.addEventListener(t.CustomEvent.COLLECT_DIAMOND,this._onCollect,this)},i.prototype.disable=function(){e.prototype.disable.call(this),t.gameControl.hero.removeEventListener(t.CustomEvent.COLLECT_DIAMOND,this._onCollect,this)},i.prototype.check=function(){this._progress<this._total&&(this.state=t.MissionState.failed)},i.prototype._onCollect=function(e){this._progress++,this._progress===this._total&&(this.state=t.MissionState.completed,this.disable());var i=this._progress,n=this._total;this.dispatchEvent(new t.MissionProgressEvent(t.MissionProgressEvent.PROGRESS,{progress:i,total:n}))},i}(t.MissionBase);t.Mission3=e,__reflect(e.prototype,"codearena.Mission3")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.enable=function(){e.prototype.enable.call(this);var i=this._missionData.argument;i&&Array.isArray(i)&&4===i.length||this._invalidArguments();var n=i[0],o=i[1],r=i[2],s=i[3],a=t.gameControl.getObjectById(n);a||this._objectNotFound(n),this._target=a,this._rad=s;var c=t.gameControl.getGridCenter(o,r);this._endPoint=new egret.Point(c.x,c.y),a.addEventListener(t.CustomEvent.OBJ_POS_CHANGED,this._onPosChange,this)},i.prototype.disable=function(){e.prototype.disable.call(this),this._target&&this._target.removeEventListener(t.CustomEvent.OBJ_POS_CHANGED,this._onPosChange,this),this._target=null},i.prototype.check=function(){this.state=t.MissionState.failed},i.prototype._onPosChange=function(e){if(!this._target)return void egret.warn("mission taret is null");var i=new egret.Point(this._target.x,this._target.y),n=egret.Point.distance(i,this._endPoint);n<this._rad&&(this.state=t.MissionState.completed,this.disable())},i}(t.MissionBase);t.Mission4=e,__reflect(e.prototype,"codearena.Mission4")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(t){var i=e.call(this,t)||this;i._needManualCheck=!0;var n=i._missionData.argument;return n&&1===n.length||i._invalidArguments(),i._progress=0,i._total=n[0],i}return __extends(i,e),i.prototype.enable=function(){e.prototype.enable.call(this),this._progress=t.codeEditor.codeLines();var i=this._progress,n=this._total;this.dispatchEvent(new t.MissionProgressEvent(t.MissionProgressEvent.PROGRESS,{progress:i,total:n}))},i.prototype.check=function(){var e=this._missionData.argument,i=e[0];this.state=this._progress>i?t.MissionState.failed:t.MissionState.completed},i}(t.MissionBase);t.Mission5=e,__reflect(e.prototype,"codearena.Mission5")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.enable=function(){e.prototype.enable.call(this);
var i=this._missionData.argument;i&&Array.isArray(i)&&5===i.length||this._invalidArguments();var n=i[0],o=i[3];this._question_target=t.gameControl.getObjectById(n),this._question_target||this._objectNotFound(n),this._answer_target=t.gameControl.getObjectById(o),this._answer_target||this._objectNotFound(o),this._distance=i[1],this._question=i[2],this._answer=i[4],this._question_target.addEventListener(t.CustomEvent.SAY,this._onSay,this)},i.prototype.disable=function(){e.prototype.disable.call(this),this._question_target&&this._question_target.removeEventListener(t.CustomEvent.SAY,this._onSay,this),this._question_target=null,this._answer_target=null},i.prototype.check=function(){this.state=t.MissionState.failed},i.prototype._onSay=function(e){var i=e.data,n=new egret.Point(this._question_target.x,this._question_target.y),o=new egret.Point(this._answer_target.y,this._answer_target.y);i===this._question&&egret.Point.distance(n,o)<this._distance&&(this.state=t.MissionState.completed,this._answer_target.say(this._answer))},i}(t.MissionBase);t.Mission6=e,__reflect(e.prototype,"codearena.Mission6")}(codearena||(codearena={}));var cm;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._username="",t.anchorX=.5,t.anchorY=1,t}return __extends(i,e),i.prototype.init=function(t,e,i){void 0===e&&(e=.5),void 0===i&&(i=1),this.anchorX=e,this.anchorY=i,this._name=t,this.loadRes()},Object.defineProperty(i.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),i.prototype.loadRes=function(){var e=t.Utils.urlToResName(this._name),i="animation_"+e;RES.createGroup(i,[e+"_ske_json",e+"_tex_json",e+"_tex_png"],!0),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this._onDragonbonesComplete,this),RES.loadGroup(i)},i.prototype._onDragonbonesComplete=function(t){t.groupName==="animation_"+this._name&&(this.createAnimation(),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this._onDragonbonesComplete,this))},i.prototype.createAnimation=function(){var e=RES.getRes(this._name+"_ske_json"),i=RES.getRes(this._name+"_tex_json"),n=RES.getRes(this._name+"_tex_png"),o=t.dragonBonesManager.getFactory(name,e,i,n),r=o.buildArmatureDisplay("armatureName");this._armature=r,this.addChild(this._armature);var s=this._armature.width,a=this._armature.height;this.anchorOffsetX=s*this.anchorX,this.anchorOffsetY=a*this.anchorY,this.width=s,this.height=a,this._armature.x=s/2,this._armature.y=a,this.dispatchEvent(new egret.Event(egret.Event.COMPLETE))},i.prototype.play=function(t,e){if(this._armature){var i=this._armature,n=i.animation.getState(t);n&&n.isPlaying&&i.animation.stop(),i.animation.play(t,e)}},i.prototype.stop=function(){if(this._armature){var t=this._armature;t.animation.stop()}},i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.stop()},i}(t.EUIComponent);t.Animation=e,__reflect(e.prototype,"cm.Animation")}(cm||(cm={}));var codearena;!function(t){var e;!function(t){t[t.none=0]="none",t[t.active=1]="active",t[t.deactive=2]="deactive",t[t.action=3]="action"}(e=t.MissionOperate||(t.MissionOperate={}));var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.init=function(e,i){this.destroy(),this._missionDatas=e,this._missionList={};var n=new t.MissionSet({id:0,type:7,name:"通关任务",argument:i});this._missionSet=n,this.dispatchEvent(new egret.Event(egret.Event.CHANGE))},i.prototype.start=function(t){this._missionSet.addEventListener(egret.Event.CHANGE,this._missionStateChange,this),this._missionSet.enable()},i.prototype.stop=function(){this._missionSet&&(this._missionSet.removeEventListener(egret.Event.CHANGE,this._missionStateChange,this),this._missionSet.disable())},Object.defineProperty(i.prototype,"missionSet",{get:function(){return this._missionSet},enumerable:!0,configurable:!0}),i.prototype._missionStateChange=function(e){if(this._missionSet.state===t.MissionState.completed)return egret.log("通关任务已完成！"),egret.callLater(this._disableMission,this),void t.gameControl.onMissionSuccess();if(this._missionSet.state===t.MissionState.failed)return egret.log("通关任务失败！"),egret.callLater(this._disableMission,this),void t.gameControl.onMissionFailed();var i=this._missionSet.missionList.filter(function(e){return e.state!==t.MissionState.completed});i.every(function(t){return t.needManualCheck})&&i.forEach(function(t){return t.check()})},i.prototype._disableMission=function(){this._missionSet&&(this._missionSet.disable(),this._missionSet.removeEventListener(egret.Event.CHANGE,this._missionStateChange,this))},i.prototype._timeover=function(){egret.log("时间结束！"),this._missionSet.check()},i.prototype.manualCheck=function(){this._missionSet.check()},i.prototype.getRequiredMissions=function(){var t=this;return this._requires.map(function(e){return t.getMission(e)})},i.prototype.getMission=function(t){if(this._missionList[t])return this._missionList[t];var e=this._missionDatas.find(function(e){return e.id===t});return this._createMission(e)},i.prototype._createMission=function(e){var i=this._missionList[e.id];if(!i){switch(e.type){case 1:i=new t.Mission1(e);break;case 2:i=new t.Mission2(e);break;case 3:i=new t.Mission3(e);break;case 4:i=new t.Mission4(e);break;case 5:i=new t.Mission5(e);break;case 6:i=new t.Mission6(e);break;case 7:i=new t.MissionSet(e);break;case 8:i=new t.MissionQueue(e);break;case 9:i=new t.MissionTimeout(e)}this._missionList[e.id]=i}return i},i.prototype.destroy=function(){this._missionList&&(this._missionSet.disable(),this._missionSet=null,this._missionList=null,this._missionDatas=null,this._requires=null)},i}(egret.EventDispatcher);__reflect(i.prototype,"MissionManager"),t.missionManager=new i}(codearena||(codearena={}));var codearena;!function(t){var e=function(t){function e(e,i){var n=t.call(this,e,!1,!1,i)||this;return n._data=null,n}return __extends(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),e.PROGRESS="mission_progress",e}(egret.Event);t.MissionProgressEvent=e,__reflect(e.prototype,"codearena.MissionProgressEvent")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(i){var n=e.call(this,i)||this,o=n._missionData.argument;return o&&Array.isArray(o)||n._invalidArguments(),n._total=o.length,n._missionList=o.map(function(e){var i=t.missionManager.getMission(e);return i}),n}return __extends(i,e),i.prototype.enable=function(){var t=this;e.prototype.enable.call(this),this._missionList.forEach(function(e){e.addEventListener(egret.Event.CHANGE,t._onChange,t),e.enable()})},i.prototype.disable=function(){var t=this;e.prototype.disable.call(this),this._missionList&&(this._missionList.forEach(function(e){e.disable(),e.removeEventListener(egret.Event.CHANGE,t._onChange,t)}),this._missionList=null)},i.prototype.check=function(){this._missionList.forEach(function(t){t.check()})},i.prototype._onChange=function(e){var i=e.target;if(i.state===t.MissionState.completed){this._progress++;for(var n=0;n<this._missionList.length;n++){var o=this._missionList[n];if(o.state!==t.MissionState.completed)return void(this.state=t.MissionState.failed);if(n===this._missionList.length-1&&(this.state=t.MissionState.completed),o===i)break}}else if(i.state===t.MissionState.failed)return void(this.state=t.MissionState.failed);this.dispatchEvent(new egret.Event(egret.Event.CHANGE,!0,!1,i))},i}(t.MissionBase);t.MissionQueue=e,__reflect(e.prototype,"codearena.MissionQueue")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(i){var n=e.call(this,i)||this,o=n._missionData.argument;return o&&Array.isArray(o)||n._invalidArguments(),n._missionList=[],n._total=o.length,n._progress=0,o.forEach(function(e){var i=t.missionManager.getMission(e);n._missionList.push(i)}),n}return __extends(i,e),i.prototype.enable=function(){var t=this;e.prototype.enable.call(this),this._missionList.forEach(function(e){e.enable(),e.addEventListener(egret.Event.CHANGE,t._onStateChange,t)})},i.prototype.disable=function(){var t=this;e.prototype.disable.call(this),this._missionList&&(this._missionList.forEach(function(e){e.disable(),e.removeEventListener(egret.Event.CHANGE,t._onStateChange,t)}),this._missionList=null)},i.prototype.check=function(){this._missionList&&this._missionList.forEach(function(t){t.check()})},Object.defineProperty(i.prototype,"missionList",{get:function(){return this._missionList},enumerable:!0,configurable:!0}),i.prototype._onStateChange=function(e){var i=e.target;i.state===t.MissionState.completed&&this._progress++,i.state===t.MissionState.failed?this.state=t.MissionState.failed:this._missionList.every(function(e){return e.state===t.MissionState.completed})?this.state=t.MissionState.completed:this.dispatchEvent(new egret.Event(egret.Event.CHANGE,!0,!1,i))},i}(t.MissionBase);t.MissionSet=e,__reflect(e.prototype,"codearena.MissionSet")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(t){var i=e.call(this,t)||this;i._needManualCheck=!0;var n=i._missionData.argument[0];return n||i._invalidArguments(),i._progress=0,i._total=n,i}return __extends(i,e),i.prototype.enable=function(){e.prototype.enable.call(this),cm.scheduler.schedule(this,this._tick,1e3,this._total)},i.prototype.disable=function(){e.prototype.disable.call(this),cm.scheduler.unschedule(this,this._tick)},i.prototype.check=function(){this._progress<=this._total&&(this.state=t.MissionState.completed)},i.prototype._tick=function(){this._progress++,this._progress>=this._total&&(t.missionManager.manualCheck(),this.state=t.MissionState.failed,this.disable());var e=this._progress,i=this._total;this.dispatchEvent(new t.MissionProgressEvent(t.MissionProgressEvent.PROGRESS,{progress:e,total:i}))},i}(t.MissionBase);t.MissionTimeout=e,__reflect(e.prototype,"codearena.MissionTimeout")}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function t(){}return t.REACH_POINT=1,t.HERO_ALIVE=2,t.NPC_LIFE_LIMIT=3,t.KILL_ALL_ENEMY=4,t.COLLECT_DIAMONDS=5,t.CODE_LINE=6,t.CONTAIN_CODE=7,t.PUSH_BOX=8,t.QUEUE=9,t.DIALOG=10,t}();t.MissionType=e,__reflect(e.prototype,"codearena.MissionType")}(codearena||(codearena={}));var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},tiled.TMXLayer.USE_BATCH_RENDER=!0,egret.Logger.logLevel=egret.Logger.OFF;var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),codearena.Global.LOCAL_DEBUG=window.__local_debug;var i=window.__res_root,n=window.__app_root;i&&(codearena.Global.RES_ROOT=i),n&&(codearena.Global.APP_ROOT=n),this._loadDefaultResConfig()},e.prototype._loadDefaultResConfig=function(){RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig(codearena.Global.APP_ROOT+"resource/default.res.json?v="+Math.random(),codearena.Global.RES_ROOT)},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme(codearena.Global.APP_ROOT+"resource/default.thm.json?v="+Math.random(),this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},e.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName},e.prototype.startCreateScene=function(){codearena.lang.init(RES.getRes("content_cn_json")),codearena.config.init(),codearena.codeEditor.init(),codearena.codeControl.init(),director.instance.init(this),cm.init(this),cnUtils.hackEngine(),egret.Capabilities.isMobile||egret.Capabilities.runtimeType!==egret.RuntimeType.WEB?this.stage.frameRate=30:this.stage.frameRate=60;cm.Utils.getQueryParam("level");if(codearena.Global.IS_UBT){var t=window.onCodeArenaPrepared;return void(t&&t())}},e}(eui.UILayer);__reflect(Main.prototype,"Main");var codearena;!function(t){var e=function(){function e(){this._delayCreateList=[]}return e.prototype.parse=function(t){this._delayCreateList=[];for(var e=t.objId,i=RES.getRes(e+"_json"),n=0,o=i;n<o.length;n++){var r=o[n];r.spawnTime>0&&this._delayCreateList.push(r),this.create(r,r.spawnTime>0)}},e.prototype.checkDelayCreateList=function(e){if(this._delayCreateList&&0!==this._delayCreateList.length)for(var i=this._delayCreateList.length,n=i-1;n>=0;n--){var o=this._delayCreateList[n];e>=1e3*o.spawnTime&&(this._delayCreateList.splice(n,1),t.gameControl.activeObject(o.id))}},e.prototype.create=function(e,i){switch(e.type){case t.ObjectType.PLAYER:t.gameControl.createHero(e);break;case t.ObjectType.NPC:t.gameControl.createNPC(e,i);break;case t.ObjectType.MAP_ITEM:t.gameControl.createMapItem(e);break;default:egret.warn("unkown object type:"+e.type)}},e}();__reflect(e.prototype,"LevelParser"),t.levelParser=new e}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.push=function(e,i){var n=this.caculateGrid(i);if(n.column===this._curGridSize.column&&n.row===this._curGridSize.row)return this.setPosition(i),!0;for(var o=this._curGridSize,r=o.column,s=o.row,a=o.w,c=o.h,h=0;h<n.h;h++)for(var l=0;l<n.w;l++){var p=n.column+l,u=n.row+h;if((r>p||p>r+a-1||s>u||u>s+c-1)&&!t.gameControl.grid.isWalkableAt(p,u))return!1}return this.setPosition(i),!0},i}(t.MapItem);t.Box=e,__reflect(e.prototype,"codearena.Box")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(i,n){var o=e.call(this)||this;switch(o._rad=10,o._owner=n,o._direction=n.moveSpd>0?o._owner.direction:t.convertDirection(o._owner.cfg.spawnFace),o._direction){case t.Direction.LEFT:o.rotation=90;break;case t.Direction.RIGHT:o.rotation=-90;break;case t.Direction.UP:o.rotation=180;break;case t.Direction.DOWN:o.rotation=0}return o.addEventListener(egret.Event.COMPLETE,o._onAnimationLoaded,o),o.init(i,"",!1),o}return __extends(i,e),i.prototype._onAnimationLoaded=function(){this.removeEventListener(egret.Event.COMPLETE,this._onAnimationLoaded,this),this.play("idle",0)},i.prototype._onEnterFrame=function(e){if(this._outStage()||this._checkCollision())return void(this.parent&&this.parent.removeChild(this));var i=egret.getTimer(),n=i-this._lastFrameTime;this._lastFrameTime=i;var o=this._owner.bulletSpd*n/1e3;switch(this._direction){case t.Direction.LEFT:this.x-=o;break;case t.Direction.RIGHT:this.x+=o;break;case t.Direction.UP:this.y-=o;break;case t.Direction.DOWN:this.y+=o}},i.prototype._outStage=function(){var t=this.stage.stageWidth,e=this.stage.stageHeight,i=this.localToGlobal(0,0),n=i.x,o=i.y,r=-50>n||n>t+50||-50>o||o>e+50;return r},i.prototype._checkCollision=function(){for(var e in t.gameControl.objects){var i=t.gameControl.objects[e];if(i instanceof t.Hero){var n=new egret.Point(i.x,i.y),o=new egret.Point(this.x,this.y);if(egret.Point.distance(n,o)<i.collisionRad+this._rad)return i.onAttacked(this._owner),!0}}return!1},i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.removeEventListener(egret.Event.ENTER_FRAME,this._onEnterFrame,this),this.removeEventListener(egret.Event.COMPLETE,this._onAnimationLoaded,this),this._owner=null},i.prototype.onAdd=function(){e.prototype.onAdd.call(this),this._lastFrameTime=egret.getTimer(),this.addEventListener(egret.Event.ENTER_FRAME,this._onEnterFrame,this)},i}(t.Character);t.Bullet=e,__reflect(e.prototype,"codearena.Bullet")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(t){var i=e.call(this,t)||this;return i.upSate=!0,i}return __extends(i,e),i.prototype.initView=function(){this.uniForm=[{x:0,y:-48,display:"fence1"},{x:0,y:51,display:"fence1"},{x:-42,y:-10,display:"fence2"},{x:42,y:-10,display:"fence2"}],this.displays=[];for(var e=0;e<this.uniForm.length;e++){var i=new clib.Armtrue(this.uniForm[e].display);i.play("idle",0),this.displays.push(i)}var n=t.gameControl.getGridCenter(this._cfg.spawnPos.x,this._cfg.spawnPos.y);this.setPosition(n)},i.prototype.setPosition=function(t){this._x=t.x,this._y=t.y,this.updatePos(),this.updateGrid()},i.prototype.updatePos=function(){for(var e=0;e<this.displays.length;e++){var i=this.displays[e];i.x=this.x+this.uniForm[e].x,i.y=this.y+this.uniForm[e].y}t.gameControl.needSort=!0},Object.defineProperty(i.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),i.prototype.active=function(e){this._isActived=!0;for(var i=0;i<this.displays.length;i++)e.addChild(this.displays[i]);this.upSate&&(this._isObstacle=!0,t.gameControl.updateGrid(),t.Global.LOCAL_DEBUG&&e.addDrawCollison(this))},i.prototype.destroy=function(){this.deactive(),t.gameControl.removeObjectById(this.id);for(var e=0;e<this.displays.length;e++){var i=this.displays[e];i.parent&&i.parent.removeChild(i)}},i.prototype.playActive=function(){for(var e=this,i=0;i<this.displays.length;i++){var n=this.displays[i];n.play("down",1),i==this.displays.length-1&&n.byAnimComplete(function(){var i=t.gameControl.getLayer(t.GameLayer.Surface);e.active(i),i.onUpdate()})}this.upSate=!1,this._isObstacle=!1,t.gameControl.updateGrid()},i.prototype.caculateGrid=function(e){e=e||{x:this.x,y:this.y};var i=t.gameControl.tileWidth,n=t.gameControl.tileHeight,o=e.x-this._collisionRad,r=(e.x+this._collisionRad,e.y-this._collisionRad),s=(e.y+this._collisionRad,Math.ceil(2*this._collisionRad/i)),a=Math.ceil(2*this._collisionRad/n),c=t.gameControl.inWhichGrid(o,r),h=c.column,l=c.row;return{column:h,row:l,w:s,h:a}},i.prototype.drawCollison=function(t){var e=t.shape;e.graphics.beginFill(16711680,.5),e.graphics.drawCircle(this.x,this.y,this._collisionRad),e.graphics.endFill()},i.prototype.deactive=function(){this._isActived=!1},i}(t.MapItem);t.FenceObject=e,__reflect(e.prototype,"codearena.FenceObject")}(codearena||(codearena={}));var cm;!function(t){var e=function(){function t(){this._factory={}}return t.prototype.getFactory=function(t,e,i,n){if(this._factory[t])return this._factory[t];var o=new dragonBones.EgretFactory;return o.parseDragonBonesData(e),o.parseTextureAtlasData(i,n),this._factory[t]=o,o},t}();__reflect(e.prototype,"DragonBonesManager"),t.dragonBonesManager=new e}(cm||(cm={}));var cm;!function(t){var e=function(){function t(){this._listeners={}}return t.prototype.on=function(t,e,i){var n=this._listeners[t];n?this.addListener(n,{handler:e,target:i}):this._listeners[t]=[{handler:e,target:i}]},t.prototype.addListener=function(t,e){for(var i=0;i<t.length;i++){var n=t[i];if(n.handler===e.handler&&n.target===e.target)return}t.push(e)},t.prototype.off=function(t,e,i){var n=this._listeners[t];if(n&&!(n.length<=0))for(var o=n.length-1,r=o;r>=0;r--){var s=n[r];s.handler===e&&s.target===i&&n.splice(r,1)}},t.prototype.dispatch=function(t){var e=this._listeners[t];if(e&&!(e.length<=0))for(var i=0;i<e.length;i++){var n=e[i];n.handler.call(n.target)}},t}();t.Dispatcher=e,__reflect(e.prototype,"cm.Dispatcher")}(cm||(cm={}));var codearena;!function(t){var e=function(e){function i(i){var n=e.call(this,i,t.config.getPlayerById(i.typeId))||this;return n._job="",n._pursueResolve=null,n._pursueReject=null,n}return __extends(i,e),i.prototype.init=function(i){this._job=i.job,this._objectType=t.ObjectType.PLAYER,e.prototype.init.call(this,i),this._atkSelect=!0},i.prototype.attack=function(t){var e=this._checkAttack(t);return e?Promise.reject(e):t&&!this._inAttackScope(t)?this._moveSpd<=0?Promise.reject("无法移动"):(this._pursue(t),this._pursePromise()):this._atkCooling?Promise.reject("攻击冷却中"):(this._attack(t),this._pursePromise())},i.prototype._onAttackComplete=function(){this._pursueResolve&&(this._pursueResolve(),this._pursueResolve=null,this._pursueReject=null)},i.prototype._stopPursue=function(){e.prototype._stopPursue.call(this),this._pursueResolve&&(this._pursueReject(),this._pursueResolve=null,this._pursueReject=null)},i.prototype._pursePromise=function(){var t=this;return new Promise(function(e,i){t._pursueResolve=e,t._pursueReject=i})},i.prototype._animationLoaded=function(){e.prototype._animationLoaded.call(this),this.idle()},i.prototype._getAnimationPrefix=function(){switch(this._job){case t.Job.WARRIOR:return"war";default:return""}},i.prototype._check=function(e,i){e instanceof t.MapItem&&i<this._collisionRad+e.collisionRad&&this._onTouchItem(e)},i.prototype._onTouchItem=function(i){if(e.prototype._onTouchItem.call(this,i),i.config.type===t.MapItemType.HEAL){this.totalHp;this.hp<this.totalHp&&(this.setHp(this.totalHp),this.playEffect("heal_effect"))}else i.config.type&&this._pickup(i,!0)},i.prototype.setVisionArea=function(t){this._setVisionArea(t>0)},i.prototype._pickup=function(e,i){if(void 0===i&&(i=!1),!e)return!1;switch(e.config.type){case t.MapItemType.GEM:this.dispatchEventWith(t.CustomEvent.COLLECT_DIAMOND);break;case t.MapItemType.COIN:if(i)return!1;break;default:return!1}return egret.log("拾取道具："+e.config.name),e.playSound(),e.destroy(),!0},i.prototype.checkCollison=function(e){var i=[],n=t.gameControl.objects;for(var o in n){var r=n[o];if(r.isActived&&r!==this){var s=this._getDistance(r);s<this._collisionRad+r.collisionRad&&i.push(r)}}return i.filter(e)},i.prototype.pickUpCoin=function(){var e=this.checkCollison(function(e,i){return e instanceof t.MapItem&&e.itemType==t.MapItemType.COIN?!0:!1});return e.length>0?this._pickup(e[0]):!1},i.prototype._pushBox=function(t,e,i){return t.push(e,i)},i.prototype.getIdleAnimationName=function(){return this._getAnimationPrefix()+"_idle_01"},i.prototype.getWalkAnimationName=function(){return this._getAnimationPrefix()+"_walk_01"},i.prototype.getAttackAnimationName=function(){return this._getAnimationPrefix()+"_att_01"},i.prototype.getDieAnimationName=function(){return this._getAnimationPrefix()+"_die_01"},i}(t.GameRole);t.Hero=e,__reflect(e.prototype,"codearena.Hero")}(codearena||(codearena={}));var cm;!function(t){function e(t,e,i,n,o){void 0===o&&(o=r);var a=new s(t,e,i,n,o);return a.request()}function i(t,e,i,n){void 0===i&&(i=1),void 0===n&&(n=r);var o=new s(t,"GET",e,i,n);return o.request()}function n(t,e,i,n){void 0===i&&(i=1),void 0===n&&(n=r);var o=new s(t,"PUT",e,i,n);return o.request()}function o(t,e,i,n){void 0===i&&(i=1),void 0===n&&(n=r);var o=new s(t,"POST",e,i,n);return o.request()}var r=6e3,s=function(){function e(t,e,i,n,o){void 0===n&&(n=1),void 0===o&&(o=r),this._times=1,this._xhr=null,this._url=t,this._method=e,this._data=i,this._timeout=o,this._times=n}return e.prototype.request=function(e){var i=this;void 0===e&&(e=!1),this._times--;var n=new XMLHttpRequest;return this._xhr=n,n.withCredentials=!0,n.timeout=this._timeout,"GET"===this._method&&(this._url=this._url+t.Utils.serializeParam(this._data)),n.open(this._method,this._url),egret.Capabilities.isMobile&&t.tokens.token&&n.setRequestHeader("Authorization",""+t.tokens.token),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),egret.Capabilities.runtimeType===egret.RuntimeType.NATIVE&&n.setRequestHeader("Cookie",t.cookies.cookie),n.ontimeout=function(){i._onReject(-1)},n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status)try{var t=JSON.parse(n.response);i._onResolve(t)}catch(e){console.error("invalid json format"),i._onReject(-1)}else{var t=null;if(n.response)try{t=JSON.parse(n.response)}catch(e){return console.error("invalid json format"),void i._onReject(-1)}var o={status:n.status,res:t};204===n.status?(i._times=0,i._onReject(o)):i._onReject(o)}},new Promise(function(t,o){e||(i._resolve=t,i._reject=o),"string"==typeof i._data?n.send(i._data):n.send(JSON.stringify(i._data))})},e.prototype._onReject=function(t){return this._xhr.onreadystatechange=null,this._xhr.ontimeout=null,this._xhr=null,this._times>0?void this.request(!0):void this._reject(t)},e.prototype._onResolve=function(t){this._reject=null,this._xhr.onreadystatechange=null,this._xhr.ontimeout=null,this._xhr=null,this._resolve(t)},e}();__reflect(s.prototype,"Request"),t.request=e,t.get=i,t.put=n,t.post=o}(cm||(cm={}));var codearena;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.active=function(e){t.prototype.active.call(this,e);var i=1e3;cm.scheduler.schedule(this,this._createEnemy,i)},e.prototype._createEnemy=function(){},e.prototype.deactive=function(){t.prototype.deactive.call(this),cm.scheduler.unschedule(this,this._createEnemy)},e}(t.MapItem);t.Nest=e,__reflect(e.prototype,"codearena.Nest")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(i){var n=e.call(this,i,t.config.getNpcById(i.typeId))||this;return n._pathIndex=0,n._pathLoop=0,n}return __extends(i,e),i.prototype.init=function(i){this._aiType=i.aiType,this._camp=i.camp,this._objectType=t.ObjectType.NPC,e.prototype.init.call(this,i),this._animation.setLv(i.level),this._visionAreaColor=16477751},i.prototype.startAI=function(){switch(this._aiType){case t.AIType.ACTIVE:this._ai=new t.AIOffensive(this);break;case t.AIType.FIGHT_BACK:this._ai=new t.AIFightback(this);break;default:this._ai=new t.AIFool(this)}this._ai&&this._ai.start()},i.prototype.stopAI=function(){this._ai=null},i.prototype.startPatrol=function(){1===this._cfg.moveType&&this._cfg.path.length>0&&this._cfg.path.length%2===0&&(this.setState(t.RoleState.patrol),this._nextDestination())},i.prototype.patrolFinished=function(){var t=this._cfg.loop;return 0===t?!1:this._pathLoop>=t},i.prototype._nextDestination=function(){var t=this;if(2*this._pathIndex>=this._cfg.path.length-1&&(this._pathIndex=0,this._pathLoop++,this.patrolFinished()))return void this.idle();var e=this._cfg.path[2*this._pathIndex],i=this._cfg.path[2*this._pathIndex+1];this.moveXY(e,i).then(function(){t._pathIndex++,t._nextDestination()})},i.prototype._animationLoaded=function(){e.prototype._animationLoaded.call(this),this.idle()},i.prototype._onEnterFrame=function(){e.prototype._onEnterFrame.call(this),this._ai&&this._ai.onEnterFrame()},Object.defineProperty(i.prototype,"camp",{get:function(){return this._camp},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bulletSpd",{get:function(){return this._roleCfg.bulletSpd},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bulletMod",{get:function(){return this._roleCfg.bulletMod},enumerable:!0,configurable:!0}),i.prototype.setVisionArea=function(t){this._setVisionArea(1===t)},i.prototype.onAttacked=function(t){e.prototype.onAttacked.call(this,t),this._ai&&this._ai.onDamage(t)},i}(t.GameRole);t.Npc=e,__reflect(e.prototype,"codearena.Npc")}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function t(){this._id=0}return t}();t.Prop=e,__reflect(e.prototype,"codearena.Prop")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._code="",t._line=1,t._bg=new eui.Rect,t.addChild(t._bg),t._txt=new eui.Label,t._txt.maxWidth=380,t._txt.lineSpacing=2,t._lineNoTxt=new egret.TextField,t.addChild(t._lineNoTxt),t.addChild(t._txt),t.unSelect(),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAdd,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemove,t),t.touchEnabled=!0,t}return __extends(i,e),i.prototype.onAdd=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},i.prototype.onRemove=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},i.prototype.onTap=function(){var e=t.codeEditor.editor;e.ui.isRuning||e.selectLine(this._line)},i.prototype.cache=function(){},i.prototype.reuse=function(){this.unSelect()},i.prototype.onSelect=function(){this._bg.alpha=1},i.prototype.unSelect=function(){this._bg.alpha=0},i.prototype.setLineNoWidth=function(t){this._lineNoWidth=t,this.setStyle(this._style)},i.prototype.getLineNoWidth=function(){return this._lineNoTxt.width},i.prototype.updateLineHeight=function(){var t=this._style.lineHeight,e=this._txt.height+this._txt.y+10;this.height=Math.max(t,e),this._bg.height=this.height},i.prototype.setCode=function(t,e){t=t.replace("\r",""),this._code=t,this._txt.text=t,void 0!==e&&(this._line=e,this._lineNoTxt.text=e.toString()),this.setStyle(this._style)},i.prototype.getCode=function(){return this._code},i.prototype.isComments=function(){return!!this._code.match(/^\s*#/)},i.prototype.isBlank=function(){return!!this._code.match(/^\s*$/)},i.prototype.setStyle=function(t){if(t){this._style=t,this.height=t.lineHeight;var e;e=this.isComments()?t.commentsColor:t.codeColor,this._txt.textColor=e,this._txt.size=t.fontSize,this._lineNoTxt.textColor=t.lineNoColor,this._lineNoTxt.size=t.fontSize,this._lineNoTxt.y=(t.lineHeight-this._lineNoTxt.textHeight)/2,this._lineNoTxt.x=20-14*(this._lineNoTxt.text.length-1),this._txt.y=this._lineNoTxt.y,this._txt.x=t.codeLeftpad,this.width=this._style.lineWidth,this._bg.width=this.width,this._bg.fillColor=this._style.selectedColor,this._bg.fillAlpha=this._style.selectedAlpha,this.updateLineHeight()}},i}(egret.Sprite);t.CodeLine=e,__reflect(e.prototype,"codearena.CodeLine",["cm.ICacheObject"])}(codearena||(codearena={}));var codearena;!function(t){var e='\n    var $builtinmodule = function (name) {\n        var mod = {};\n        \n        mod.GameObject = Sk.misceval.buildClass(mod, function($gbl, $loc){\n            $loc.__init__ = new Sk.builtin.func(function(self, id){\n                self.id = id;\n            });\n            var getType = new Sk.builtin.func(function(self){\n                var name = arena.getGameObjectType(Sk.ffi.remapToJs(self.id));\n                return Sk.ffi.remapToPy(name);\n            });\n            var getHp = new Sk.builtin.func(function(self){\n                var hp = arena.getGameObjectHp(Sk.ffi.remapToJs(self.id));\n                return Sk.ffi.remapToPy(hp);\n            });\n            var getPos = new Sk.builtin.func(function(self){\n                var pos = arena.getGameObjectPos(Sk.ffi.remapToJs(self.id));\n                return Sk.misceval.callsimOrSuspend(mod.Pos, pos.column, pos.row);\n            });\n            $loc.type = Sk.misceval.callsimOrSuspend(Sk.builtins.property, getType);\n            $loc.hp = Sk.misceval.callsimOrSuspend(Sk.builtins.property, getHp);\n            $loc.pos = Sk.misceval.callsimOrSuspend(Sk.builtins.property, getPos);\n        });\n\n        mod.Pos = Sk.misceval.buildClass(mod, function($gbl, $loc){\n            $loc.__init__ = new Sk.builtin.func(function(self, x, y){\n                self.x = x;\n                self.y = y;\n            });\n            var getX = new Sk.builtin.func(function(self){\n                return Sk.ffi.remapToPy(self.x);\n            });\n            var getY = new Sk.builtin.func(function(self){\n                return Sk.ffi.remapToPy(self.y);\n            });\n            $loc.x = Sk.misceval.callsimOrSuspend(Sk.builtins.property, getX);\n            $loc.y = Sk.misceval.callsimOrSuspend(Sk.builtins.property, getY);\n        }, "Pos", []);\n\n        mod.moveDirection = new Sk.builtin.func(function (direction, step) {\n            Sk.builtin.pyCheckArgs("moveDirection", arguments, 2, 2);\n            Sk.builtin.pyCheckType("direction", "string", Sk.builtin.checkString(direction));\n            Sk.builtin.pyCheckType("step", "number", Sk.builtin.checkNumber(step));\n\n            const prom = hero.moveDirection(Sk.ffi.remapToJs(direction), Sk.ffi.remapToJs(step));\n\n            var susp = new Sk.misceval.Suspension();\n\n            susp.resume = function () {\n                return Sk.builtin.none.none$;\n            };\n\n            susp.data = {\n                type: "Sk.promise",\n                promise: prom\n            };\n\n            return susp;\n        });\n\n        mod.moveXY = new Sk.builtin.func(function (x, y) {\n            Sk.builtin.pyCheckArgs("moveXY", arguments, 2, 2);\n            Sk.builtin.pyCheckType("x", "number", Sk.builtin.checkNumber(x));\n            Sk.builtin.pyCheckType("y", "number", Sk.builtin.checkNumber(y));\n\n            const prom = hero.moveXY(Sk.ffi.remapToJs(x), Sk.ffi.remapToJs(y))\n\n            var susp = new Sk.misceval.Suspension();\n\n            susp.resume = function () {\n                if (err) {\n                    throw new Sk.builtin.ValueError(err);\n                } else {\n                    return Sk.builtin.none.none$;\n                }\n            };\n\n            susp.data = {\n                type: "Sk.promise",\n                promise: prom.then(function () {\n                    err = "";\n                }).catch(function (msg) {\n                    err = msg;\n                })\n            };\n\n            return susp;\n        });\n\n        mod.attack = new Sk.builtin.func(function (obj) {\n            Sk.builtin.pyCheckArgs("attack", arguments, 1, 1);\n            var value = Sk.ffi.remapToJs(obj);\n            if(typeof(value) !== "string"){\n                value = obj.id;\n            }\n            const prom = hero.attack(value);\n\n            var susp = new Sk.misceval.Suspension();\n\n            susp.resume = function () {\n                if (err) {\n                    throw new Sk.builtin.ValueError(err);\n                } else {\n                    return Sk.builtin.none.none$;\n                }\n            };\n\n            susp.data = {\n                type: "Sk.promise",\n                promise: prom.then(function () {\n                    err = "";\n                }).catch(function (msg) {\n                    err = msg;\n                })\n            };\n\n            return susp;\n        });\n\n        mod.say = new Sk.builtin.func(function (s) {\n            Sk.builtin.pyCheckArgs("say", arguments, 1, 1);\n            Sk.builtin.pyCheckType("s", "string", Sk.builtin.checkString(s));\n\n            const prom = hero.say(Sk.ffi.remapToJs(s));\n\n            var susp = new Sk.misceval.Suspension();\n\n            susp.resume = function () {\n                if (err) {\n                    throw new Sk.builtin.ValueError(err);\n                } else {\n                    return Sk.builtin.none.none$;\n                }\n            };\n\n            susp.data = {\n                type: "Sk.promise",\n                promise: prom.then(function () {\n                    err = "";\n                }).catch(function (msg) {\n                    err = msg;\n                })\n            };\n\n            return susp;\n        });\n\n        mod.findNearestEnemy = new Sk.builtin.func(function () {\n            Sk.builtin.pyCheckArgs("findNearestEnemy", arguments, 0, 0);\n            var id = hero.findNearestEnemy();\n            if (id) {\n                return Sk.misceval.callsimOrSuspend(mod.GameObject, id);\n            } else {\n                return Sk.builtin.none.none$;\n            }\n        });\n\n        mod.findNearestGem = new Sk.builtin.func(function () {\n            Sk.builtin.pyCheckArgs("findNearestGem", arguments, 0, 0);\n            var id = hero.findNearestGem();\n            if (id) {\n                return Sk.misceval.callsimOrSuspend(mod.GameObject, id);\n            } else {\n                return Sk.builtin.none.none$;\n            }\n        });\n\n\n        mod.findNearestItem = new Sk.builtin.func(function () {\n            Sk.builtin.pyCheckArgs("findNearestItem", arguments, 0, 0);\n            var id = hero.findNearestItem();\n            if (id) {\n                return Sk.misceval.callsimOrSuspend(mod.GameObject, id);\n            } else {\n                return Sk.builtin.none.none$;\n            }\n        });\n\n        mod.distanceTo = new Sk.builtin.func(function (obj) {\n            Sk.builtin.pyCheckArgs("distanceTo", arguments, 1, 1);\n            var distance = hero.distanceTo(Sk.ffi.remapToJs(obj.id));\n            if (distance === -1) {\n                throw new Sk.builtin.ValueError("invalid id");\n            } else {\n                return new Sk.builtin.float_(distance);\n            }\n        });\n        mod.getEnemyLevel = new Sk.builtin.func(function (obj) {\n            Sk.builtin.pyCheckArgs("getEnemyLevel", arguments, 1, 1);\n            var level = hero.getEnemyLevel(Sk.ffi.remapToJs(obj.id));\n            if (level === null) {\n                throw new Sk.builtin.ValueError("invalid id");\n            } else {\n                return new Sk.builtin.int_(level);\n            }\n        });\n\n        mod.pickUpCoin = new Sk.builtin.func(function () {\n            Sk.builtin.pyCheckArgs("pickUpCoin", arguments, 0, 0);\n            var result = hero.pickUpCoin();\n            return Sk.builtin.none.none$;\n        });\n\n        mod.getHp = new Sk.builtin.func(function () {\n            var hp = hero.getHp();\n            return new Sk.builtin.int_(hp);\n        });\n\n        return mod;\n    }\n    ',i='\nfrom game import *\n\nclass Hero(object):\n    def _moveDirection(self, direction, step):\n        return moveDirection(direction, step)\n\n    def move_up(self, step=1):\n        return self._moveDirection("up", step=step)\n\n    def move_down(self, step=1):\n        return self._moveDirection("down", step=step)\n\n    def move_right(self, step=1):\n        return self._moveDirection("right", step=step)\n\n    def move_left(self, step=1):\n        return self._moveDirection("left", step=step)\n\n    def move_xy(self, x, y):\n        return moveXY(x, y)\n\n    def attack(self, id):\n        return attack(id)\n    \n    def say(self, s):\n        return say(s)\n\n    def find_nearest_enemy(self):\n        return findNearestEnemy()\n    \n    def find_nearest_gem(self):\n        return findNearestGem()\n\n    def find_nearest_item(self):\n        return findNearestItem()\n\n    def distance_to(self, id):\n        return distanceTo(id)\n\n    def get_enemy_level(self,id):\n        return getEnemyLevel(id)\n\n    def pickup_coin(self):\n        return pickUpCoin()\n\n    @property\n    def hp(self):\n        return getHp()\n',n=function(){function n(){}return n.prototype.init=function(){var e=this;
t.Global.IS_UBT||cm.Utils.loadScript(["libs/skulpt.min.js","libs/skulpt-stdlib.js"],function(){console.log("skulpt loaded!"),e.initSkulpt(),e.initEditor()})},n.prototype.initSkulpt=function(){this.Sk=window.Sk,this.customModules={"/hero/__init__.py":i,"/hero/game.js":e},this.Sk.onCodeLineChange=this.onCodeLineChange.bind(this)},n.prototype.useHtmlEditor=function(){return!cnUtils.IS_Mobile()},n.prototype.editorEnabled=function(){return!t.Global.IS_UBT},n.prototype.initEditor=function(){var e=this;if(this.useHtmlEditor()){var i=window.__app_root;cm.Utils.loadScript([i+"libs/ace/ace.js",i+"libs/ace/mode-python.js",i+"libs/ace/theme-monokai.js"],function(){console.log("ace editor loaded!"),e.editor=new t.PcCodeEditor})}else this.editor=new t.MobileCodeEditor},n.prototype.builtinRead=function(t){if(void 0!==this.customModules[t])return this.customModules[t];if(void 0===this.Sk.builtinFiles||void 0===this.Sk.builtinFiles.files[t])throw"File not found: "+t;return this.Sk.builtinFiles.files[t]},n.prototype.print=function(t){console.log(t)},n.prototype.onCodeLineChange=function(t){var e=this.codeLineMap[t];e&&this.editor.gotoLine(e-3)},n.prototype.run=function(e){if(!t.Global.IS_UBT){var i=this.Sk,n=this.editor;n.setReadOnly(!0);var o=["import time\n","from hero import Hero\n","coder = Hero()\n",this.editor.getCode()],r=o.join("");i.python3=!0,i.builtin.KeyboardInterrupt=function(t){var e;return this instanceof i.builtin.KeyboardInterrupt?void i.builtin.BaseException.apply(this,arguments):(e=Object.create(i.builtin.KeyboardInterrupt.prototype),e.constructor.apply(e,arguments),e)},i.abstr.setUpInheritance("KeyboardInterrupt",i.builtin.KeyboardInterrupt,i.builtin.BaseException),i.configure({output:this.print,read:this.builtinRead.bind(this),execLimit:1e3*e});var s=function(t){if(i.hardInterrupt===!0)throw new i.builtin.KeyboardInterrupt("aborted execution");return null};this.codeLineMap=[];for(var a=r.split("\n"),c=[],h=0,l=0;l<a.length;l++){var p=a[l],u=l+1,d=u+h;c[d]=p,this.codeLineMap[d+1]=u;var _=p.lastIndexOf("while True:");if(-1!==_){var f=" ";c[d+1]=f.repeat(_)+"    time.sleep(0.1)",this.codeLineMap[u+1+1]=u+1,h++}}return r=c.join("\n"),r=r.replace(/\t/g,"    "),i.misceval.asyncToPromise(function(){return i.importMainWithBody("<stdin>",!1,r,!0)},{"*":s})}},n.prototype.stop=function(){t.Global.IS_UBT||(this.Sk.configure({execLimit:0}),this.editor.setReadOnly(!1))},n.prototype.codeLines=function(){if(t.Global.IS_UBT)return 0;String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};for(var e=0,i=this.editor.getCode().match(/[^\r\n]+/g),n=0;n<i.length;n++)i[n].trim()&&"#"!=i[n].trim()[0]&&e++;return e},n.prototype.selectline=function(t){this.editor.selectLine(t)},n.prototype.clearSelection=function(){t.Global.IS_UBT||this.editor.clearSelection()},n.prototype.show=function(e,i,n,o,r){t.Global.IS_UBT||this.editor.show(e,i,n,o,r)},n.prototype.hide=function(){t.Global.IS_UBT||this.editor.hide()},n.prototype.setCode=function(e){t.Global.IS_UBT||this.editor.setCode(e)},n.prototype.getCode=function(){return t.Global.IS_UBT?"":this.editor.getCode()},n.prototype.insert=function(t){this.editor.insert(t)},n}();__reflect(n.prototype,"CodeEditor"),t.codeEditor=new n}(codearena||(codearena={}));var codearena;!function(t){t.mobileStyle={fontSize:24,codeColor:parseInt("0xfee5a9"),lineHeight:52,lineWidth:448,lineNoColor:parseInt("0xFFFFFF"),commentsColor:parseInt("0xa3dbff"),reservedColor:parseInt("0x0000FF"),lineNoLeftpad:10,selectedColor:parseInt("0x65a97d"),selectedAlpha:1,codeLeftpad:50,lineNoBgColor:0,lineNoBgAlpha:0};var e=function(e){function i(){var t=e.call(this)||this;return t._currentLine=0,t._lines=[],t.touchEnabled=!0,t}return __extends(i,e),i.prototype.init=function(t){this.ui=t,this._lineNoBg=new egret.Shape,this.ui.gpContent.addChildAt(this._lineNoBg,0)},i.prototype.selectLine=function(t){var e=this._lines[this._currentLine-1];if(e&&e.unSelect(),t>0&&t<=this._lines.length){this._currentLine=t,e=this._lines[this._currentLine-1],e&&e.onSelect();var i=this.getSelectedLineCode();this.ui.setEditEnable(!0,i),this.fixScollV(t)}else this.ui.btnDel.enable=!1,this.ui.btnModify.enable=!1,this.ui.btnTab.enable=!1,this.ui.btnDel.enable=!1,this.ui.btnAdd.enable=!0},i.prototype.fixScollV=function(t){this.ui&&this.ui.fixLineSelect(t-1)},i.prototype.setIndent=function(t){if(!(this._currentLine<1||this._currentLine>this._lines.length)){var e=this.getSelectedLineCode(),i=this.getSelectedLine();if(i)if(t>0)e=" ".repeat(t)+e,i.setCode(e);else if(0>t){t=-t;for(var n=0;n<e.length;n++)if(" "!==e.charAt(n)||n>t-1){e=e.substring(n),i.setCode(e);break}}}},i.prototype.gotoLine=function(t){this.selectLine(t)},i.prototype.clearSelection=function(){var t=this.getSelectedLine();t&&t.unSelect(),this._currentLine=0,this.ui.setEditEnable(!1)},i.prototype.getSelectedLineCode=function(){var t=this._lines[this._currentLine-1];return t?t.getCode():""},i.prototype.getSelectedLine=function(){var t=this._lines[this._currentLine-1];return t?t:null},i.prototype.getCode=function(){var t=this._lines.map(function(t){return t.getCode()});return t.join("\n")},i.prototype.setCode=function(t){var e=this;t=t.replace(/\t/g,"    "),this._currentLine=0;var i=t.split("\n");for(i.forEach(function(t,i){e._addLine(t,!1)});this._lines.length>i.length;)this._removeLine(this._lines.length-1);this.ui.fixLineSelect(0)},i.prototype._addLine=function(e,i){void 0===i&&(i=!0);var n=this._currentLine,o=cm.cachePool.get(t.CodeLine);o.setStyle(t.mobileStyle);var r=i?this._getIndent(e,n):"";o.setCode(r+e,n),this.ui.gpLines.addChild(o),this._lines.splice(n,0,o),this._updateLineNo(),this.selectLine(n+1)},i.prototype._getIndent=function(t,e){var i=e-1;if(i>0){var n=this._lines[i];if(n||(n=this._lines[i-1]),!n)return"";var o=n.getCode(),r=o.match(/^\s*/),s=/^\s*(while\s|if\s|else:|elif\s|for\s)/.test(o),a=/^s*else:$/.test(t);if(r){var c=r[0];return s&&(c+="    "),a&&c.length>=4&&(c=" ".repeat(c.length-4)),c}}return""},i.prototype._removeLine=function(t){var e=this._lines[t];e&&(this._lines.splice(t,1),e.parent&&e.parent.removeChild(e),cm.cachePool.put("CodeLine",e),this._updateLineNo()),this._currentLine>this._lines.length&&this.selectLine(this._currentLine-1),this.clearSelection()},i.prototype.insert=function(t){var e=this,i=t.split("\n");i.forEach(function(t,i){e._addLine(t)})},i.prototype.deleteLine=function(){this._removeLine(this._currentLine-1)},i.prototype.replaceLine=function(t){var e=this._lines[this._currentLine-1];if(e){var i=e.getCode(),n="",o=i.match(/^\s*/);""===i?n=this._getIndent(t,this._currentLine-1):o&&(n=o[0]),e.setCode(n+t,this._currentLine),this.selectLine(this._currentLine),this.ui.updateContent(this._lines)}},i.prototype.setReadOnly=function(t){},i.prototype.show=function(e,i,n,o,r){var s=t.codeEditor.editor.getView();this.width=r.width,this.height=r.height,this.graphics.clear(),this.graphics.beginFill(0,0),this.graphics.drawRect(0,0,this.width,this.height),this.graphics.endFill(),r.contains(this)||r.addChild(s),this.ui.onFastOpen()},i.prototype._onTap=function(e){var i=Math.floor(e.localY/t.mobileStyle.lineHeight);this.selectLine(i+1)},i.prototype.hide=function(){this.ui.onFastClose(),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this._onTap,this)},i.prototype.getView=function(){return this},i.prototype._updateLineNo=function(){var e=0;this._lines.forEach(function(t,i){t.setCode(t.getCode(),i+1);var n=t.getLineNoWidth();n>e&&(e=n)}),e+=30,this._lines.forEach(function(t){t.setLineNoWidth(e)}),this._lineNoBg.graphics.clear(),this._lineNoBg.graphics.beginFill(t.mobileStyle.lineNoBgColor,t.mobileStyle.lineNoBgAlpha),this._lineNoBg.graphics.drawRect(0,0,e,t.mobileStyle.lineHeight*this._lines.length),this._lineNoBg.graphics.endFill(),this.ui.updateContent(this._lines)},i.prototype.getLines=function(){return this._lines},i}(egret.Sprite);t.MobileCodeEditor=e,__reflect(e.prototype,"codearena.MobileCodeEditor",["codearena.PythonEditor"])}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.sLine=-1,t.skinName="MobileEditor",t.right=0,t}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.scroller&&(this.scroller.verticalScrollBar.skinName="VMyScrollerBar",this.btnRun.label="run",this.btnDel.label="del",this.btnModify.label="edit",this.btnTab.label="tab",this.btnAdd.label="add"),this.isRuning=!1,this.gpMask.visible=!1,t.gameControl.addEventListener(t.EVENT_RUNCODE_OVER,this.onRunEnd,this),this.addEventListener(egret.Event.ENTER_FRAME,this.onTick,this)},i.prototype.onTick=function(){-1!=this.sLine&&this.fixScrollerV(this.sLine)},i.prototype.onRemove=function(){e.prototype.onRemove.call(this),t.gameControl.removeEventListener(t.EVENT_RUNCODE_OVER,this.onRunEnd,this),this.removeEventListener(egret.Event.ENTER_FRAME,this.onTick,this)},i.prototype.resetButton=function(){this.btnRun.onCancel(),this.btnDel.onCancel(),this.btnModify.onCancel(),this.btnTab.onCancel(),this.btnAdd.onCancel(),this.btnStop.onCancel()},i.prototype.onComplete=function(){e.prototype.onComplete.call(this);var i=t.codeEditor.editor;i.init(this),this.btnRun.label="run",this.btnDel.label="del",this.btnModify.label="edit",this.btnTab.label="tab",this.btnAdd.label="add",this.btnStop.label="stop",cnUtils.touchTap(this.btnRun,this.onBtnRun,this),cnUtils.touchTap(this.btnAdd,this.onBtnAdd,this),cnUtils.touchTap(this.btnDel,this.onBtnDel,this),cnUtils.touchTap(this.btnModify,this.onBtnModify,this),cnUtils.touchTap(this.btnTab,this.onBtnTab,this),cnUtils.touchTap(this.btnTips,this.onBtnTips,this),cnUtils.touchTap(this.btnClose,this.onClose,this),cnUtils.touchTap(this.btnOpen,this.onOpen,this),cnUtils.touchTap(this.btnStop,this.onStop,this),this.btnStop.visible=!1,this.scroller.verticalScrollBar&&(this.scroller.verticalScrollBar.skinName="VMyScrollerBar")},i.prototype.onStop=function(){t.gameControl.stop(),this.onRunEnd()},i.prototype.onClose=function(){egret.Tween.removeTweens(this),egret.Tween.get(this).to({right:-this.width+13},500,egret.Ease.cubicInOut),this.btnClose.visible=!1,this.btnOpen.visible=!0},i.prototype.onOpen=function(){egret.Tween.removeTweens(this),egret.Tween.get(this).to({right:0},500,egret.Ease.cubicInOut),this.btnOpen.visible=!1,this.btnClose.visible=!0},i.prototype.onFastClose=function(){this.right=-this.width+13,this.btnClose.visible=!1,this.btnOpen.visible=!0},i.prototype.onFastOpen=function(){this.right=0,this.btnClose.visible=!0,this.btnOpen.visible=!1},i.prototype.onBtnRun=function(){var e=t.gameControl;e.run(),this.btnAdd.enable=!1,this.btnDel.enable=!1,this.btnModify.enable=!1,this.btnRun.enable=!1,this.btnTab.enable=!1,this.isRuning=!0,this.btnStop.visible=!0,this.btnRun.visible=!1,this.gpMask.visible=!0,this.btnRun.label="runAgain"},i.prototype.onRunEnd=function(){this.btnAdd.enable=!0,this.btnDel.enable=!0,this.btnModify.enable=!0,this.btnRun.enable=!0,this.btnTab.enable=!0,this.isRuning=!1,this.btnStop.visible=!1,this.btnRun.visible=!0,this.gpMask.visible=!1},i.prototype.onBtnAdd=function(){var e=t.codeEditor.editor;e.insert(""),t.codeControl.title="新增",t.codeControl.getLevel(t.gameControl.currentLevel);var i=new t.PanelFuncChoose;t.Alert.show(i,{bg:!0,clickBgClose:!0})},i.prototype.onBtnDel=function(){var e=t.codeEditor.editor;t.Alert.show(new t.PanelMobileDelTips(function(){var e=t.codeEditor.editor,i=e.getSelectedLineCode();i.trim()?e.replaceLine(""):e.deleteLine()},e.getSelectedLineCode()),{bg:!0,clickBgClose:!0})},i.prototype.onBtnModify=function(){t.codeControl.getLevel(t.gameControl.currentLevel),t.codeControl.title="修改";var e=new t.PanelFuncChoose;t.Alert.show(e,{bg:!0,clickBgClose:!0})},i.prototype.onBtnTab=function(){t.Alert.show(new t.PanelMobileTab,{bg:!0,clickBgClose:!0})},i.prototype.onBtnTips=function(){t.Sound.button();var e="./resource/tips/"+t.gameControl.currentLevel+".png",i=new t.BattleTipPanel(e);t.Alert.show(i,{bg:!0,clickBgClose:!1,addToMain:!1})},i.prototype.updateContent=function(t){for(var e=0,i=0,n=t.length;n>i;i++){var o=t[i];o.y=e,e+=o.height}this.gpLines.height=e},i.prototype.fixScrollerV=function(e){var i=t.codeEditor.editor,n=this.scroller.viewport.scrollV,o=this.gpLines.height-this.scroller.height;o=o>0?o:0;for(var r=0,s=i.getLines(),a=0;e>a;a++)r+=s[a].height;var c=r>o?o:r;(n>=r||n+this.scroller.height<=r+s[e].height||n>o)&&(this.scroller.viewport.scrollV=c),this.sLine=-1},i.prototype.fixLineSelect=function(t){this.isRuning?this.sLine=t:this.fixScrollerV(t)},i.prototype.setEditEnable=function(t,e){void 0===e&&(e=""),this.isRuning||(this.btnAdd.enable=t,this.btnModify.enable=t,this.btnDel.enable=t,this.btnTab.enable=t&&""!=e.trim())},i}(cm.EUIComponent);t.MobileCodeEditorUI=e,__reflect(e.prototype,"codearena.MobileCodeEditorUI")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function n(t,i){var n=e.call(this)||this;return n.campare=[">","<","==",">=","<=","!="],n.maxNumLength=6,n.control=t,n.level=i,n.skinName="PanelChoose",n}return __extends(n,e),n.prototype.onComplete=function(){e.prototype.onComplete.call(this),this.list.itemRenderer=i,cnUtils.onItemTap(this.list,this.onTap,this),cnUtils.touchTap(this.btnBack,this.onBack,this),cnUtils.touchTap(this.btnClose,this.onClose,this),this.initNumGroup(),this.initCampareGroup(),this.update(),this.updateLabel(),this.playLineAni()},n.prototype.onRemove=function(){e.prototype.onRemove.call(this),egret.Tween.removeTweens(this.imgLine)},n.prototype.getMesureLabelWidth=function(t){return null==this.measureLabel&&(this.measureLabel=new eui.Label,this.measureLabel.size=this.lbDesc.size,this.measureLabel.fontFamily=this.lbDesc.fontFamily,this.measureLabel.bold=this.lbDesc.bold),this.measureLabel.text=t,this.measureLabel.width},n.prototype.initNumGroup=function(){for(var t=0,e=10;e>t;t++){var i=this["btnNum"+t];i.labelDisplay.size=26,cnUtils.touchTap(i,this.onNumPress.bind(this,t),this)}cnUtils.touchTap(this.btnNumDel,this.onNumDel,this),cnUtils.touchTap(this.btnNumYes,this.onNumYes,this)},n.prototype.initCampareGroup=function(){for(var t=0,e=this.campare.length;e>t;t++){var i=this.gpCampare.getChildAt(t);i.visible=!0,i.label=this.campare[t],cnUtils.touchTap(i,this.onCamparePress.bind(this,t),this)}for(e=this.gpCampare.numChildren-1;e>t;t++){var n=this.gpCampare.getChildAt(t);n.visible=!1}var o=this.gpCampare.getChildAt(e);o.visible=!0,o.label="跳过",cnUtils.touchTap(o,this.onCompareEnd,this)},n.prototype.onCamparePress=function(t){var e=this.campare[t];this.control.setInput(e),this.control.setConfirm(),this.update(),this.updateLabel()},n.prototype.onCompareEnd=function(){this.onClose(),t.codeEditor.editor.replaceLine(t.codeControl.getFormatStr(!1))},n.prototype.onNumYes=function(){var e=this.control.getInput();(0!=e.length||this.control.hasDefault())&&(this.control.setConfirm(),this.updateNum(),this.updateLabel(),(this.control.isEnd()||this.control.hasDefault())&&(this.onClose(),t.codeEditor.editor.replaceLine(t.codeControl.getFormatStr(!1))))},n.prototype.updateNum=function(){var t=this.control.getInput();this.control.hasDefault()?this.btnNumYes.enabled=!0:0==t.length?this.btnNumYes.enabled=!1:this.btnNumYes.enabled=!0;for(var e=t.length<this.maxNumLength,i=0,n=10;n>i;i++){var o=this["btnNum"+i];o.enabled=e}},n.prototype.onNumDel=function(){this.control.delNumberInput(),this.updateNum(),this.updateLabel()},n.prototype.onNumPress=function(t){var e=this.control.getInput();e.length>=this.maxNumLength||("0"==e?e=""+t:e+=""+t,this.control.setInput(e),this.updateNum(),this.updateLabel())},n.prototype.onBack=function(){1==this.level?(this.onClose(),1==t.codeControl.chooseList.length?t.Alert.show(new t.PanelFuncChoose,{bg:!0,clickBgClose:!0}):t.Alert.show(new t.PanelRootChoose(t.codeControl,0),{bg:!0,clickBgClose:!0})):(this.control.onBack(),this.update())},n.prototype.onTap=function(e){e.item;this.control.setInput(e.item),this.control.setConfirm(),this.control.isEnd()?(this.updateLabel(),this.onClose(),t.codeEditor.editor.replaceLine(t.codeControl.getFormatStr(!1))):(this.updateLabel(),this.update())},n.prototype.onClose=function(){var e=this.parent;e&&e instanceof t.Alert&&e.hide()},n.prototype.updateLabel=function(){this.lbDesc.text=t.codeControl.getFormatStr();var e=this.control.getFormatStrBefore(),i=this.getMesureLabelWidth(e);this.imgLine.left=i},n.prototype.update=function(){var e=this.control.chooseList[0];switch(e){case t.InputType.number:this.scroller.visible=!1,this.gpCampare.visible=!1,this.updateNum(),this.gpNum.visible=!0;break;case t.InputType.compare:this.scroller.visible=!1,this.gpCampare.visible=!0,this.gpNum.visible=!1;break;default:this.scroller.visible=!0,this.gpCampare.visible=!1,this.gpNum.visible=!1;var i=this.control.chooseList;this.list.dataProvider=new eui.ArrayCollection(i)}},n.prototype.playLineAni=function(){egret.Tween.get(this.imgLine,{loop:!0}).wait(200).to({alpha:0},400).to({alpha:1},400)},n}(cm.EUIComponent);t.PanelChoose=e,__reflect(e.prototype,"codearena.PanelChoose");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="WidgetChoose",e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.lbDesc.size=26,this.lbDesc.text=this.data,this.lbDesc.width>300&&(this.lbDesc.size=22)},e}(eui.ItemRenderer);t.WidgetChoose=i,__reflect(i.prototype,"codearena.WidgetChoose")}(codearena||(codearena={}));var codearena;!function(t){t.CODETYPE={"var":"var"};var e=function(e){function i(){var t=e.call(this)||this;return t.functionList=["move","attack","var","loop","judge"],t.skinName="PanelFuncChoose",t}return __extends(i,e),i.prototype.onComplete=function(){e.prototype.onComplete.call(this),cnUtils.touchTap(this.btnClose,this.onClose,this);for(var i=0,n=this.gpChoose.numChildren;n>i;i++){var o=this.gpChoose.getChildAt(i);cnUtils.touchTap(o,this.onTouch.bind(this,i),this),o.enabled=t.codeControl.activeFunc[this.functionList[i]]}this.lbTitle.text=t.codeControl.title},i.prototype.onTouch=function(e){var i=t.codeControl;if(i.getType(this.functionList[e]),1==i.chooseList.length){i.setSelect(i.chooseList[0]);var n=new t.PanelChoose(i.child,1);this.onClose(),t.Alert.show(n,{bg:!0,clickBgClose:!0})}else{var n=new t.PanelRootChoose(i,0);this.onClose(),t.Alert.show(n,{bg:!0,clickBgClose:!0})}},i.prototype.onClose=function(){var e=this.parent;e&&e instanceof t.Alert&&e.hide()},i}(cm.EUIComponent);t.PanelFuncChoose=e,__reflect(e.prototype,"codearena.PanelFuncChoose")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(t,i){var n=e.call(this)||this;return n.confirmCb=t,n.lineCode=i.trim(),n.skinName="PanelMobileDelTips",n}return __extends(i,e),i.prototype.onComplete=function(){e.prototype.onComplete.call(this),cnUtils.touchTap(this.btnClose,this.onClose,this),cnUtils.touchTap(this.btnConfirm,this.onConfirm,this),cnUtils.touchTap(this.btnCancel,this.onClose,this),this.lineCode?this.lbDesc.text="是否清空当前行代码":this.lbDesc.text="是否删除此空白行"},i.prototype.onClose=function(){var e=this.parent;e&&e instanceof t.Alert&&e.hide()},i.prototype.onConfirm=function(){this.onClose(),this.confirmCb&&this.confirmCb()},i}(cm.EUIComponent);t.PanelMobileDelTips=e,__reflect(e.prototype,"codearena.PanelMobileDelTips")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName="PanelMobileTab",t}return __extends(i,e),i.prototype.onComplete=function(){e.prototype.onComplete.call(this),cnUtils.touchTap(this.btnClose,this.onClose,this),cnUtils.touchTap(this.btnLeft,this.onLeft,this),cnUtils.touchTap(this.btnRight,this.onRight,this)},i.prototype.onClose=function(){var e=this.parent;e&&e instanceof t.Alert&&e.hide()},i.prototype.onLeft=function(){var e=t.codeEditor.editor;e.setIndent(-4)},i.prototype.onRight=function(){var e=t.codeEditor.editor;e.setIndent(4)},i}(cm.EUIComponent);t.PanelMobileTab=e,__reflect(e.prototype,"codearena.PanelMobileTab")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(t,i){var n=e.call(this)||this;return n.control=t,n.level=i,n.skinName="PanelRootChoose",n}return __extends(i,e),i.prototype.onComplete=function(){e.prototype.onComplete.call(this),this.list.itemRenderer=t.WidgetChoose;for(var i=[],n=0,o=this.control.chooseList.length;o>n;n++)null!=this.control.cdata[this.control.chooseList[n]]&&i.push(this.control.chooseList[n]);this.list.dataProvider=new eui.ArrayCollection(i),cnUtils.onItemTap(this.list,this.onTap,this),cnUtils.touchTap(this.btnBack,this.onBack,this),cnUtils.touchTap(this.btnClose,this.onClose,this),this.lbTitle.text=this.control.getSubTitle()},i.prototype.onTap=function(e){e.item;this.control.setSelect(e.item),this.onClose(),this.control.child.isEnd()?t.codeEditor.editor.replaceLine(this.control.getFormatStr()):t.Alert.show(new t.PanelChoose(this.control.child,this.level+1),{bg:!0,clickBgClose:!0})},i.prototype.onClose=function(){var e=this.parent;e&&e instanceof t.Alert&&e.hide()},i.prototype.onBack=function(){this.onClose(),t.Alert.show(new t.PanelFuncChoose,{bg:!0,clickBgClose:!0})},i}(cm.EUIComponent);t.PanelRootChoose=e,__reflect(e.prototype,"codearena.PanelRootChoose")}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function t(){this._ace=window.ace,this._init()}return t.prototype._init=function(){this._editor=this._ace.edit("editor"),this._editor.$blockScrolling=1/0,this._editor.setTheme("ace/theme/monokai"),this._editor.getSession().setMode("ace/mode/python")},t.prototype.gotoLine=function(t){this._editor.gotoLine(t)},t.prototype.selectLine=function(t){},t.prototype.setIndent=function(t){},t.prototype.clearSelection=function(){this._editor.clearSelection()},t.prototype.getCode=function(){return this._editor.getValue()},t.prototype.setCode=function(t){this._editor.setValue(t)},t.prototype.insert=function(t){this._editor.insert(t)},t.prototype.deleteLine=function(){this._editor.deleteLine()},t.prototype.replaceLine=function(t){},t.prototype.setReadOnly=function(t){this._editor.setReadOnly(t)},t.prototype.getValue=function(){return this._editor.getValue()},t.prototype.setValue=function(t){this._editor.setValue(t)},t.prototype.show=function(t,e,i,n,o){var r=document.getElementById("editor");r.style.display="block",r.style.top=t.toFixed(1)+"px",r.style.right=e.toFixed(1)+"px",r.style.bottom=i.toFixed(1)+"px",r.style.width=n.toFixed(1)+"px",this._editor.setFontSize(16)},t.prototype.hide=function(){var t=document.getElementById("editor");t.style.display="none"},t.prototype.getView=function(){var t=document.getElementById("editor");return t},t}();t.PcCodeEditor=e,__reflect(e.prototype,"codearena.PcCodeEditor",["codearena.PythonEditor"])}(codearena||(codearena={}));var clib;!function(t){function e(e,i,n){t.dbFactory.getDragonBonesData(e)&&t.dbFactory.getTextureAtlasData(e)&&i&&i.call(n);var o,r,s,a=e+"_ske_json",c=e+"_tex_json",h=e+"_tex_png";egret.assert(RES.hasRes(a),"loadArmatureRes: skeleton not found("+a+")"),egret.assert(RES.hasRes(c),"loadArmatureRes: spritesheet not found("+c+")"),egret.assert(RES.hasRes(h),"loadArmatureRes: texture not found("+h+")");var l=function(){if(o&&r&&s){if(t.dbFactory.getDragonBonesData(e)&&t.dbFactory.getTextureAtlasData(e))return i&&i.call(n);t.dbFactory.parseDragonBonesData(o),t.dbFactory.parseTextureAtlasData(s,r),egret.log("load armature: "+e),i&&i.call(n)}};RES.getResAsync(a,function(t){o=t,l()},null),RES.getResAsync(c,function(t){s=t,l()},null),RES.getResAsync(h,function(t){r=t,l()},null)}function i(e){return null!=t.dbFactory.getDragonBonesData(e)&&t.dbFactory.getTextureAtlasData(e)}t.dbFactory=new dragonBones.EgretFactory,t.loadArmtrueRes=e;var n=function(n){function r(t){var o=n.call(this)||this;return o._loop=-1,o._addClock=!1,o._timeScale=1,o._name=t,i(o._name)?o.onArmatureLoad():e(o._name,o.onArmatureLoad,o),o.addEventListener(egret.Event.ADDED_TO_STAGE,o.onAdd,o),o.addEventListener(egret.Event.REMOVED_FROM_STAGE,o.onRemoved,o),o}return __extends(r,n),Object.defineProperty(r.prototype,"armatureName",{get:function(){return this.display.name},enumerable:!0,configurable:!0}),r.prototype.onArmatureLoad=function(){this.display=t.dbFactory.buildArmature("armatureName",this._name),this.addChildAt(this.display.display,0),this.onAdd(),(this._byAnimComplete||this._onceAnimComplete)&&this.display.addEventListener(dragonBones.Event.COMPLETE,this.onAnimComplete,this),(this._byLoopComplete||this._onceLoopComplete)&&this.display.addEventListener(dragonBones.Event.LOOP_COMPLETE,this.onLoopComplete,this),this._anim&&this.play(this._anim,this._loop),this.display.animation.timeScale=this._timeScale,this.updateSlotDisplay()},r.prototype.updateSlotDisplay=function(){if(this.slotDisplay){for(var e in this.slotDisplay){var i=this.slotDisplay[e],n=this.display.getSlot(e);if(n)i instanceof egret.DisplayObject?n.setDisplay(i):t.dbFactory.replaceSlotDisplay(this._name,this._name,e,i,this.display.getSlot(e));else{var o=this._name;egret.error("Armature.setSlotDisplay: slot not found("+e+" in "+o+")")}}this.slotDisplay=null}},r.prototype.changeSlotDisplay=function(t,e){this.slotDisplay=this.slotDisplay||{},this.slotDisplay[t]=e,this.display&&this.updateSlotDisplay()},r.prototype.onAdd=function(){!this._addClock&&this.display&&this.stage&&(this._addClock=!0,this.display._dragonBones.clock.add(this.display))},r.prototype.onRemoved=function(){this._addClock=!1,this.display&&this.display._dragonBones.clock.remove(this.display)},r.prototype.release=function(){t.dbFactory.removeDragonBonesData(this._name),RES.destroyRes(this._name+"_tex_png"),RES.destroyRes(this._name+"_ske_json"),RES.destroyRes(this._name+"_tex_json")},r.prototype.byAnimComplete=function(t,e){null==this._byAnimComplete&&(this._byAnimComplete=new o),this._byAnimComplete.push(t,e),this.display&&!this.display.hasEventListener(dragonBones.AnimationEvent.COMPLETE)&&this.display.addEventListener(dragonBones.AnimationEvent.COMPLETE,this.onAnimComplete,this)},r.prototype.onceAnimComplete=function(t,e){null==this._onceAnimComplete&&(this._onceAnimComplete=new o),this._onceAnimComplete.push(t,e),this.display&&!this.display.hasEventListener(dragonBones.AnimationEvent.COMPLETE)&&this.display.addEventListener(dragonBones.AnimationEvent.COMPLETE,this.onAnimComplete,this)},r.prototype.byLoopComplete=function(t,e){null==this._byLoopComplete&&(this._byLoopComplete=new o),this._byLoopComplete.push(t,e),this.display&&!this.display.hasEventListener(dragonBones.Event.LOOP_COMPLETE)&&this.display.addEventListener(dragonBones.Event.LOOP_COMPLETE,this.onLoopComplete,this)},r.prototype.onceLoopComplete=function(t,e){null==this._onceLoopComplete&&(this._onceLoopComplete=new o),this._onceLoopComplete.push(t,e),this.display&&!this.display.hasEventListener(dragonBones.Event.LOOP_COMPLETE)&&this.display.addEventListener(dragonBones.Event.LOOP_COMPLETE,this.onLoopComplete,this)},r.prototype.onAnimComplete=function(){this._byAnimComplete&&this._byAnimComplete.invoke(!1),this._onceAnimComplete&&this._onceAnimComplete.invoke(!0)},r.prototype.onLoopComplete=function(){this._byLoopComplete&&this._byLoopComplete.invoke(!1),this._onceLoopComplete&&this._onceLoopComplete.invoke(!0)},r.prototype.play=function(t,e){void 0===e&&(e=-1),this._anim=t,this._loop=e,this.display&&this.display.animation.play(t,this._loop)},r.prototype.stop=function(t){this.display&&this.display.animation.stop(t),this._anim=null},Object.defineProperty(r.prototype,"timeScale",{get:function(){return this._timeScale},set:function(t){this._timeScale=t,this.display&&(this.display.animation.timeScale=t)},enumerable:!0,configurable:!0}),r}(eui.Component);t.Armtrue=n,__reflect(n.prototype,"clib.Armtrue");var o=function(){function t(){}return t.prototype.push=function(t,e){null==this._list&&(this._list=[]),this._list.push([t,e])},t.prototype.remove=function(t,e){this._list&&(this._list=this._list.filter(function(i){return i[0]==t&&i[1]==e?!1:!0}))},t.prototype.invoke=function(t,e){void 0===t&&(t=!0);for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];if(this._list){for(var o in this._list){var r=this._list[o][0],s=this._list[o][1]||e;r.apply(s,i)}t&&(this._list=null)}},t.prototype.clear=function(){this._list=null},t}();t.CallbackList=o,__reflect(o.prototype,"clib.CallbackList")}(clib||(clib={}));var clib;!function(t){function e(t,e){return t.y==e.y?e.x-t.x:e.y-t.y}var i=function(t){function i(i){var n=t.call(this)||this;return n.parent=i,n.sortFunc=e,n.contain=new egret.DisplayObjectContainer,n.contain.__battleLayer=!0,n.parent.addChild(n.contain),codearena.Global.LOCAL_DEBUG&&(n.shape=new egret.Shape,n.contain.addChild(n.shape)),n}return __extends(i,t),i.prototype.addDrawCollison=function(t){this.shape.graphics.clear(),t.drawCollison(this)},i.prototype.onCreate=function(){},i.prototype.onDestroy=function(){this.parent.contains(this.contain)&&this.parent.removeChild(this.contain)},i.prototype.onUpdate=function(){var t=this.contain.$children;t=t.sort(this.sortFunc),this.contain.$invalidate()},i.prototype.addChild=function(t){t.parent&&t.parent.removeChild(t),this.contain.addChild(t)},i.prototype.removeChild=function(t){this.contain.contains(t)&&this.contain.removeChild(t)},i.prototype.getChildAt=function(t){return this.contain.getChildAt(t)},Object.defineProperty(i.prototype,"numChildren",{get:function(){return this.contain.numChildren},enumerable:!0,configurable:!0}),i.prototype.removeChildren=function(){this.contain.removeChildren(),codearena.Global.LOCAL_DEBUG&&(this.shape=new egret.Shape,this.contain.addChild(this.shape))},i}(cval.Entity);t.BattleLayer=i,__reflect(i.prototype,"clib.BattleLayer")}(clib||(clib={}));var CODE;!function(t){t.OK=0}(CODE||(CODE={}));var cmConfig={comic_version:"1.0"},director;!function(t){var e=function(){function t(){}return t.prototype.init=function(t){this.dispose(),this._root=t,this._stage=t.stage,this.container=new cval.EntityContainer,this.lastTick=egret.getTimer(),this._stage.addEventListener(egret.Event.ENTER_FRAME,this.onTick,this)},t.prototype._onResize=function(){this.rootLayer.width=this.width,this.rootLayer.height=this.height,this.floatLayer.width=this.width,this.floatLayer.height=this.height,this.topLayer.width=this.width,this.topLayer.height=this.height},t.prototype.onTick=function(){var t=egret.getTimer(),e=t-this.lastTick;this.lastTick=t,this.tickMs=Math.min(e,100),this.onUpdate()},t.prototype.dispose=function(){this.container&&this.container.removeAllEntity(),this.container=null,this._stage&&this._stage.removeEventListener(egret.Event.ENTER_FRAME,this.onTick,this)},t.prototype.onUpdate=function(){this.container.onUpdate()},Object.defineProperty(t.prototype,"width",{get:function(){return this._stage.stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._stage.stageHeight},enumerable:!0,configurable:!0}),t}();__reflect(e.prototype,"Director"),t.instance=new e}(director||(director={}));var cm;!function(t){var e=function(){function e(t,e,i){void 0===i&&(i=!0),this._type="sound_type_effect",this._url="",this._playing=!1,this._type=t,this._url=e,i&&this.playSound()}return e.prototype.playSound=function(){RES.getResAsync(this._url,this.onLoadSoundComplete,this)},e.prototype.setVolume=function(t){this._channel&&(this._channel.volume=t)},e.prototype.stop=function(){this._playing=!1,this._channel&&(this._channel.stop(),this._channel=null),this._sound&&(this._sound=null)},e.prototype.onLoadSoundComplete=function(){var i=t.Utils.urlToResName(this._url);this._sound=RES.getRes(i);var n=this._sound;if(this._type===e.MUSIC)t.soundManager.music_on&&(this._channel=n.play(),this._playing=!0,this._channel.volume=t.soundManager.volume);else if(this._type===e.EFFECT&&t.soundManager.sound_on){var o=n.play(0,1);this._playing=!0,o.volume=t.soundManager.volume}},Object.defineProperty(e.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return this._playing},enumerable:!0,configurable:!0}),e.prototype.onLoadSoundError=function(t){t.currentTarget
},e.MUSIC="sound_type_music",e.EFFECT="sound_type_effect",e}();__reflect(e.prototype,"Sound");var i=function(){function t(){this._music_on=!0,this._sound_on=!0,this._volume=1,this._music=null}return t.prototype.playMusic=function(t){this._music&&this._music.url===t&&this._music.playing||(this._music&&this._music.stop(),this._music=new e(e.MUSIC,t))},t.prototype.playSound=function(t){new e(e.EFFECT,t)},Object.defineProperty(t.prototype,"sound_on",{get:function(){return this._sound_on},set:function(t){this._sound_on=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"music_on",{get:function(){return this._music_on},set:function(t){this._music_on=t,this._music&&(t?this._music.playSound():this._music.stop())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this._music&&this._music.setVolume(t)},enumerable:!0,configurable:!0}),t.prototype.stopMusic=function(){this._music&&this._music.stop()},t}();__reflect(i.prototype,"SoundManager"),t.soundManager=new i}(cm||(cm={}));var cval;!function(t){var e=function(){function t(){this._entityList=[],this._removeList=[]}return t.prototype.addEntity=function(t){t.manager?egret.warn("已经有manager了"):(this._entityList.push(t),t.create(),t.manager=this,t.pause=!1)},t.prototype.removeEntity=function(t){var e=this;if(!t.manager)return egret.warn("没有manager");this._removeList.push(t);var i=this._entityList.indexOf(t);-1!=i?(t.pause=!1,t.destroy(),egret.callLater(function(){e._entityList.splice(i,1),t.manager=null},this)):egret.warn("移除错误")},t.prototype.removeAllEntity=function(){for(var t=0,e=this._entityList.length;e>t;t++){var i=this._entityList[t];i.pause=!1,i.destroy(),i.manager=null}this._entityList.length=0},t.prototype.onUpdate=function(){for(var t=0,e=this._entityList.length;e>t;t++){var i=this._entityList[t];!i.pause&&i.isUpdate&&i.onUpdate()}},t}();t.EntityContainer=e,__reflect(e.prototype,"cval.EntityContainer")}(cval||(cval={}));var clib;!function(t){function e(t,e,i){if(n[t])return e.call(i,t);var o,r,s=function(){o&&r&&(n[t]=new egret.MovieClipDataFactory(o,r),e.call(i,t))},a=t+"_json",c=t+"_png";egret.assert(RES.hasRes(a),"loadMoiveClipRes: json not found("+a+")"),egret.assert(RES.hasRes(c),"loadMoiveClipRes: png not found("+c+")"),RES.getResAsync(a,function(t){o=t,s()},null),RES.getResAsync(c,function(t){r=t,s()},null)}function i(t){return!!n[t]}var n={};t.loadMovieClipRes=e;var o=function(o){function r(t,e,i,n){void 0===i&&(i=-1),void 0===n&&(n=!1);var r=o.call(this)||this;return r._scaleX=1,r._scaleY=1,r._timeScale=1,r._pauseCount=0,r._loop=i,r._autoRemove=n,r.setAnim(t,e),r}return __extends(r,o),r.prototype.setAnim=function(t,i){(this.__fname!=t||this.name!=i)&&(this.__fname=t,this.name=this.__name||this.__fname,e(t,this.onMovieClipLoad,this))},Object.defineProperty(r.prototype,"autoRemove",{get:function(){return this._autoRemove},set:function(t){this._autoRemove=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"timeScale",{get:function(){return this._timeScale},set:function(t){this._timeScale=t,this.display&&(this.display.frameRate=this.display.movieClipData.frameRate*this._timeScale)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"contentScaleX",{set:function(t){this._scaleX=t,this.display&&(this.display.scaleX=this._scaleX)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"contentScaleY",{set:function(t){this._scaleX=t,this.display&&(this.display.scaleY=this._scaleY)},enumerable:!0,configurable:!0}),r.prototype.onMovieClipLoad=function(t,e){var n=this;i(this.__fname)&&this.__fname==t&&this.__name==e&&(this.clearDisplay(),this.display=this.getMovieClip(this.__fname,this.__name),this.addChildAt(this.display,0),this.display.scaleX=this._scaleX,this.display.scaleY=this._scaleY,this.display.frameRate=this.display.movieClipData.frameRate*this._timeScale,this.setupAllListener(),this._pauseCount<=0&&this.display.gotoAndPlay(0,this._loop),egret.callLater(function(){n.dispatchEventWith(egret.Event.COMPLETE)},this))},r.prototype.byAnimComplete=function(e,i){null==this._byAnimComplete&&(this._byAnimComplete=new t.CallbackList),this._byAnimComplete.push(e,i)},r.prototype.onceAnimComplete=function(e,i){null==this._onceAnimCompleteCl&&(this._onceAnimCompleteCl=new t.CallbackList),this._onceAnimCompleteCl.push(e,i)},r.prototype.byLoopComplete=function(e,i){null==this._byLoopComplete&&(this._byLoopComplete=new t.CallbackList),this._byLoopComplete.push(e,i),this.display&&!this.display.hasEventListener(egret.MovieClipEvent.LOOP_COMPLETE)&&this.display.addEventListener(egret.MovieClipEvent.LOOP_COMPLETE,this.onLoopComplete,this)},r.prototype.onAnimComplete=function(){this._onceAnimCompleteCl&&this._onceAnimCompleteCl.invoke(!0),this._byAnimComplete&&this._byAnimComplete.invoke(!1),this._autoRemove&&this.parent&&this.parent.removeChild(this)},r.prototype.onLoopComplete=function(){this._byLoopComplete&&this._byLoopComplete.invoke(!1)},r.prototype.removeAllListeners=function(){this._byAnimComplete&&this._byAnimComplete.clear(),this._byLoopComplete&&this._byLoopComplete.clear(),this._onceAnimCompleteCl&&this._onceAnimCompleteCl.clear(),this.display&&(this.display.removeEventListener(egret.MovieClipEvent.COMPLETE,this.onAnimComplete,this),this.display.hasEventListener(egret.MovieClipEvent.LOOP_COMPLETE)&&this.display.removeEventListener(egret.MovieClipEvent.LOOP_COMPLETE,this.onLoopComplete,this))},r.prototype.setupAllListener=function(){this.display&&(this.display.hasEventListener(egret.MovieClipEvent.COMPLETE)||this.display.addEventListener(egret.MovieClipEvent.COMPLETE,this.onAnimComplete,this),this._byLoopComplete&&!this.display.hasEventListener(egret.MovieClipEvent.LOOP_COMPLETE)&&this.display.addEventListener(egret.MovieClipEvent.LOOP_COMPLETE,this.onLoopComplete,this))},r.prototype.clearDisplay=function(){this.display&&this.display.parent&&this.display.parent.removeChild(this.display),this.display=null},r.prototype.getMovieClip=function(t,e){return new egret.MovieClip(n[t].generateMovieClipData(e))},r.prototype.play=function(t,e){void 0===t&&(t=-1),void 0===e&&(e=-1),this._loop=e,this.display&&!this._pauseCount&&(t>=0?this.display.gotoAndPlay(t,this._loop):this.display.play(this._loop))},r.prototype.pause=function(){this._pauseCount++,1==this._pauseCount&&this.display&&this.display.stop()},r.prototype.resume=function(){this._pauseCount>0&&(this._pauseCount--,0==this._pauseCount&&this.display&&this.display.play())},r}(egret.DisplayObjectContainer);t.MovieClip=o,__reflect(o.prototype,"clib.MovieClip")}(clib||(clib={}));var codearena;!function(t){var e=function(){function e(){}return e.getDirection=function(e){switch(e){case"left":return t.Direction.LEFT;case"right":return t.Direction.RIGHT;case"up":return t.Direction.UP;case"DOWN":return t.Direction.DOWN;default:return t.Direction.UNKOWN}},e}();t.Utils=e,__reflect(e.prototype,"codearena.Utils")}(codearena||(codearena={}));var codearena;!function(t){t.InputType={number:"number",compare:"compare"};var e="editor_json",i=function(){function i(){this.selectIndex=0,this.inputs=[]}return i.prototype.setData=function(i){this.selectIndex=0;var n=RES.getRes(e);this.cdata=n.api[i]||n.block[i],this.text=this.cdata.code,this.args=[];var o=t.codeControl.cdata[i];if(""!==o)if(Array.isArray(o)||"object"==typeof o||(o=[o]),Array.isArray(o)||"object"!=typeof o)for(var r=0,s=o.length;s>r;r++)""!=o[r]&&this.args.push(o[r].split(","));else{this.args.push(Object.keys(o));var a={};for(var c in o)a[c]=o[c][0].split(",");this.args.push(a)}this.onUpdate()},i.prototype.setInput=function(t){this.inputs[this.selectIndex]=t},i.prototype.getInput=function(){return this.inputs[this.selectIndex]||""},i.prototype.delNumberInput=function(){for(var t=this.selectIndex;t>=0;t--)if("number"==this.args[t]){var e=this.inputs[t];if(e){e=e.substr(0,e.length-1),this.inputs[t]=e,this.selectIndex=t;break}}},i.prototype.setConfirm=function(){this.selectIndex++,this.onUpdate()},i.prototype.isEnd=function(){return this.selectIndex>=this.args.length},i.prototype.hasDefault=function(){return this.cdata["default"]},i.prototype.onUpdate=function(){this.chooseList=this.args[this.selectIndex]||[],Array.isArray(this.chooseList)||(this.chooseList=this.chooseList[this.inputs[this.selectIndex-1]])},i.prototype.onBack=function(){this.inputs.pop(),this.selectIndex--,this.onUpdate()},i.prototype.getFormatStr=function(e){void 0===e&&(e=!0);for(var i=this.text.slice(0),n=0,o=this.args.length;o>n;n++){var r=this.inputs[n],s="{"+n+"}";r?t.codeControl.table.api[r]&&(r=t.codeControl.table.api[r].display):r="",r=n==this.selectIndex&&e?r+" ":r,i=i.replace(s,r)}for(var n=0,o=this.cdata.args.length;o>n;n++){var s="{"+n+"}";i=i.replace(s,"")}return i},i.prototype.getFormatStrBefore=function(){for(var e=this.text.slice(0),i=0,n=this.args.length;n>i;i++){var o=this.inputs[i],r="{"+i+"}";o?t.codeControl.table.api[o]&&(o=t.codeControl.table.api[o].display):o="";var s=e.indexOf(r);if(-1!=s&&this.selectIndex==i){e=e.slice(0,s),e+=o;break}e=e.replace(r,o)}return e},i}();t.ControlPathItem=i,__reflect(i.prototype,"codearena.ControlPathItem");var n=function(){function t(){this.text=""}return t.prototype.init=function(){this.table=RES.getRes(e),this.constActives={};for(var t in this.table.entry)for(var i=0,n=this.table.entry[t].child;i<n.length;i++){var o=n[i];this.constActives[o]=t}},t.prototype.getLevel=function(t){var e="codeInput"+t+"_json",i=RES.getRes(e),n={};for(var o in i)if("type"!=o){if("var"==o){n[o]=i[o];continue}for(var r in i[o])n[r]=i[o][r]}this.cdata=n,this.activeFunc={};for(var s in this.cdata)this.activeFunc[this.constActives[s]]=!0},t.prototype.getType=function(t){this.type=t;var e=this.table.entry[this.type];this.chooseList=e.child},t.prototype.getSubTitle=function(){return this.table.entry[this.type].name},t.prototype.setSelect=function(t){var e=new i;e.setData(t),this.child=e},t.prototype.getFormatStr=function(t){return void 0===t&&(t=!0),this.text=""+this.child.getFormatStr(t)},t}();t.RootControlPathItem=n,__reflect(n.prototype,"codearena.RootControlPathItem"),t.codeControl=new n}(codearena||(codearena={}));var cm;!function(t){var e=function(){function t(){this._cookies="",this._cookies=egret.localStorage.getItem("cookies")}return Object.defineProperty(t.prototype,"cookie",{get:function(){return this._cookies},set:function(t){this._cookies=t},enumerable:!0,configurable:!0}),t}();__reflect(e.prototype,"Cookies"),t.cookies=new e}(cm||(cm={}));var codearena;!function(t){}(codearena||(codearena={}));var codearena;!function(t){var e;!function(t){t[t.sprite=0]="sprite",t[t.player=1]="player"}(e=t.Role||(t.Role={}));var i=function(){function t(){this._max_level=6,this._next_level=1}return Object.defineProperty(t.prototype,"max_level",{get:function(){return this._max_level},set:function(t){this._max_level=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"next_level",{get:function(){return this._next_level},set:function(t){this._next_level=t},enumerable:!0,configurable:!0}),t}();t.Levels=i,__reflect(i.prototype,"codearena.Levels"),t.levels=new i}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function t(){}return t}();t.LevelData=e,__reflect(e.prototype,"codearena.LevelData")}(codearena||(codearena={}));var cm;!function(t){var e=function(){function t(t){this._token="",this._token=egret.localStorage.getItem("_token")}return Object.defineProperty(t.prototype,"token",{get:function(){return this._token},set:function(t){this._token=t,egret.localStorage.setItem("_token",t)},enumerable:!0,configurable:!0}),t}();__reflect(e.prototype,"Token"),t.tokens=new e("")}(cm||(cm={}));var codearena;!function(t){var e=function(){function e(){this._self=new t.User,this._arr=[]}return Object.defineProperty(e.prototype,"self",{get:function(){return this._self},enumerable:!0,configurable:!0}),e.prototype.logout=function(){this._self=new t.User},e}();__reflect(e.prototype,"UserManager"),t.usermanager=new e}(codearena||(codearena={}));var codearena;!function(t){function e(e){t.Alert.show(new i(e),{bg:!0,clickBgClose:!1})}var i=function(e){function i(t){var i=e.call(this)||this;return i.skinName="PanelAlert",i.config=t,i.lbDesc.text=t.content,i}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),cnUtils.touchTap(this.btnOk,this.onOk,this),this.btnOk.label=this.config.ok.text},i.prototype.onOk=function(){this.config.ok&&this.config.ok.callback(),this.onClose()},i.prototype.onClose=function(){this.parent&&this.parent instanceof t.Alert&&this.parent.hide()},i}(eui.Component);__reflect(i.prototype,"PanelAlert"),t.showAlert=e}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i.skinName="PanelNameInput",i.callBack=t,i}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.edName.restrict="一-龥 a-z A-Z 0-9 ^ ",cnUtils.touchTap(this.btnConfirm,this.onConfirm,this),this.lbDesc.text=t.lang.get("nameRegister_txt"),this.lbTips.text=t.lang.get("nameTips_txt"),this.edName.prompt=t.lang.get("nameInput_txt"),this.edName.text=t.usermanager.self.nickname},i.prototype.onConfirm=function(){var e=this,i=this.edName.text;return!i||i.length>16?void 0:t.usermanager.self.registed?void this.onUpdateInfo(i,t.usermanager.self.gender):void(cnUtils.IS_Mobile()?cmPf.getCacheUserInfo().then(function(t){e.onResigster(i,t.avatar_url)}):this.onResigster(i,t.usermanager.self.headImg))},i.prototype.onUpdateInfo=function(e,i){var n=this;t.service.updateGameNameInfo(e).then(function(i){if(0==i.code)t.usermanager.self.nickname=e,t.usermanager.self.gender=i.gender,n.onClose();else if(100==i.code)return void cmui.toast(t.lang.get("error02_txt"))},function(t){})},i.prototype.onResigster=function(e,i){var n=this;t.service.register(e,i).then(function(i){if(0==i.code)t.usermanager.self.nickname=e,t.usermanager.self.avatar_url=i.avatar_url,n.onClose();else if(100==i.code)return void cmui.toast(t.lang.get("error02_txt"))},function(e){cmui.toast(t.lang.get("error02_txt"))})},i.prototype.onClose=function(){this.parent&&this.parent instanceof t.Alert&&this.parent.hide(),this.callBack&&this.callBack()},i.open=function(e){t.Alert.show(new i(e),{bg:!0})},i}(eui.Component);t.PanelNameInput=e,__reflect(e.prototype,"codearena.PanelNameInput")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName="PanelVistorBind",t}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),cnUtils.touchTap(this.btnQQ,this.onBindQQ,this),cnUtils.touchTap(this.btnWechat,this.onBindWechat,this),cnUtils.touchTap(this.btnClose,this.onClose,this),this.lbDesc.text=t.lang.get("bindMethod_txt"),this.lbTips.text=t.lang.get("bindTips_txt")},i.prototype.onBindQQ=function(){},i.prototype.onBindWechat=function(){},i.prototype.onClose=function(){var e=this.parent;e&&e instanceof t.Alert&&e.hide()},i.open=function(){t.Alert.show(new i,{bg:!0})},i}(eui.Component);t.PanelVistorBind=e,__reflect(e.prototype,"codearena.PanelVistorBind")}(codearena||(codearena={}));var cmPf;!function(t){function e(e){egret.Capabilities.isMobile?"Android"==egret.Capabilities.os?t.pf=new L(e):"iOS"==egret.Capabilities.os:t.pf=new S(e)}function i(t){return new Promise(function(e,i){cordova.exec(function(t){g(JSON.stringify(t)),e(t)},function(t){g(JSON.stringify(t)),i(t)},"CodeMaoSdkPlugin","getPhoneRegisterCaptcha",[t])})}function n(t,e){return new Promise(function(i,n){cordova.exec(function(t){g(JSON.stringify(t)),i(t)},function(t){g(JSON.stringify(t)),n(t)},"CodeMaoSdkPlugin","phoneRegister",[t,e])})}function o(t,e){return new Promise(function(i,n){cordova.exec(function(t){cm.tokens.token=t.token,i(t)},function(t){n(t)},"CodeMaoSdkPlugin","loginByPhone",[t,e])})}function r(t){return new Promise(function(e,i){cordova.exec(function(t){g(JSON.stringify(t)),cm.tokens.token=t.token,e(t)},function(t){g(JSON.stringify(t)),i(t)},"CodeMaoSdkPlugin","getPhoneLoginCaptcha",[t])})}function s(t,e){return new Promise(function(i,n){cordova.exec(function(t){cm.tokens.token=t.token,g(JSON.stringify(t)),i(t)},function(t){v(JSON.stringify(t)),n(t)},"CodeMaoSdkPlugin","loginByPassword",[t+"",e+""])})}function a(){return new Promise(function(t,e){cordova.exec(function(e){cm.tokens.token=e.token,g(JSON.stringify(e)),t(e)},function(t){v(JSON.stringify(t)),e(t)},"CodeMaoSdkPlugin","loginByQQ",[])})}function c(){return new Promise(function(t,e){cordova.exec(function(e){cm.tokens.token=e.token,g(JSON.stringify(e)),t(e)},function(t){v(JSON.stringify(t)),e(t)},"CodeMaoSdkPlugin","loginByWechat",[])})}function h(){return new Promise(function(e,i){cordova.exec(function(t){g(JSON.stringify(t)),cm.tokens.token=t.token,e(t)},function(e){e==t.CODE.TokenFail||e==t.CODE.UnLoginIn,i(e)},"CodeMaoSdkPlugin","getCacheUserInfo",[])})}function l(t){return new Promise(function(e,i){cordova.exec(function(t){g(JSON.stringify(t)),e(t)},function(t){i(t)},"CodeMaoSdkPlugin","getChangePasswordCaptcha",[t])})}function p(t,e,i){return new Promise(function(n,o){cordova.exec(function(t){g(JSON.stringify(t)),n(t)},function(t){o(t)},"CodeMaoSdkPlugin","changePassWord",[t,e,i])})}function u(){cordova.exec(function(t){},function(t){},"CodeMaoSdkPlugin","setViewVisibility",[])}function d(){return new Promise(function(t,e){cordova.exec(function(e){cm.tokens.token="",g(JSON.stringify(e)),t(e)},function(t){v(JSON.stringify(t)),e(t)},"CodeMaoSdkPlugin","logout",[])})}function _(){return O}function f(){return cnUtils.getLocalStorage("vistorToken")}function m(t){cnUtils.setLocalStorage("vistorToken",t)}function g(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];egret.log(t,e)}function v(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];egret.error(t,e)}function y(){return 1==cnUtils.getQuery("state")}function b(){return cnUtils.getQuery("code")}var E,C={API_LOGIN:"tiger/accounts/login",API_LOGOUT:"tiger/accounts/logout",APPID_QQ_DEBUG:"101437442",APPID_WX_DEBUG:"wxaa977bc0b0790081",APPID_QQ:"101253342",APPID_WX:"wxeda82dc272f7fe92"};!function(t){t[t["default"]=0]="default",t[t.android=1]="android",t[t.web=2]="web"}(E=t.pfType||(t.pfType={}));var T=function(){function t(t){this.isDebug=!1,this.isDebug=t,this.type=E["default"]}return t}();t.PlatForm=T,__reflect(T.prototype,"cmPf.PlatForm");var L=function(t){function e(e){var i=t.call(this,e)||this;return i.type=E.android,i}return __extends(e,t),e.prototype.loginByPassword=function(t,e){return new Promise(function(i,n){cordova.exec(function(t){cm.tokens.token=t.token,g(JSON.stringify(t)),i(t)},function(t){v(JSON.stringify(t)),n(t)},"CodeMaoSdkPlugin","loginByPassword",[t+"",e+""])})},e.prototype.loginByWechat=function(){return new Promise(function(t,e){cordova.exec(function(e){cm.tokens.token=e.token,g(JSON.stringify(e)),t(e)},function(t){v(JSON.stringify(t)),e(t)},"CodeMaoSdkPlugin","loginByWechat",[])})},e.prototype.loginByQQ=function(){return new Promise(function(t,e){cordova.exec(function(e){cm.tokens.token=e.token,g(JSON.stringify(e)),t(e)},function(t){v(JSON.stringify(t)),e(t)},"CodeMaoSdkPlugin","loginByQQ",[])})},e.prototype.logout=function(){return new Promise(function(t,e){cordova.exec(function(e){cm.tokens.token="",g(JSON.stringify(e)),t(e)},function(t){v(JSON.stringify(t)),e(t)},"CodeMaoSdkPlugin","logout",[])})},e}(T);__reflect(L.prototype,"AndroidPlatForm");var S=function(t){function e(e){var i=t.call(this,e)||this;return i.type=E.web,i}return __extends(e,t),e.prototype.loginByPassword=function(t,e){return cm.get(codearena.config.server_config.api.host+C.API_LOGIN,null,3)},e.prototype.loginByWechat=function(){var t=this;return new Promise(function(e,i){if(t.isDebug){var n=C.APPID_QQ_DEBUG,o=window.location.href,r=1;window.location.href="https://frontend-dev.codemao.cn/get-weixin-code.html?appid="+n+"&scope=snsapi_login&state="+r+"&redirect_uri="+o}else{var n=C.APPID_QQ,o=window.location.href,r=1;window.location.href="https://www.codemao.cn/get-weixin-code.html?appid="+n+"&scope=snsapi_login&state="+r+"&redirect_uri="+o}})},e.prototype.loginByQQ=function(){var t=this;return new Promise(function(e,i){if(t.isDebug){var n=C.APPID_QQ_DEBUG,o=window.location.href;window.location.href="https://frontend-dev.codemao.cn/get-qq-code.html?appid="+n+"&redirect_uri="+o}else{var n=C.APPID_QQ,o=window.location.href;window.location.href="https://www.codemao.cn/get-qq-code.html?appid="+n+"&redirect_uri="+o}})},e.prototype.logout=function(){return new Promise(function(t,e){return cm.get(codearena.config.server_config.api.host+C.API_LOGOUT,null,3)})},e.prototype.getLoginCode=function(){return new Promise(function(t,e){return cm.get(codearena.config.server_config.api.host+C.API_LOGOUT,null,3)})},e}(T);__reflect(S.prototype,"WebPlatForm"),t.init=e,t.CODE={OK:0,UnLoginIn:800001,TokenFail:800002,UnInstallWechat:800034},t.getPhoneRegisterCaptcha=i,t.phoneRegister=n,t.loginByPhone=o,t.getPhoneLoginCaptcha=r,t.loginByPassword=s,t.loginByQQ=a,t.loginByWechat=c,t.getCacheUserInfo=h,t.getChangePasswordCaptcha=l,t.changePassWord=p,t.setViewVisibility=u,t.logout=d;var O=!1;t.isVistor=_,t.getVistorToken=f,t.setVistorToken=m,t.isWebLogin=y,t.getWebLoginCode=b}(cmPf||(cmPf={}));var cmui;!function(t){function e(t){var e=new i(t);director.instance._stage.addChild(e)}var i=function(t){function e(e){var i=t.call(this)||this;return i.skinName="WidgetFlowTips",i.lbFlowTips.text=e,i}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.y=(director.instance.height-this.height)/2,this.x=(director.instance.width-this.width)/2,this.startTween()},e.prototype.startTween=function(){egret.Tween.get(this).wait(100).to({y:this.y-30},500).call(this.endTween,this)},e.prototype.endTween=function(){egret.Tween.removeTweens(this),this.parent&&this.parent.removeChild(this)},e}(eui.Component);__reflect(i.prototype,"WidgetFlowTips"),t.toast=e}(cmui||(cmui={}));var codearena;!function(t){var e=function(){function t(){}return t.server_status="/tiger/arena/configuration",t.get_user_info="/tiger/user",t.get_level_info="/tiger/arena/level",t.report_level_time="/tiger/arena/timer",t.get_level_time="/tiger/arena/timer",t.change_level="/tiger/arena/level/",t.register_user="/tiger/arena/user",t.get_user="/tiger/arena/user",t.invitation_code_valide="/tiger/arena/check_invitation_code",t.login_valide="/api/user/login",t.register="/arenaUser/register",t.update_info="/arenaUser/update",t.update_gender="/arenaUser/update/gender",t.get_visitor="/generator/visitor_id",t.get_isEdit="/arenaUser/isEdit",t.get_userById="/arenaUser/getUserById/",t}();t.API=e,__reflect(e.prototype,"codearena.API")}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function e(){}return e.prototype.getBasicUserInfo=function(){return cm.get(t.config.server_config.api.host+t.API.get_user_info,[],3)},e.prototype.getUserInfo=function(){return cm.get(t.config.server_config.api.host+t.API.get_user,[],3)},e.prototype.registerUser=function(e,i){return cm.post(t.config.server_config.api.host+t.API.register_user,{gender:e,invitation_code:i},3)},e.prototype.getInviteCodeValid=function(e){return cm.post(t.config.server_config.api.host+t.API.invitation_code_valide,{invitation_code:e},3)},e.prototype.getLoginValid=function(e,i){return cm.post(t.config.server_config.api.host+t.API.login_valide,{username:e,password:i},3)},e.prototype.getServerStatus=function(){return cm.get(t.config.server_config.api.host+t.API.server_status,null,3)},e.prototype.getLevelInfo=function(){return cm.get(t.config.server_config.api.host+t.API.get_level_info,null,3)},e.prototype.reportLevelTime=function(){return cm.put(t.config.server_config.api.host+t.API.report_level_time,null,3)},e.prototype.getLevelTime=function(){return cm.get(t.config.server_config.api.host+t.API.get_level_time,null,3)},e.prototype.changeLevel=function(e){return cm.put(t.config.server_config.api.host+t.API.change_level+e,null,3)},e.prototype.updateGameGenderInfo=function(i){return cm.post(e.testHost+t.API.update_gender,{gender:i},3)},e.prototype.updateGameNameInfo=function(i){return cm.post(e.testHost+t.API.update_info,{gameRole:i},3)},e.prototype.register=function(i,n,o){return cm.post(e.testHost+t.API.register,{gameRole:i,portraitUrl:n,invitation_code:o},3)},e.prototype.getVistor=function(){return cm.get(e.testHost+t.API.get_visitor,null,3)},e.prototype.getIsEdit=function(){return cm.get(e.testHost+t.API.get_isEdit,null,3)},e.prototype.getUserInfoByUserId=function(){return cm.get(e.testHost+t.API.get_userById,null,3)},e.testHost="http://172.16.3.24:8180",e}();__reflect(e.prototype,"Service"),t.service=new e}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function e(){}return e.button=function(){cm.soundManager.playSound(t.SoundType.EFFECT_CLICK)},e}();t.Sound=e,__reflect(e.prototype,"codearena.Sound")}(codearena||(codearena={}));var codearena;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.imgBg=new eui.Image,e.imgBg.source="btn_ligth",e.addChild(e.imgBg),e}return __extends(e,t),e.prototype.draw=function(t,e,i,n){this.imgBg.visible=!0,this.imgBg.x=t,this.imgBg.y=e,this.imgBg.width=i,this.imgBg.height=n},e.prototype.clear=function(){this.imgBg.visible=!1},e}(egret.Sprite);t.MapPressLayer=e,__reflect(e.prototype,"codearena.MapPressLayer")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(t,i,n){var o=e.call(this)||this;return o._column=0,o._row=0,o._prevX=0,o._mouseout_handler=null,o._map_w=t,o._map_h=i,o._url=cnUtils.getRESUrlByKey(n),o.init(),o}return __extends(i,e),i.prototype.reset=function(){this._map&&this._map.destory(),this.init()},i.prototype.init=function(){var t=new egret.URLLoader;t.dataFormat=egret.URLLoaderDataFormat.TEXT,t.addEventListener(egret.Event.COMPLETE,this.onMapDataLoad,this),t.load(new egret.URLRequest(this._url)),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this._onRemove,this)},i.prototype.onMapDataLoad=function(e){e.target.removeEventListener(egret.Event.COMPLETE,this.onMapDataLoad,this);var i=egret.XML.parse(e.target.data);this._data=i,console.log(i),this._column=i.attributes.width,this._row=i.attributes.height,this._map_w=this._map_w||this._column*i.attributes.tilewidth,this._map_h=this._map_h||this._row*i.attributes.tileheight;var n=new tiled.TMXTilemap(this._map_w,this._map_h,i,this._url);n.render(),this._map=n,this.addChild(n),tiled.TMXLayer.USE_BATCH_RENDER&&(this._map.graphics.beginFill(0,0),this._map.graphics.drawRect(0,0,this._map_w,this._map_h),this._map.graphics.endFill()),this._pressLayer=new t.MapPressLayer,n.touchEnabled=!0,n.addChildAt(this._pressLayer,n.numChildren),this._onLoad()},i.prototype.center=function(t,e){if(!this._mapDragger.isDraging){var i=this._visibleRect.width/2-this._map.x,n=this._visibleRect.height/2-this._map.y,o=this._map.x-(t-i),r=this._map.y-(e-n);o>0||this._map.width<this._visibleRect.width?o=0:o<this._visibleRect.width-this._map.width&&(o=this._visibleRect.width-this._map.width),r>0||this._map.height<this._visibleRect.height?r=0:r<this._visibleRect.height-this._map.height&&(r=this._visibleRect.height-this._map.height),this._map.x=o,this._map.y=r}},i.prototype.updateVisibleRect=function(t){this._visibleRect=t,this._mapDragger&&this._mapDragger.updateRect(t)},Object.defineProperty(i.prototype,"tiledMap",{get:function(){return this._map},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"row",{get:function(){return this._row},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"column",{get:function(){return this._column},enumerable:!0,configurable:!0}),i.prototype._onLoad=function(){this.stage&&(this._mapDragger=new cm.Dragable,egret.log(this._map.getLayers()),egret.log(this._map.getObjects()),this._visibleRect&&this._mapDragger.enableDrag(this._map,this._visibleRect),this.dispatchEvent(new egret.Event(egret.Event.COMPLETE)))},i.prototype._onMapTouchBegin=function(e){var i=3*this._map.tilewidth,n=3*this._map.tileheight,o=this._map.globalToLocal(e.stageX,e.stageY),r=t.gameControl.inWhichGrid(o.x,o.y),s=r.column,a=r.row,c=t.gameControl.getGridCenter(s,a),h=c.x,l=c.y;this._pressLayer.draw(h-.5*i,l-.5*n,i,n),cm.Tip.show("x:"+s+", y:"+a,h+this._map.x,l-.5*n+this._map.y,.5,1),cm.sceneManager.currentScene instanceof t.BattleScene&&cm.sceneManager.currentScene.battleUI.setClickPos(s,a)},i.prototype._onMapTouchEnd=function(e){t.codeEditor.useHtmlEditor()&&this._pressLayer.clear(),cm.Tip.hide()},i.prototype._onRemove=function(){if(this._mapDragger.disableDrag(),this._map.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onMapTouchBegin,this),this._map.removeEventListener(egret.TouchEvent.TOUCH_END,this._onMapTouchEnd,this),this._map.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this._onMapTouchEnd,this),this._map.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this._onMapTouchEnd,this),!cnUtils.IS_Mobile()&&window.document){var t=window.document.getElementsByTagName("canvas");if(t&&1===t.length){var e=t[0];this._mouseout_handler&&(e.onmouseout=null,this._mouseout_handler=null)}}},i.prototype._onMouseOut=function(){this._mapDragger.stop(),this._onMapTouchEnd()},i.prototype.enableGridPress=function(){if(this._map.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onMapTouchBegin,this),this._map.addEventListener(egret.TouchEvent.TOUCH_END,this._onMapTouchEnd,this),this._map.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this._onMapTouchEnd,this),this._map.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this._onMapTouchEnd,this),!cnUtils.IS_Mobile()&&window.document){var t=window.document.getElementsByTagName("canvas");if(t&&1===t.length){var e=t[0];this._mouseout_handler=this._onMouseOut.bind(this),e.onmouseout=this._mouseout_handler}}},i}(egret.Sprite);t.TiledMap=e,__reflect(e.prototype,"codearena.TiledMap")}(codearena||(codearena={}));var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var o=RES.getRes(t);o?n(o):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var codearena;!function(t){var e=function(t){function e(e){var i=t.call(this)||this;return i._username="",i._modScale=e,i.skinName="CharacterNameSkin",i}return __extends(e,t),e.prototype.onComplete=function(){t.prototype.onComplete.call(this),this._update()},Object.defineProperty(e.prototype,"username",{get:function(){return this._username},set:function(t){this._username=t,this._update()},enumerable:!0,configurable:!0}),e.prototype._update=function(){this.label&&(this.label.size=16*(1+.5*(this._modScale-1)),this.label.text=this._username,this.width=this.label.textWidth+8,this.height=this.label.textHeight+4,this.horizontalCenter=0)},e}(cm.EUIComponent);t.CharacterName=e,__reflect(e.prototype,"codearena.CharacterName")}(codearena||(codearena={}));var codearena;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._txt="",e.skinName="ChatBubble",e}return __extends(e,t),e.prototype.onComplete=function(){t.prototype.onComplete.call(this),this.content=this._txt},Object.defineProperty(e.prototype,"content",{set:function(t){this._txt=t,this.text&&(this.text.text=this._txt,this.text.validateSize(),this.text.validateDisplayList(),this.height=this.text.textHeight+25,this.anchorOffsetX=this.width,this.anchorOffsetY=this.height)},enumerable:!0,configurable:!0}),e}(cm.EUIComponent);t.ChatBubble=e,__reflect(e.prototype,"codearena.ChatBubble")}(codearena||(codearena={}));var codearena;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._percent=1,e._total=0,e._lv=0,e.skinName="HpBar",e}return __extends(e,t),e.prototype.onComplete=function(){t.prototype.onComplete.call(this),this._total=this.hp.width,this.percent=this._percent,this.lv=this._lv
},Object.defineProperty(e.prototype,"lv",{set:function(t){if(this._lv=t,this.complete&&this._lv>0||-1==this._lv)if(this.currentState="lv",-1==this._lv)this.width=90,this.num1.source="quest_jpg",this.num2.visible=!1;else{var e=this._lv.toString();2===e.length?(this.width=98,this.num1.source=RES.getRes("battle_scene_json."+e.charAt(0)),this.num2.source=RES.getRes("battle_scene_json."+e.charAt(1))):(this.width=90,this.num1.source=RES.getRes("battle_scene_json."+e.charAt(0)),this.num2.visible=!1)}else this.width=65,this.currentState="noLv";this.validateNow()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"percent",{set:function(t){0>t?t=0:t>1&&(t=1),this._percent=t,this.hp&&(this.hp.width=t*this._total)},enumerable:!0,configurable:!0}),e}(cm.EUIComponent);t.HpBar=e,__reflect(e.prototype,"codearena.HpBar")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._map=null,t._renderWidth=0,t._renderHeight=0,t}return __extends(i,e),i.prototype.onAdd=function(){var i=this;e.prototype.onAdd.call(this);var n=this._args[0];if(t.Global.LOCAL_DEBUG&&!n){var o=cm.Utils.getQueryParam("level");n=o?parseInt(o):101}t.gameControl.currentLevel=n,RES.getResAsync("obj"+n+"_json",function(t){i._startLoad(n,t)},this),t.loading.show()},i.prototype._startLoad=function(t,e){var i=this._parseObjectRes(e),n=["level"+t+"_json","codeInput"+t+"_json","task"+t+"_json","pre"+t+"_json","task"+t+"_json","map"+t+"_tmx","remark"+t+"_py"];i.push.apply(i,n),this.loadRes("battle",i)},i.prototype._parseObjectRes=function(e){for(var i=new Set,n=0,o=e;n<o.length;n++){var r=o[n],s=void 0;switch(r.type){case t.ObjectType.NPC:s=t.config.getNpcById(r.typeId).modId;break;case t.ObjectType.MAP_ITEM:s=t.config.getMapItemById(r.typeId).modId;break;case t.ObjectType.PLAYER:s=t.config.getPlayerById(r.typeId).modId}if(this._addModRes(i,s),r.type===t.ObjectType.MAP_ITEM&&t.config.getMapItemById(r.typeId).type===t.MapItemType.HEAL){var a={name:"heal_effect",type:"dragonbones",url:"resource/mod/dragonbones/heal_effect",sound:"",soundWalk:"",soundAtk:"",soundDie:""};this._addModRes(i,a)}}return Array.from(i)},i.prototype._addModRes=function(e,i){if(i){var n=isNaN(i)?i:t.config.getModById(i);for(var o in n)if(-1!==o.indexOf("sound")){var r=cm.Utils.urlToResName(n[o]);r&&e.add(r)}if("image"===n.type){var r=cm.Utils.urlToResName(n.url);r&&e.add(r)}else if("dragonbones"===n.type){var r=cm.Utils.urlToResName(n.url);if(!r)return;e.add(r+"_ske_json"),e.add(r+"_tex_json"),e.add(r+"_tex_png")}}},i.prototype.onLoaded=function(){this._initMap(),cm.soundManager.playMusic(t.SoundType.BGM_BATTLE)},i.prototype._initMapComplete=function(e){egret.log("init map complete"),this._map.tiledMap.removeEventListener(egret.Event.COMPLETE,this._initMapComplete,this),this.battleUI=new t.BattleUI,this.addChild(this.battleUI),t.gameControl.init(this._map),t.loading.remove(),t.Global.IS_UBT&&t.onLevelLoaded&&t.onLevelLoaded(t.gameControl.currentLevel)},i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.removeEventListener(egret.Event.RESIZE,this._onSizeChange,this),t.gameControl.removeMap(),this._map.tiledMap.destory(),this._map&&(this._map.removeEventListener(egret.Event.COMPLETE,this._onLoadMapComplete,this),this._map.tiledMap&&this._map.tiledMap.removeEventListener(egret.Event.COMPLETE,this._initMapComplete,this))},i.prototype._initMap=function(e,i){var n=RES.getRes("level"+t.gameControl.currentLevel+"_json");this._renderWidth=e,this._renderHeight=i,this._map=new t.TiledMap(e,i,n.mapId+"_tmx"),this._map.addEventListener(egret.Event.COMPLETE,this._onLoadMapComplete,this),this._onSizeChange(),this.addChild(this._map),this.addEventListener(egret.Event.RESIZE,this._onSizeChange,this)},i.prototype._onSizeChange=function(){if(this.stage){var t=this.stage.stageWidth,e=this.stage.stageHeight;this._map.updateVisibleRect(new egret.Rectangle(0,0,t,e)),this._map.width=t,this._map.height=e,this._map.scrollRect=new egret.Rectangle(0,0,t,e)}},i.prototype._onLoadMapComplete=function(t){egret.log("load map complete"),this._map.removeEventListener(egret.Event.COMPLETE,this._onLoadMapComplete,this),this._map.tiledMap.addEventListener(egret.Event.COMPLETE,this._initMapComplete,this)},i.prototype.startBattle=function(){this.battleUI.showMissionPanel(),this._map.enableGridPress()},i.prototype.exit=function(){return t.loading.showAndFadeIn()},i}(cm.BaseScene);t.BattleScene=e,__reflect(e.prototype,"codearena.BattleScene")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName="BattleUI",t}return __extends(i,e),i.prototype.onComplete=function(){e.prototype.onComplete.call(this),this.tipBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this._onTipBtn,this),this.showBattleDialog()},i.prototype.onAdd=function(){e.prototype.onAdd.call(this),this.left=this.top=this.right=this.bottom=0},i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.tipBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this._onTipBtn,this),this._missionPanel&&this._missionPanel.onRemove()},i.prototype._onTipBtn=function(){t.Sound.button(),this._showTip()},i.prototype._showTip=function(){var e=t.gameControl.currentLevel+"_png",i=new t.BattleTipPanel(e);t.Alert.show(i,{bg:!0,clickBgClose:!0,addToMain:!1,pos:{left:150}})},i.prototype._onItemTap=function(t){var e=t.itemRenderer;this.currentHelpItem===e?(this.currentHelpItem.extend=!1,this.currentHelpItem=null):(this.currentHelpItem&&(this.currentHelpItem.extend=!1),e.extend=!0,this.currentHelpItem=e)},i.prototype._onTabTap=function(t){var e=t.target,i=e.name;if(-1!==i.indexOf("tab")){var n=parseInt(i.substr(3));this._setHelpTab(n)}},i.prototype._setHelpTab=function(t){for(var e,i=RES.getRes("doc_json"),n=0;n<this.tabs.numChildren;n++){var o=this.tabs.getChildAt(n);o&&(o.selected=o.name==="tab"+t)}2===t?e=[0,1,2,3]:1===t&&(e=[4,5,6,7,8,9,10,11,12,13,14,15]);var r=e.map(function(t){return i[t]}),s=new eui.ArrayCollection(r);this.helpList.dataProvider=s,this.helpScroll&&this.helpScroll.enable()},i.prototype.showMissionPanel=function(){this._missionPanel||(this._missionPanel=new t.MissionPanel(this)),this.missionPanel.visible=!0},i.prototype.hideMissionPanel=function(){this.missionPanel.visible=!1},i.prototype.showBattleDialog=function(){var e=RES.getRes("pre"+t.gameControl.currentLevel+"_json");this._battleDialog=new t.BattleDialog(e),this._battleDialog.onFinish=this.onDialogFinish.bind(this),this.addChild(this._battleDialog)},i.prototype.onDialogFinish=function(){t.Global.IS_UBT&&t.onStoryComplete(),this._showTip(),this._battleDialog&&this._battleDialog.stage&&this._battleDialog.parent.removeChild(this._battleDialog);var e=cm.sceneManager.currentScene;e&&e.startBattle()},i.prototype.setClickPos=function(t,e){this.selectColumn=t,this.selectRow=e,this.lbPosX.text=""+t,this.lbPosY.text=""+e},i}(cm.EUIComponent);t.BattleUI=e,__reflect(e.prototype,"codearena.BattleUI")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._data=null,t._selected=!1,t._itemIndex=1,t._extend=!1,t.skinName="HelpItem",t}return __extends(i,e),i.prototype.onComplete=function(){e.prototype.onComplete.call(this),this._data&&(this.data=this._data),this.addBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this._onAddBtn,this)},i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.addBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this._onAddBtn,this)},i.prototype._onAddBtn=function(){t.codeEditor.insert(this._data.code)},Object.defineProperty(i.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.complete&&this._setState()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"extend",{get:function(){return this._extend},set:function(t){this._extend=t,this._setState()},enumerable:!0,configurable:!0}),i.prototype._setState=function(){this.content.text=this._data.describe,this.title.text=this._data.title,this.content.height=this.content.textHeight,this.left=this.right=-1,this._extend?(this.height=80+this.content.textHeight+30,this.contentGroup.visible=!0,this.flag.rotation=90):(this.height=80,this.contentGroup.visible=!1,this.flag.rotation=0)},Object.defineProperty(i.prototype,"selected",{get:function(){return this._selected},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"itemIndex",{get:function(){return this._itemIndex},enumerable:!0,configurable:!0}),i}(cm.EUIComponent);t.HelpItem=e,__reflect(e.prototype,"codearena.HelpItem",["eui.IItemRenderer","eui.UIComponent","egret.DisplayObject"])}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i._data=t,i.skinName="MissionItem",i}return __extends(i,e),i.prototype.onAdd=function(){e.prototype.onAdd.call(this),this._update(),this._data.addEventListener(egret.Event.CHANGE,this._update,this),this._data.addEventListener(t.MissionProgressEvent.PROGRESS,this._update,this)},i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this._data.removeEventListener(egret.Event.CHANGE,this._update,this),this._data.removeEventListener(t.MissionProgressEvent.PROGRESS,this._update,this)},i.prototype.onComplete=function(){e.prototype.onComplete.call(this),this._update(),this.left=this.right=0},i.prototype._update=function(){if(this.complete)switch(9===this._data.missionData.type?this.text.text=this._data.missionData.name+(this._data.total>0?"("+(this._data.total-this._data.progress)+"秒)":""):this.text.text=this._data.missionData.name+(this._data.total>0?"("+this._data.progress+"/"+this._data.total+")":""),this._data.state){case t.MissionState.failed:this.currentState="failed";break;case t.MissionState.completed:this.currentState="success";break;default:this.currentState="active"}},i}(cm.EUIComponent);t.MissionItem=e,__reflect(e.prototype,"codearena.MissionItem")}(codearena||(codearena={}));var codearena;!function(t){var e=function(){function e(t){this._view=t,this.onAdd()}return e.prototype.onAdd=function(){t.missionManager.addEventListener(egret.Event.CHANGE,this._init,this),this._init()},e.prototype._init=function(){var e=this;this.destroy();var i=t.missionManager.missionSet.missionList;i&&0!==i.length&&(this._missions=[],t.missionManager.missionSet.missionList.forEach(function(i){var n=new t.MissionItem(i);e._missions.push(n),e._view.missions.addChild(n)}),this._view.missionPanel.height=26*t.missionManager.missionSet.missionList.length+38)},e.prototype.onRemove=function(){t.missionManager.removeEventListener(egret.Event.CHANGE,this._init,this),this._view=null,this.destroy()},e.prototype.destroy=function(){this._missions&&0!==this._missions.length&&(this._missions.forEach(function(t){t.parent&&t.parent.removeChild(t)}),this._missions=null)},e}();t.MissionPanel=e,__reflect(e.prototype,"codearena.MissionPanel")}(codearena||(codearena={}));var codearena;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onCancel,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onCancel,this),this.icon=this.imgDb.source,this.state="up",this.imgLabel.touchEnabled=!1},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},set:function(t){this._label=t,this.text="label_"+t,this.onCancel()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"icon",{get:function(){return this._icon},set:function(t){this._icon=t,this.db=t},enumerable:!0,configurable:!0}),e.prototype.onBegin=function(){this.state="down"},e.prototype.update=function(){if(this.db&&this.text)switch(this._state){case"down":this.imgDb.source=this.db+"S",this.imgLabel.source=this.text+"S";break;case"disbale":this.imgDb.source=this.db+"_grey",this.imgLabel.source=this.text+"_grey";break;default:this.imgDb.source=this.db+"",this.imgLabel.source=this.text+""}},e.prototype.onCancel=function(){this.state="up"},Object.defineProperty(e.prototype,"state",{set:function(t){this._state=t,this.update()},enumerable:!0,configurable:!0}),e.prototype.onMove=function(){},e.prototype.onEnd=function(){this.onCancel()},Object.defineProperty(e.prototype,"enable",{set:function(t){this._enbale=t,this._enbale?(this.touchEnabled=!0,this.touchChildren=!0,this.onCancel()):(this.touchEnabled=!1,this.touchChildren=!1,this.dispatchEventWith(egret.TouchEvent.TOUCH_CANCEL),this.state="disbale")},enumerable:!0,configurable:!0}),e}(eui.Component);t.MyButton=e,__reflect(e.prototype,"codearena.MyButton")}(codearena||(codearena={}));var codearena;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._miniHeight=300,e.skinName="Notice",e}return __extends(e,t),e.prototype.onhide=function(){this.parent.removeChild(this)},e.prototype.onComplete=function(){t.prototype.onComplete.call(this),this.scroller.bounces=!0,this.scroller.scrollPolicyV=eui.ScrollPolicy.AUTO,this._scrollerRisize(),this.closeBtn.once(egret.TouchEvent.TOUCH_TAP,this.onhide,this)},e.prototype._scrollerRisize=function(){var t=this.scroller.verticalScrollBar;t.autoVisibility=!1;var e=this.scroller.viewport.height/this.scrollerGroup.measuredHeight;e>1?t.visible=!1:(t.visible=!0,t.thumb.height=e*this.scroller.viewport.height)},e}(cm.AutoLayoutView);t.Notice=e,__reflect(e.prototype,"codearena.Notice",["eui.UIComponent","egret.DisplayObject"])}(codearena||(codearena={}));var codearena;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.showAndFadeIn=function(t){return this.show(),this.fadeIn()},e.prototype.fadeOutAndHide=function(){var t=this;return this.fadeOut().then(function(){return t.remove()})},e.prototype.show=function(t){this._resize(),cm.main.contains(this)||cm.main.addChildAt(this,cm.Layer.Middle),this.alpha=1,this._loading.play(1e3,0),cm.main.stage.addEventListener(egret.Event.RESIZE,this._resize,this)},e.prototype._resize=function(){this.width=cm.main.stage.stageWidth,this.height=cm.main.stage.stageHeight,this.graphics.clear(),this.graphics.beginFill(0,1),this.graphics.drawRect(0,0,this.width,this.height),this.graphics.endFill(),this._loading||(this._loading=new cm.SequenceImage("loading_json.loading_",2,0,30),this.addChild(this._loading)),this._loading.x=this.width/2,this._loading.y=this.height/2},e.prototype.fadeIn=function(){var t=this;this.alpha=0;var e=new Promise(function(e,i){var n=egret.Tween.get(t);n.to({alpha:1},500).call(e)});return e},e.prototype.fadeOut=function(){var t=this;this.alpha=1;var e=new Promise(function(e,i){var n=egret.Tween.get(t);n.to({alpha:0},500).call(e)});return e},e.prototype.remove=function(){this.stage&&(this.parent.removeChild(this),cm.main.stage.removeEventListener(egret.Event.RESIZE,this._resize,this))},e}(egret.Sprite);__reflect(e.prototype,"ScreenLoading"),t.loading=new e}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i._index=0,i._data=t,i.skinName="BattleDialog",i}return __extends(i,e),i.prototype.onComplete=function(){e.prototype.onComplete.call(this),this._update(),this.left=0,this.right=0,this.bottom=0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this._onNext,this),this.skipBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this._onSkip,this)},i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this._onNext,this),this.skipBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this._onSkip,this),this.onFinish=null},i.prototype._onNext=function(){t.Sound.button(),this._index<this._data.length-1?(this._index++,this._update()):this.onFinish()},i.prototype._onSkip=function(e){e.stopPropagation(),t.Sound.button(),this.onFinish()},i.prototype._update=function(){var t=this._data[this._index];this.nameLabel.text=t.roleName,this.nameLabel.textColor="我"===t.roleName?16047367:8244735,this.contentLabel.text=t.dialog},i}(cm.EUIComponent);t.BattleDialog=e,__reflect(e.prototype,"codearena.BattleDialog")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i._imgurl="",i._imgurl=t,i.skinName="TipView",i}return __extends(i,e),i.prototype.onComplete=function(){var i=this;e.prototype.onComplete.call(this);var n=cnUtils.getRESUrlByKey(this._imgurl);cm.Image.getByUrl(n).then(function(e){i.img.source=e;var n=i.container.width,o=n/e.bitmapData.width;n>e.bitmapData.width&&(i.img.x=(n-e.bitmapData.width)/2),o=o>1?1:o,i.img.width=e.bitmapData.width*o,i.img.height=e.bitmapData.height*o,t.Global.IS_UBT&&(t.hideTip=function(){var t=i.parent;t&&t.hide()})}),this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this._onOk,this)},i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this._onOk,this)},i.prototype._onOk=function(){t.Sound.button();var e=this.parent;e&&e.hide(),t.Global.IS_UBT&&t.onTipConfirm&&t.onTipConfirm()},i}(cm.EUIComponent);t.BattleTipPanel=e,__reflect(e.prototype,"codearena.BattleTipPanel")}(codearena||(codearena={}));var codearena;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i._state="success",i._state=t,i.skinName="MissionComplete",i}return __extends(i,e),i.prototype.onComplete=function(){e.prototype.onComplete.call(this),this.currentState=this._state,this.continueBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this._onContinue,this),this.redoBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this._onRedo,this),this.left=this.top=this.right=this.bottom=0,cm.soundManager.playSound("failed"===this._state?t.SoundType.BGM_FAILURE:t.SoundType.BGM_SUCCESS),this.redoBtn.label=t.lang.get("onceMore_txt")},i.prototype.onRemove=function(){this.continueBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this._onContinue,this),this.redoBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this._onRedo,this)},i.prototype._onContinue=function(){t.Sound.button();var e=this.parent;e&&e.hide();t.gameControl.currentLevel;return t.Global.IS_UBT?void t.onContinueFight():void 0},i.prototype._onRedo=function(){t.Sound.button(),t.gameControl.reset();var e=this.parent;return e&&e.hide(),t.Global.IS_UBT?void t.onRedoFight():void 0},i}(cm.EUIComponent);t.MissionComplete=e,__reflect(e.prototype,"codearena.MissionComplete")}(codearena||(codearena={}));var codearena;!function(t){function e(t){}function i(){}function n(){}function o(e){cm.sceneManager.load(t.BattleScene,null,e),egret.ticker.resume()}function r(){cm.sceneManager.unload(),t.gameControl.stop(),egret.ticker.pause()}function s(){}function a(){}function c(){}function h(){}function l(){}t.onLevelLoaded=e,t.onTipConfirm=i,t.hideTip=n,t.load=o,t.unload=r,t.onStoryComplete=s,t.onRedoFight=a,t.onContinueFight=c,t.onBattleFailed=h,t.onBattleSuccess=l}(codearena||(codearena={}));